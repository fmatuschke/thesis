\setcounter{chapter}{7}
\chapter{Simulation}
\label{cha:simulation_analysis}
% \minitoc
% 
% 
\section{Introduction}
% 
This chapter addresses the simulation of \ac{3D-PLI}.
The first part focuses on the determination of all necessary physical parameters of the tissue and the microscope as well as on the characterization of the simulation parameters.
The latter focuses on the \voxelsize{}, which significantly determines the accuracy.
Subsequently, these parameters are used to simulate the previously created models.
The simulations are evaluated using the routine algorithms implemented in \ac{fastPLI}. The focus of the evaluations of the results is on the accuracy of the inclination analyses for different orientations and intersection configurations.
% 
% 
% 
\section{Parameter characterisation}\label{sec:sim_choose_parameters}
% 
\subsection{Optical resolution}
% 
As described in \cref{sec:opticalResolution}, optical resolution depends on aberration and diffraction, which in turn depend on a variety of factors.
Optical resolution and resampling are modeled as described in \cref{sec:ccdOptic}. 
% 
\begin{figure}[!t]
\setlength{\tikzwidth}{0.35\textwidth}
\centering
\begin{tabular}{cc}
\includegraphics[width=\tikzwidth]{dev/wiki/USAF-1951.pdf}
&
% \tikzset{external/remake next=true}
\inputtikz{dev/gfx/chap8/usaf_image}
\\
% 
\multicolumn{1}{l}{
\begin{minipage}[t]{0.45\textwidth}
\leavevmode\subcaption{\label{fig:usaf}USAF chart from group -2 to 1 \url{https://en.wikipedia.org/wiki/1951_USAF_resolution_test_chart}}
\end{minipage}}&
\multicolumn{1}{l}{
\begin{minipage}[t]{0.45\textwidth}
\leavevmode\subcaption{\label{fig:usaf_image}microscopic image}
\end{minipage}}
\\
% 
% \tikzset{external/remake next=true}
\inputtikz{dev/gfx/chap8/usaf_line_plots_lr}
&
% \tikzset{external/remake next=true}
\inputtikz{dev/gfx/chap8/usaf_line_plots_up}
\\
% 
\multicolumn{1}{l}{
\begin{minipage}[t]{0.45\textwidth}
\leavevmode\subcaption{\label{fig:usaf_lines_lr}centered line plots lr}
\end{minipage}}&
\multicolumn{1}{l}{
\begin{minipage}[t]{0.45\textwidth}
\leavevmode\subcaption{\label{fig:usaf_lines_ud}centered line plots ud}
\end{minipage}}
\end{tabular}
\caption[USAF test chart measurement]{\acs{LMP} data. Line width: magenta: $\SI{2.19}{\micro\meter}$, yellow $\SI{1.95}{\micro\meter}$ and cyan $\SI{1.74}{\micro\meter}$. Resolution at about $\SI{1.95}{\micro\meter}$ yielding to an optical convolution of $\opticsigma = \SI{0.75}{\pixel}$.}
\label{fig:USAF}
\end{figure}
%
In order to measure the optical resolution of the microscope, the measurements and analysis are performed again in the same way as \cite{MenzelMaster}.
For this purpose, the \textit{1951 \ac{USAF} resolution test chart}\footnote{U.S. Air Force MIL-STD-150A standard of 1951} is acquired.
It consists of several patterns that have three slots with defined spacing and width (see \cref{fig:usaf}).
They are arranged in fields of three vertical and horizontal lines.
The fields are arranged in a spiral, which shrinks by a factor of $\SI{0.5}{}$ from pattern to pattern.
To determine the line width, the fields are numerically ordered according to a main group $i$ and a subgroup $j$.
To determine the resolution of the microscope, the group corresponding to the imaging resolution system, \ie{} Rayleigh criteria (see \cref{fig:rayleigh}), must be identified.
This is done by analyzing the intensity profiles along the perpendicular line of the three slits.
The variance of the measured intensity is measured by analyzing all parallel lines in the slits.\footnote{Multiple images should be measured. These are performed in \cite{MenzelMaster}. This measurement ensures that the results are reproducible}.
% 
\paragraph{Results}
\Cref{fig:usaf_image} shows a section of a captured \ac{LMP} setup image.
The highlighted areas show the analyzed groups 7-6 to 8-2.
The first area of group 7-6 \raisebox{.25em}{\tikzset{external/export next=false}\tikz \draw[RED,ultra thick,dashed](0,0)--(0.25,0);} has a line width of $\SI{2.19}{\micro\meter}$.
The second group 8-1 \raisebox{.25em}{\tikzset{external/export next=false}\tikz \draw[GREEN,ultra thick,dashed](0,0)--(0.25,0);} has a line width of $\SI{1.95}{\micro\meter}$.
The last group 8-2 \raisebox{.25em}{\tikzset{external/export next=false}\tikz \draw[BLUE,ultra thick,dashed](0,0)--(0.25,0);} has a line width of $\SI{1.74}{\micro\meter}$.
The intensity line profiles for the vertical and horizontal cases are shown in \cref{fig:usaf_lines_lr,fig:usaf_lines_ud}.
% 
Using the Rayleigh criterion, the resolution can be limited in the range of the second group and thus by $\SI{1.95}{\micro\meter}$.
This reproduces the measurements in the \cite{MenzelMaster}.
Therefore, the convolution to be applied (see \cref{sec:opticalResolution}) is set to $\opticsigma = \SI{0.75}{\pixel}$.
% 
% 
% 
\subsection{sensor gain and image noise}\label{sec:sensorGain}
%
\begin{figure}[!t]
\centering
% 
\begin{tabular}{cc}
% 
\multicolumn{2}{c}{
\setlength{\tikzwidth}{0.75\textwidth}
\begin{minipage}{\tikzwidth}
\tikzset{external/export next=false}
\inputtikz{gfx/pli/pli_focus}
\end{minipage}
}
\\[-1em]
% 
\multicolumn{2}{l}{
\begin{minipage}[t]{\textwidth}
\leavevmode\subcaption{\label{fig:intensityFocus}Intensity measurement setup. The focus of the microscop is changed so that the image is blured, resulting in a intensity variation at the border of the absorber material.\\[1em]}
\end{minipage}}
\\
% 
% 1. IMAGE
\begin{tikzpicture}[baseline, trim axis left, trim axis right]
\begin{axis}[
width=0.4\textwidth,
height=0.4\textwidth,
point meta min=0,point meta max=1670,
xmin=0,xmax=1,ymin=0,ymax=1,
scale only axis,
hide axis,
colorbar left,colormap/gray,
colorbar style={every y tick label/.append style={font=\small},}
]
\addplot[]graphics [
xmin=0,xmax=1,
ymin=0,ymax=1,
] {dev/gfx/2/PM_000_vmin_0_vmax_1670.png};
\end{axis}
\end{tikzpicture}
&
% 
% 2. IMAGE
\begin{tikzpicture}[baseline, trim axis left, trim axis right]
\begin{axis}[%
width=0.4\textwidth,
height=0.4\textwidth,
axis lines=center,
scale only axis,
xlabel={x-pos},
ylabel={intensity},
]
\addplot[mark=none, blue] table[x index=0, y index=1] {dev/gfx/2/PM_000.dat};
\end{axis}
\end{tikzpicture}
\\[-1em]
% 
% SUBCAPTIONS
\multicolumn{1}{l}{
\begin{minipage}[t]{0.45\textwidth}
\leavevmode\subcaption{\label{fig:intensityImage}single microscopic image}
\end{minipage}}
&
\multicolumn{1}{l}{
\begin{minipage}[t]{0.45\textwidth}
\leavevmode\subcaption{\label{fig:intensityProfile}intensity profile.}
\end{minipage}}
\end{tabular}
% 
\caption[intensity image]{y-mean intensity profile}
\label{fig:intensityMeasurement}
\end{figure}
% 
% 
% 
\begin{figure}[!t]
% thesis/2_simulation/0_parameter/sensor_gain.py
\centering
% 
\setlength{\tikzwidth}{0.35\textwidth}
\begin{tabular}{cc}
% \tikzset{external/export next=false}
\inputtikz{gfx/data/PM_noise}
&
% \tikzset{external/export next=false}
\inputtikz{gfx/data/theo_noise}
\\
% SUBCAPTIONS
\multicolumn{1}{l}{
\begin{minipage}[t]{0.495\textwidth}
\leavevmode\subcaption{\label{fig:parameterModelNoise} Noise analysis PM. $\opticgain_{\mathit{LMP}} = \SI{0.1175}{}(?)$.}
\end{minipage}}
&
\multicolumn{1}{l}{
\begin{minipage}[t]{0.495\textwidth}
\leavevmode\subcaption{\label{fig:noiseplot}noise \dummy[check values]{}}
\end{minipage}}
\end{tabular}
% 
\caption[Noise analysis]{intensity variance and noise plot}
\label{fig:parameterModelGain}
\end{figure}
% 
As described in \cref{sec:ccdOptic}, optical noise must be modeled by a noise model.
In \cite{Wiese:887678}, the gain factor $\opticgain$ of the microscopic setup was measured by multiple measurements of an image with a variety of intensity values. 
The gain factor describes the linearity between a measured signal and the corresponding noise.
The same type of measurement and analysis is performed here with the \ac{LMP} setup.
\\
To obtain statistics for a large number of intensity values, the sample stage is covered with a fully absorbing cover so that half of the image is dark.
In addition, the focal length is changed so that light is distributed over the entire image sensor below the cover (see \cref{fig:intensityImage}).
By measuring $N=\SI{500}{}$ images, the variance for the different intensity values is determined.
% 
\paragraph{results}
The results are shown in \cref{fig:parameterModelNoise} and show a gain value of $\opticgain_{\mathit{LMP}} = \SI{0.1175}{}(?)$ which is agreement to the hardware specifics \todo{check and ref}.
This gain factor can be used by the model
\begin{align}
f(x) = \floor{\mathrm{normal}(\mu = x, \sigma=\sqrt{\opticgain x})+0.5}
\end{align}
for intensities $I > 0$, $I \gg \sqrt{\opticgain I}$ and integer values.
% 
% 
% 
\subsection{Tissue properties}\label{sec:tissueProp}
% 
\begin{figure}[!t]
\centering
\setlength{\tikzwidth}{0.75\textwidth}
\begin{tabular}{c}
% 
\inputtikz{gfx/data/vervet_transmittance}
\\[-1em]
\begin{minipage}[t]{\textwidth}
\leavevmode\subcaption{\label{fig:brain_trans}transmittance}
\end{minipage}
\\
\inputtikz{gfx/data/vervet_retardation}
\\[-1em]
\begin{minipage}[t]{\textwidth}
\leavevmode\subcaption{\label{fig:brain_ret}retardation}
\end{minipage}
% 
\end{tabular}
\caption[Vervet monkey coronal section transmittance and retardation]{%
Vervet monkey coronal section $\SI{549}{}$.
a) transmittance, b) retardation.
The absorption coefficient and birefingence strength can be estimated from flat fibers.
Two \acsp{ROI} with \dummy{} pixels are annotated for this purpose.
\itodo{histograms?, why these two rois?}}
\label{fig:brain_ret_trans}
\end{figure}
% 
% 
% 
\begin{figure}[!t]
% 2_simulation/0_parameter/measure_vervet.ipy
\centering
\setlength{\tikzwidth}{0.45\textwidth}
\begin{tabular}{cc}
% 
\inputtikz{gfx/data/vervet_transmittance_zoom} &
\inputtikz{gfx/data/vervet_transmittance_hist} \\[-5mm]
% 
\multicolumn{1}{l}{
\begin{minipage}[t]{0.495\textwidth}
\leavevmode\subcaption{zoom transmittance}
\end{minipage}} &
\multicolumn{1}{l}{
\begin{minipage}[t]{0.495\textwidth}
\leavevmode\subcaption{hist transmittance}
\end{minipage}} \\[10mm]
% 
\inputtikz{gfx/data/vervet_retardation_zoom} &
\inputtikz{gfx/data/vervet_retardation_hist} \\[-5mm]
% 
\multicolumn{1}{l}{
\begin{minipage}[t]{0.495\textwidth}
\leavevmode\subcaption{zoom retardation}
\end{minipage}} &
\multicolumn{1}{l}{
\begin{minipage}[t]{0.495\textwidth}
\leavevmode\subcaption{hist retardation}
\end{minipage}} \\
% 
\end{tabular}
\caption[zoom ret and trans]{%
trans left: $1200 \pm 500$,
trans right: $1200 \pm 500$,
bg: $4530 \pm 240$,
fuellgrad $0.75: \mu \approx 30 \pm 10$,
fuellgrad $0.75: \mu \approx 30 \pm 10$,
ret left: $0.83 \pm 0.07$,
ret right: $0.80 \pm 0.07$
\itodo{what happens in the center?; redesign histogramm; which is left and right?}}
\label{fig:brain_ret_trans_zoom}
\end{figure}
% 
% analog roden:
% trans: $2100 \pm 600$,
% bg: $4000 \pm 50$,
% fuellgrad $0.75: \mu \approx 14 \pm 7$,
% ret: $0.40 \pm 0.11$,
% and human:
% trans: $170 \pm 80$,
% bg: $2700 \pm 110$,
% fuellgrad $0.75: \mu \approx 61 \pm 11$,
% ret: $0.68 \pm 0.11$,
% 
% 
\begin{figure}[tp]
\centering
\subcaptionbox{\label{fig:simTransValues}transmittance}[.95\textwidth]{
\includegraphics[height=0.7\textwidth,
    rotate=-90, trim=0 95 775 90, clip]
    {dev/rc1/tissue/bf_rc1_transmittance_PM_Vervet.pdf}} %\hfill
\subcaptionbox{\label{fig:simRetValues}retardation}[.95\textwidth]{
\includegraphics[width=0.95\textwidth]{dev/rc1/tissue/bf_rc1_retardation_PM_Vervet.pdf}
}
\caption{simulations for Vervet LMP tissue for different absorption coef and birefringence values. \itodo{exp messungen mit einzeichnen, rfc plot}}
\label{fig:parameterModelSim}
\end{figure}
% 
The absorption coefficient $\absorp{}$ and the birefringence $\dn{}$ have to be estimated from the tissue to use appropriate values in the simulation.
As the literature shows, these values are in the range of $\dn{}$ \dummy{}.
Since the models created here use stiff fiber segments the volume density cannot reach the high density usually present in \ac{WM}.
To overcome this problem, the absorption and birefringence strengths must be increased to obtain comparable results.
\par
%
For a measurement of the properties it is important to ensure that a homogeneous region is chosen.
In coronal section, the corpus callosum is suitable for this purpose. It is the main fiber connection between the two cerebral hemispheres (see \cref{fig:parameterModelSim}). In a central section, the nerve fibers generally lie flat in section
% 
\ref{fig:brain_ret_trans} shows transmission and retardation maps of the vervet monkey coronal section, and \ref{fig:brain_ret_trans_zoom} shows a zoomed version.
The retardation map shows a visible reduction of retardation in the center of the corpus callosum.
Therefore, because of the need for homogeneity, this central region is neglected.
A left and a right region remain, which may be homoginous in both transmission and retardation (see histograms).
The left region has $\SI{1125858}{}$ number of pixels, the right part $\SI{1064629}{}$
% 
The same measurements are made for the human and rodent in the corpus callosum (see Appendix). \todo{Appendix}
% 
% 
% 
\subsubsection{absorption}
% 
When the light passes through the tissue, it is absorbed in the matter on the one hand and scattered on the other.
Both effects can be modeled mathematically in this linear optical simulation as a decrease in intensity along the path.
A drawback of this simulation is that the scattering is not constant for all fiber configurations and orientations \dummy[see MM]{}.
Therefore, the measured absorption coefficient is only valid for the same fiber configurations as in the region.
Absorption only changes the transmittance and hence the relative noise, not the delay or direction of the signal. 
Since the noise is quite low in this microscopic configuration, it should have little effect on the results. 
\par
% 
To measure absorption, the transmittance of the coronal slice in the \ac{ROI} of the corpus callosum is measured against the background value.
The absorption coefficient is then calculated by applying \dummy{}.
This values are then increased according to the volume fraction, of the models and then simulated to ensure that the same behavior can be modelled.
% 
\paragraph{Results}
A relative transmittance of about $\SIrange{20}{30}{\percent}$ is present within the \ac{ROI} of the corpus callosum. 
The simulation parameter must be set to achieve a similar transmission value for the models.
This means that for a $\SI{60}{\micro\meter}$ thick section, the absorption coefficient $\absorp{}$ is about $\SI{30}{\milli\meter\tothe{-1}}$. 
The absorption for the roden is about $\SI{8}{\milli\meter\tothe{-1}}$, and that of the human is about $\SI{65}{\milli\meter\tothe{-1}}$.
\\
%
\Cref{fig:simTransValues} shows the simulated transmittance values for different fiber radii. 
For smaler radii the variance of the transmittance is very small \dummy{} and increases with the radii.
This behavier is epected, since models with larger radii have more space where no tissue is present, and therefore the light can travel freely through the \say{section}.
In comparison to the histogram \cref{fig:brain_ret_trans_zoom} the models with larger radii have more in common with the distribution.
However from literature one can neglect, that this kind of fiber radii is present in corpus calosum \dummy{}.
Nevertheless the tissue can have more complicated configurations and effects, which leads to a larger viarity of absorption, \eg{} cells, blood vessels and so on.
Also at this point the here developed simulation is not ready to simulate scattered light, which is to be expected to increase the range of the absorption and therefore resulting a a larger variance of transmittance.
% 
% 
%
\subsubsection{birefringence}
% 
The birefringence cannot simply be measured like the transmittance.
Due to the radial optical axis of the myelin, the relativ obsorving birefringence is smaller than the one of the myelin.
However the simulation up to a point has the same geometrical constrains.
By simulating difference birefringence strength and comparing them to the retardation of the tissue one can find a proper value.
The simulation will use a flat single fiber population and the same parameters as the later simulation model library (see \dummy{}).
% 
\paragraph{Results}
The results in \cref{fig:parameterModelSim} show that to reach a retardation value similar to the experimental setup of around $\SI{0.8}{}$ a birefringence value of $\SI{0.008}{}$ for the microscopic model should be chosen.
Looking at the different model nerve fiber radii the variance of the retardation values increase strong, similar to the transmittance.
This is to be expected since the simulated tissue section has a hight of $\SI{60}{\micro\meter}$.
Therefore for a radii of $\SI{10}{\micro\meter}$ the number of tissue voxels has to vary depending on where the fibers are positioned in the volume.
For larger radii this leads to the problem, that the retardation cannot be over 1 and therefore the signal amplitude reduces again.
% 
% 
% \subsection{noise} <--- why this section?
% % 
% From \cref{sec:sensorGain,sec:tissueProp} the noise level can be calculated.
% However, when considering the different species, it is important to note that transmittance levels vary.
% Rodents typically have the highest transmittance, monkeys have a lower transmittance, and humans have the lowest transmittance.
% The reason for the rather low transmission of the human sections is probably due to the long post-mortem period.
% \Cref{fig:noiseplot} shows a log-log plot for this purpose.
% To run the simulation, a relative error of \dummy{} is used for a midrange analysis.
% 
% 
% 
\subsection{voxel size \texorpdfstring{\voxels{}}{}}
% 
% 
\begin{figure}[!t]%p
% 2_simulation/0_parameter/fiber_radii.py
\centering
\includegraphics[width=\textwidth, page=1]{dev/rc1/voxel_size/voxel_size_plots_data_r05_output_vs_135_0.01_6_25_vervet_r_rc1.pdf}
\caption[voxel size model with noise]{The mean difference is constant for smaller voxel sizes and does not start to grow significantly before $\voxels=\SI{0.1}{\micro\meter}$.}
\label{fig:voxelsizeNoise}
\end{figure}
% 
The \voxelsize{} paramter $\voxels$ is the most important parameter for simulation accuracy, as it determines how accurately the models are discretized.
Smaller values mean more details, more accurate optical axes and more light rays.
However, this also increases the number of calculations and memory by $O(n_{\mathit{voxel}}^3)$.
Therefore, it is recommended to choose the voxel size as large as possible without introducing a significant error due to the discretization.
\par
% 
To investigate this effect, a simulation is performed with different types of voxel sizes from the $\SIrange{0.01}{1.3}{\micro\meter}$.
The smallest voxel size $\SI{0.01}{\micro\meter}$ is used as ground truth. 
Since this voxel size is so small, only a volume of $3 \cdot \SI{1.3}{\micro\meter} \cdot \SI{1.3}{\micro\meter} 3 \cdot \SI{1.3}{\micro\meter} \times \SI{60}{\micro\meter}$ is used without tilting.
Otherwise, if tilting is used, the volume would have to be increased so that the light beam still travels through the tissue.
The other parameters are set as in \dummy{}.
The models to be simulated are $(||,\modelInc = \SI{0}{\degree})$, $(||,\modelInc = \SI{90}{\degree})$, $(\times,\modelInc = \SI{0}{\degree})$, and $(\times,\modelInc = \SI{90}{\degree})$ with a anteil of $\modelPsi = \SI{0.5}{}$, since these configurations represent the extrema for two fiber populations.
To improve the statistics, the simulation is repeated in the volume on an aquidistant $xy$ grid of $\num{5}$ by $\num{5}$ points within the $\SI{65}{\micro\meter}$ by $\SI{65}{\micro\meter}$ model.
% 
\paragraph{Results}
The results in \cref{fig:voxelsizeNoise} show that the relative difference to the smallest \voxelsize{} increases statically significantly above a value of \SI{0.1}{\micro\meter}.
The variance of the relative difference increases with increasing \voxelsize{} from this value.
% 
The results shown in \cref{fig:voxelsizeNoise} suggest that with noise present and a voxel size smaller than $\SI{0.1}{\micro\meter}$, accuracy does not increase with respect to the noise model chosen here.
However, this is only true for a pixel size of $\SI{1.3}{\micro\meter}$ and fiber radii of $\SI{0.5}{\micro\meter}$.
%  
% 
% 
\section{Simulation}
% 
\subsection{Parameter and environment}
%  
\begin{table}[!b]
\caption{simpli parameters}
\centering
% \sisetup{open-bracket={\{}, close-bracket={\}}, list-final-separator={,},list-pair-separator={,}}%
\pgfplotstabletypeset[%
    thesisTableStyle,
    column type=l,
    columns/variable/.style={string type},
    columns/value/.style={string type},
    every head row/.style={before row=\toprule,after row=\midrule},
    every last row/.style={after row=\bottomrule},
    col sep=&,
    row sep=\\,
]
{variable & value\\
% 
simpli.voxel\_size & $\SI{0.1}{\micro\meter}$\\
simpli.pixel\_size & $\SI{1.3}{\micro\meter}$\\
simpli.voi & $[[\SI{-35}{\micro\meter}, \SI{-35}{\micro\meter}, \SI{-30}{\micro\meter}], [\SI{30}{\micro\meter}, \SI{35}{\micro\meter}, \SI{35}{\micro\meter}]]$\\
simpli.filter\_rotations & $\SIlist{0;20;40;60;80;100;120;140;160}{\degree}$\\
simpli.interpolate & \texttt{"Slerp"}\\
simpli.wavelength & $\SI{525}{\nano\meter}$\\
simpli.optical\_sigma & $\SI{0.75}{\pixel}$\\
tilt angle & $\SI{3.9}{\degree}$\\
simpli.light\_intensity & $\SI{8000}{}$\\
gain & \SI{0.1175}{}\\
simpli.noise\_model & \code{lambda x: np.floor(np.random.normal(x,}\\
 & \ \ \ \ \ \code{np.sqrt(gain * x))+0.5).astype(np.uint16)}\\
fiber absorption & Roden: $\SI{14}{\milli\meter\tothe{-1}}$, Vervet: $\SI{30}{\milli\meter\tothe{-1}}$, Human: $\SI{60}{\milli\meter\tothe{-1}}$\\
fiber model & 'r'\\
fiber birefringence & 0.008\\
fiber radii & axon: \SI{0.75}{}, myelin: \SI{1}{}\\
model delta inclinations & single: $\SI{10}{\degree}$, crossings: $\SI{30}{\degree}$\\
model delta rotation & $\SI{15}{\degree}$\\
}
\label{tab:simParameters}
\end{table}
% 
% 
\Cref{tab:simParameters} lists the parameters of the simulation inside the \fastpli{} variable notation.
The values are chosen due to the discussion of \cref{sec:sim_choose_parameters}.
% 
This configuration results in 
% 
% \subsubsection{Execution}
% 
As described in \cref{Software} \fastpli{} contains a pipeline implementation. \dummy{}.
This implementation is used to calculate the discretized volumes (from generator), simulate the signal, performing the optical noise and inclination analysis of the resulting signal with \rofl{}.\footnote{Source code is available in appendix \dummy{}.}
With a pixel size of \SI{1.3}{\micro\meter} there are be $\SI{2500}{\pixel}$ available per simulation for statistical analysis.
\\
% 
The simulation were performed with a single compute node (\texttt{2x Intel(R) Xeon(R) CPU E5-4657L v2}).
% 
% 
% 
\subsection{single fiber population}
% 
\begin{figure}[!p]
\centering
\newlength{\width}
\setlength{\width}{0.4\textwidth}
\begin{tabular}{cc}
    \includegraphics[width=\width]{dev/rc1/single/cube_2pop_135_rc1_single_plots_single_pop_hist_0.0.pdf} & \includegraphics[width=\width]{dev/rc1/single/cube_2pop_135_rc1_single_plots_single_pop_hist_50.0.pdf} \\
    \includegraphics[width=\width]{dev/rc1/single/cube_2pop_135_rc1_single_plots_single_pop_hist_10.0.pdf} & \includegraphics[width=\width]{dev/rc1/single/cube_2pop_135_rc1_single_plots_single_pop_hist_60.0.pdf} \\
    \includegraphics[width=\width]{dev/rc1/single/cube_2pop_135_rc1_single_plots_single_pop_hist_20.0.pdf} & \includegraphics[width=\width]{dev/rc1/single/cube_2pop_135_rc1_single_plots_single_pop_hist_70.0.pdf} \\
    \includegraphics[width=\width]{dev/rc1/single/cube_2pop_135_rc1_single_plots_single_pop_hist_30.0.pdf} & \includegraphics[width=\width]{dev/rc1/single/cube_2pop_135_rc1_single_plots_single_pop_hist_80.0.pdf} \\
    \includegraphics[width=\width]{dev/rc1/single/cube_2pop_135_rc1_single_plots_single_pop_hist_40.0.pdf} & \includegraphics[width=\width]{dev/rc1/single/cube_2pop_135_rc1_single_plots_single_pop_hist_90.0.pdf}
\end{tabular}
% 
\caption[sim]{left: 2d log histogramm orientation from rofl analysis of simulation, right: 2d log histogramm of orientation of model segemnts. \itodo{legende}}
\label{fig:single_fiber_pop_hist}
\end{figure}
% 
First only a single fiber population will be analysed.
Since for a single population the direction is neglectable, only the inclination parameter $\modelInc{}$ remains.
% 
\par
\Cref{fig:single_fiber_pop_hist} shows the orientation distribution of a single fiber population for dirrecent inclinations $\modelInc{}$.
On the left side are the distributions of the model segments orientations, on the right side the ones of the inclination analysis of the simulated images.
The plot are logithimic and weighet by the surface area of the 2d bin.
% For $\modelInc= \SI{90}{\degree}$
The comparison between both distributions show a agreement of the inclination analysis with the models orientations.
The variance however is for the inclination analysis a little bit higher than for the models orientations.\todo{messen}
Since these are log plots, the \say{visible variance} is almost neglectable.
% 
% 
% 
\begin{figure}[!p]
\centering
\setlength{\width}{0.45\textwidth}
\subcaptionbox{\label{fig:single_fiber_pop_epa_trans}transmittance}[\width]{
\includegraphics[width=\width]{dev/rc1/single/cube_2pop_135_rc1_single_plots_single_pop_epa_trans.pdf}}\hfill
\subcaptionbox{\label{fig:single_fiber_pop_epa_dir}direction}[\width]{
\includegraphics[width=\width]{dev/rc1/single/cube_2pop_135_rc1_single_plots_single_pop_epa_dir.pdf}}
\\[2em]
\subcaptionbox{\label{fig:single_fiber_pop_epa_ret}retardation}[\width]{
\includegraphics[width=\width]{dev/rc1/single/cube_2pop_135_rc1_single_plots_single_pop_epa_ret.pdf}}\hfill
\subcaptionbox{\label{fig:single_fiber_pop_rofl_dir}rofl direction}[\width]{
\includegraphics[width=\width]{dev/rc1/single/cube_2pop_135_rc1_single_plots_single_pop_rofl_dir.pdf}}
\\[2em]
\subcaptionbox{\label{fig:single_fiber_pop_rofl_inc}rofl inclination: it is remaped circular around the circmean value}[\width]{
\includegraphics[width=\width]{dev/rc1/single/cube_2pop_135_rc1_single_plots_single_pop_rofl_inc.pdf}}\hfill
\subcaptionbox{\label{fig:single_fiber_pop_rofl_trel}rofl trel}[\width]{
\includegraphics[width=\width]{dev/rc1/single/cube_2pop_135_rc1_single_plots_single_pop_rofl_trel.pdf}}
\caption[]{\dummy[single population rofl analysis; colors left to right: 0 to 90 degree inclination; line: theoretical curve]{}}
\label{fig:single_fiber_pop_rofl}
\end{figure}
% 
\par
\Cref{fig:fig:single_fiber_pop_rofl} show the different modalities after analysing the raw measurements for all inclinations.
The transmittance is for inclinations $\modelInc<\SI{90}{\degree}$ almost identical.\footnote{not as in the experiment!}
For $\modelInc= \SI{90}{\degree}$ however the transmittance increases, \ie{} the absorption decreses.
Tje dorectopm va;ies varoamce os wotj \dummy{} very small.
Only for high inclination values its increases.
One must take note, that because the boxplot does not take the periodic signal into account, the values are for the $\modelInc= \SI{90}{\degree}$ actually along the hole range.
The retardation follows for all inclinaten the theoretical model (blue curve).
Its variance stays almost constant with about \dummy{}.
The direction from the inclination analysis is indistinquistable from the fourie analysis.
The inclination follows the models inclination.
Its variance increases for high values significant.
Trel is up to \dummy{} relativ const.
For higher inclination values however its values exceeds 1 which leads to the conclusion, that the model could not fit the data anymore apropiatly.
% 
% 
% 
\subsection{two fiber populations}
% 
\subsubsection{flat crossing fiber configurations}
% 
\begin{figure}[!p]
\centering
\setlength{\width}{0.4\textwidth}
\begin{tabular}{cc}
    \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_0.0_psi_0.3.pdf} &
    \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_50.0_psi_0.3.pdf} \\
    \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_10.0_psi_0.3.pdf} & \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_60.0_psi_0.3.pdf} \\
    \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_20.0_psi_0.3.pdf} & \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_70.0_psi_0.3.pdf} \\
    \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_30.0_psi_0.3.pdf} & \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_80.0_psi_0.3.pdf} \\
    \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_40.0_psi_0.3.pdf} & \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_90.0_psi_0.3.pdf}
\end{tabular}
% 
\caption[sim]{psi=0.3; left: 2d log histogramm orientation from rofl analysis of simulation, right: 2d log histogram of orientation of model segemnts. \itodo{legende}}
\label{fig:flat_03_fiber_pop_hist}
\end{figure}
% 
\begin{figure}[!p]
\centering
\setlength{\width}{0.45\textwidth}
\subcaptionbox{\label{fig:flat_03_fiber_pop_epa_trans}transmittance}[\width]{
\includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_psi_0.3_epa_trans.pdf}}\hfill
\subcaptionbox{\label{fig:flat_03_fiber_pop_epa_dir}direction}[\width]{
\includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_psi_0.3_epa_dir.pdf}}
\\[2em]
\subcaptionbox{\label{fig:flat_03_fiber_pop_epa_ret}retardation}[\width]{
\includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_psi_0.3_epa_ret.pdf}}\hfill
\subcaptionbox{\label{fig:flat_03_fiber_pop_rofl_dir}rofl direction}[\width]{
\includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_psi_0.3_rofl_dir.pdf}}
\\[2em]
\subcaptionbox{\label{fig:flat_03_fiber_pop_rofl_inc}rofl inclination: it is remaped circular around the circmean value}[\width]{
\includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_psi_0.3_rofl_inc.pdf}}\hfill
\subcaptionbox{\label{fig:flat_03_fiber_pop_rofl_trel}rofl trel}[\width]{
\includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_psi_0.3_rofl_trel.pdf}}
\caption[]{\dummy[flat population psi=0.3 rofl analysis; colors left to right: 0 to 90 degree inclination; line: theoretical curve]{}}
\label{fig:flat_03_fiber_pop_rofl}
\end{figure}
% 
\begin{figure}[!p]
\centering
\setlength{\width}{0.4\textwidth}
\begin{tabular}{cc}
    \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_0.0_psi_0.5.pdf} &
    \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_50.0_psi_0.5.pdf} \\
    \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_10.0_psi_0.5.pdf} & \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_60.0_psi_0.5.pdf} \\
    \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_20.0_psi_0.5.pdf} & \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_70.0_psi_0.5.pdf} \\
    \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_30.0_psi_0.5.pdf} & \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_80.0_psi_0.5.pdf} \\
    \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_40.0_psi_0.5.pdf} & \includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_hist_omega_90.0_psi_0.5.pdf}
\end{tabular}
% 
\caption[sim]{psi=0.5; left: 2d log histogramm orientation from rofl analysis of simulation, right: 2d log histogramm of orientation of model segemnts. \itodo{legende}}
\label{fig:flat_05_fiber_pop_hist}
\end{figure}
% 
\begin{figure}[!p]
\centering
\setlength{\width}{0.45\textwidth}
\subcaptionbox{\label{fig:flat_05_fiber_pop_epa_trans}transmittance}[\width]{
\includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_psi_0.5_epa_trans.pdf}}\hfill
\subcaptionbox{\label{fig:flat_05_fiber_pop_epa_dir}direction}[\width]{
\includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_psi_0.5_epa_dir.pdf}}
\\[2em]
\subcaptionbox{\label{fig:flat_05_fiber_pop_epa_ret}retardation}[\width]{
\includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_psi_0.5_epa_ret.pdf}}\hfill
\subcaptionbox{\label{fig:flat_05_fiber_pop_rofl_dir}rofl direction}[\width]{
\includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_psi_0.5_rofl_dir.pdf}}
\\[2em]
\subcaptionbox{\label{fig:flat_05_fiber_pop_rofl_inc}rofl inclination: it is remaped circular around the circmean value}[\width]{
\includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_psi_0.5_rofl_inc.pdf}}\hfill
\subcaptionbox{\label{fig:flat_05_fiber_pop_rofl_trel}rofl trel}[\width]{
\includegraphics[width=\width]{dev/rc1/flat/cube_2pop_135_rc1_flat_plots_flat_pop_psi_0.5_rofl_trel.pdf}}
\caption[]{\dummy[flat population psi=0.5 rofl analysis; colors left to right: 0 to 90 degree inclination; line: theoretical curve]{}}
\label{fig:flat_05_fiber_pop_rofl}
\end{figure}
% 
\Cref{fig:flat_crossing_hist} shows the histogram distribution for two fiber popilations with a inclination of $\SI{0}{\degree}$.
Lookiing at the distribtiuon the cariance is slightly increases in comparison to the single fiber population case.
The intensity of the log plot follows the models population density \modelPsi{} \todo{check}.
The inclination of the inclination analysis in the mean with $\SI{0}{\degree}$.
The variance is \dummy{}.
The resulting direction of the analysis is between the models direction distribution:
\begin{align}
    \varphi = \omega_0 \varphi_0 + \omega_1 \varphi_1
\end{align}
\itodo{check this formular. also theoretical!}
% 
% 
% 
\subsection{inclined fibers}
% 
\begin{figure}[!p]
\centering
\includegraphics[width=\textwidth, ]{dev/rc1/analysis/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_acc.pdf} 
% colorbar
\tikzset{external/export next=false}
\begin{tikzpicture}
\begin{axis}[
    hide axis,
    scale only axis,
    height=0pt,
    width=0pt,
    colormap name=cividis,
    colorbar horizontal,
    point meta min=0,
    point meta max=1,
    colorbar style={
        width=10cm,
        xticklabel style={tick label style={font=\footnotesize}},
    }]
\end{axis}
\end{tikzpicture}
% 
\caption[Simulation acc]{Mean \acc{} between model and tilt analysis orientations.}
% \label{fig:sim_fyjsrg}
\end{figure}
% 
\begin{figure}[!p]
\centering
\includegraphics[width=\textwidth, ]{dev/rc1/analysis/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_ret_mean.pdf} 
% colorbar
\tikzset{external/export next=false}
\begin{tikzpicture}
\begin{axis}[
    hide axis,
    scale only axis,
    height=0pt,
    width=0pt,
    colormap name=cividis,
    colorbar horizontal,
    point meta min=0.0137,
    point meta max=0.7982,
    colorbar style={
        width=10cm,
        xticklabel style={tick label style={font=\footnotesize}},
    }]
    % \addplot [draw=none] coordinates {(0,0)};
\end{axis}
\end{tikzpicture}
\caption[Simulation retardation]{Mean retardation.}
% \label{fig:sim_fyjsrg}
\end{figure}
% 
\begin{figure}[!p]
\centering
\includegraphics[width=\textwidth, ]{dev/rc1/analysis/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_trans_mean.pdf}
% colorbar
\tikzset{external/export next=false}
\begin{tikzpicture}
\begin{axis}[
    hide axis,
    scale only axis,
    height=0pt,
    width=0pt,
    colormap name=cividis,
    colorbar horizontal,
    point meta min=999,
    point meta max=1113,
    colorbar style={
        width=10cm,
        xtick={1000, 1020, 1040, 1060, 1080, 1100},
        xticklabel style={tick label style={font=\footnotesize}},
    }]
\end{axis}
\end{tikzpicture} 
\caption[Simulation transmittance]{Mean transmittance value.}
% \label{fig:sim_fyjsrg}
\end{figure}
% 
\begin{figure}[!p]
\centering
\includegraphics[width=\textwidth, ]{dev/rc1/analysis/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_rdir_mean.pdf} 
% colorbar
\tikzset{external/export next=false}
\begin{tikzpicture}
\begin{axis}[
    hide axis,
    scale only axis,
    height=0pt,
    width=0pt,
    colormap name=cividis,
    colorbar horizontal,
    point meta min=0,
    point meta max=180,
    colorbar style={
        width=10cm,
        xticklabel style={tick label style={font=\footnotesize}},
    }]
\end{axis}
\end{tikzpicture}
\caption[Simulation direction]{Circmean direction from tilt analysis.}
% \label{fig:sim_fyjsrg}
\end{figure}
% 
\begin{figure}[!p]
\centering
\includegraphics[width=\textwidth, ]{dev/rc1/analysis/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_rincl_mean.pdf} 
% colorbar
\tikzset{external/export next=false}
\begin{tikzpicture}
\begin{axis}[
    hide axis,
    scale only axis,
    height=0pt,
    width=0pt,
    colormap name=cividis,
    colorbar horizontal,
    point meta min=-90,
    point meta max=90,
    colorbar style={
        width=10cm,
        xticklabel style={tick label style={font=\footnotesize}},
    }]
\end{axis}
\end{tikzpicture}
\caption[Simulation inclination]{Circmean inclination from tilt analysis.}
\caption[sim]{rofl incl mean  \dummy{}}
% \label{fig:sim_fyjsrg}
\end{figure}
% 
\begin{figure}[!p]
\centering
\includegraphics[width=\textwidth, ]{dev/rc1/analysis/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_rtrel_mean.pdf} 
% colorbar
\tikzset{external/export next=false}
\begin{tikzpicture}
\begin{axis}[
    hide axis,
    scale only axis,
    height=0pt,
    width=0pt,
    colormap name=cividis,
    colorbar horizontal,
    point meta min=0,
    point meta max=0.55,
    colorbar style={
        width=10cm,
        xticklabel style={tick label style={font=\footnotesize},
                          /pgf/number format/.cd,fixed,fixed zerofill, precision=2,},
    }]
\end{axis}
\end{tikzpicture}
\caption[Simulation \trel{}]{Mean \trel{} from tilt analysis.}
% \label{fig:sim_fyjsrg}
\end{figure}
% 
\subsection{repo}
% 

\subsection{speedup}
% 
\begin{figure}[!t]
\centering
\setlength{\tikzwidth}{0.85\textwidth}
\begin{tikzpicture}[baseline, trim axis left, trim axis right]
\begin{axis}[%
table/col sep=comma,
width=\tikzwidth,
height=0.5\tikzwidth,
axis lines=center,
scale only axis,
xlabel={\small cpus},
ylabel={\small speedup},
xticklabel style={font=\footnotesize},
yticklabel style={font=\footnotesize},
y label style={at={(axis description cs:0,.85)},rotate=90,anchor=north},
cycle multiindex* list={mark list*\nextlist Dark2\nextlist},
]
\addplot+[only marks] table[x index=1, y index=3] {dev/rc1/speed/generate_tissue_v_0.1.dat};
\addplot[black, dashed] coordinates {(1,1) (24,24)} node[pos=0.9, sloped, anchor=south] {ideal};
\end{axis}
\end{tikzpicture}
\caption[]{speedup discrete tissue generation. \itodo{einheitlicher style}}
\end{figure}
% 
% 
\begin{figure}[!t]
\centering
\setlength{\tikzwidth}{0.85\textwidth}
\begin{tikzpicture}[baseline, trim axis left, trim axis right]
\begin{axis}[%
table/col sep=comma,
width=\tikzwidth,
height=0.5\tikzwidth,
axis lines=center,
scale only axis,
xlabel={\small cpus},
ylabel={\small speedup},
xticklabel style={font=\footnotesize},
yticklabel style={font=\footnotesize},
cycle multiindex* list={
    mark list*\nextlist
    Dark2\nextlist
},
]
\addplot+[only marks] table[x index=1, y index=8] {dev/rc1/speed/simulation_v_0.1.dat}; \addlegendentry{flat}
\addplot+[only marks] table[x index=1, y index=9] {dev/rc1/speed/simulation_v_0.1.dat}; \addlegendentry{W}
\addplot+[only marks] table[x index=1, y index=10] {dev/rc1/speed/simulation_v_0.1.dat}; \addlegendentry{S}
\addplot+[only marks] table[x index=1, y index=11] {dev/rc1/speed/simulation_v_0.1.dat}; \addlegendentry{E}
\addplot+[only marks] table[x index=1, y index=12] {dev/rc1/speed/simulation_v_0.1.dat}; \addlegendentry{N}
\addplot[black, dashed] coordinates {(1,1) (32,32)} node[pos=0.9, sloped, anchor=south] {ideal};
\end{axis}
\end{tikzpicture}
\caption[]{Speedup simulation for 5 tilt direction. \itodo{einheitlicher style}}
\end{figure}
% 
\section{summary/discussion}
% 
%  
% 
\begin{figure}[!p]
\centering
\includegraphics[width=1\textwidth]{dev/rc1/cube_2pop_135_rc1_radius_acc_compare_Vervet_PM_r.pdf}
\caption[sim acc]{ $\acc{}(GT,GT_{0.5})$, $\acc{}(SIM,GT_{0.5})$ and $\acc{}(SIM,SIM_{0.5})$. hypothese: abweichungen in GtSim bei kleinen radien dadurch, dass zwei richtungen nicht sichtbar sind? schaue dir die histogramme und odfs an. \itodo{komplett neu machen}}
\label{fig:accVervetPMr}
\end{figure}
% 
