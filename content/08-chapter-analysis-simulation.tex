\setcounter{chapter}{7}
\chapter{Simulation}
\label{cha:simulation_analysis}
% \minitoc
% 
% 
% 
This chapter contains focuses on the simulation of \ac{3D-PLI}.
The first part focuses on the definition of all necessary parameters.
A part of this is to determined how accurate the simulation has to be, i.e. the voxel size.
Following this, these parameters are used to simulate the previously generated models.
A focus is placed on the accuracy of tilt analyses for different orientations and crossing configurations.
% 
% 
% 
\itodo{reproduzieren von modellen}
% 
% 
% 
\section{Experimental Parameters}\label{sec:sim_choose_parameters}
% 
\subsection{optical resolution}
% 
An optical microscope has a certain resolution. This is often defined in the literature by Abbe diffraction limit. Ernst Abbe found out that the resolution of a light microscope is related to the wavelength of the light $\lambda$:
\begin{align}
d=\frac{ \lambda}{2 n \sin \theta} = \frac{\lambda}{2\mathrm{NA}}
\end{align}
.
$d$ is the minimal resolvable distance, $n$ the refcative index, $\theta$ the angle of a spot light. Further $n \sin \theta$ is better known as the numerical aperture $\mathrm{NA}$.
However, this only sets the maximum resolution. 
Every optical microscope has imaging errors.
The most common are lens aberration, chromatic aberration, ...
All these errors lead to a reduced resolution.
In addition, the sensor that captures the image also plays a role.
For a ccd sensor, this is the configuration of the pixels and their size.
% 
Mathematically, a resolution reduction of an image is modeled by a convolution with a Gaussian function of width $\sigma$.
It effectively blends the information into its roundness and thus onto the neighboring pixels.
It is also known as point spread function.
%
Therefore, the resolution must be determined for each experimental setup.
For this purpose, the USAF test chart is very often used to characterize the resolution of an optical image setup.
It consists of several patterns which have three slits with defined distances and widths.
The resolution can then be determined using the Rayleigh criterion, for example.
\par
% 
% 
\begin{figure}[!t]
\centering
\setlength{\tikzwidth}{0.5\textwidth}
\begin{tabular}{cc}
\inputtikz{dev/gfx/chap8/usaf_image}
&
\inputtikz{dev/gfx/chap8/usaf_line_plots}
\\
\begin{minipage}{0.45\textwidth}
\leavevmode\subcaption{\label{fig:usaf_image}microscopic image}
\end{minipage}&
\begin{minipage}{0.45\textwidth}
\leavevmode\subcaption{\label{fig:usaf_lines}centered line plots. \itodo{single line plots not good}}
\end{minipage}
\end{tabular}
\caption[USAF test chart measurement]{taorad pm. Line width: magenta: $\SI{2.19}{\micro\meter}$, yellow $\SI{1.95}{\micro\meter}$ and cyan $\SI{1.74}{\micro\meter}$. Resolution at about $\SI{1.95}{\micro\meter}$ yielding to an optical convolution of $\opticsigma = \SI{0.75}{\pixel}$.}
\label{fig:USAF}
\end{figure}
% 
\Cref{fig:usaf_image} shows a section of a captured PM image.
The highlighted areas show the key regions.
The first region corresponding to group \textrm{7\text{-}6} \raisebox{.25em}{\tikzset{external/export next=false}\tikz \draw[magenta,ultra thick,dashed](0,0)--(0.25,0);} has a line width of $\SI{2.19}{\micro\meter}$.
The second group \textrm{8\text{-}1} \raisebox{.25em}{\tikzset{external/export next=false}\tikz \draw[yellow,ultra thick,dashed](0,0)--(0.25,0);} has a line width of $\SI{1.95}{\micro\meter}$.
The final group \textrm{8\text{-}2} \raisebox{.25em}{\tikzset{external/export next=false}\tikz \draw[cyan,ultra thick,dashed](0,0)--(0.25,0);} has a line width of $\SI{1.74}{\micro\meter}$.
The intensity line profiles are shown in \cref{fig:usaf_lines}.
% 
Using the Rayleigh criterion, the resolution is in the range of the second group and thus around $\SI{1.95}{\micro\meter}$.
This reproduces the previous measurements in \cite{menzel_finite-difference_2018} \todo{master thesis?}.
As a result, the convolution to be applied is set to $\opticsigma = \SI{0.75}{\pixel}$ in the size of the resulting image pixel.
% 
% 
% 
\subsection{sensor gain}\label{sec:sensorGain}
%
\begin{figure}[!t]
\centering
\def\tikzwidth{0.75\textwidth}
\inputtikz[true]{gfx/pli/pli_focus}
\caption[intensity setup]{intensity setup. \itodo{check schematic}}
\label{fig:intensityFocus}
\end{figure}
% 
\begin{figure}[!t]
% thesis/2_simulation/0_parameter/sensor_gain.py
\centering
% 





\begin{tabular}{cc}
% 
% 1. IMAGE
\begin{tikzpicture}[baseline, trim axis left, trim axis right]
\begin{axis}[
width=0.45\textwidth,
height=0.45\textwidth,
point meta min=0,
point meta max=1670,
xmin=0,xmax=1,
ymin=0,ymax=1,
% 
hide axis,
% axis lines=center,
% % yticklabels={,,},
% axis line style={draw=none},
% tick style={draw=none},
% tick label style={gray},
% 
colorbar left,
colormap/gray,
colorbar style={%
    % axis line style={draw=none},
    % tick style={},
    % tick label style={black},
    every y tick label/.append style={font=\small},
}
% 
]
\addplot [forget plot] graphics [
xmin=0,xmax=1,
ymin=0,ymax=1,
] {dev/gfx/2/PM_000_vmin_0_vmax_1670.png};
\end{axis}
\end{tikzpicture}
&
% 
% 2. IMAGE
\begin{tikzpicture}[baseline, trim axis left, trim axis right]
\begin{axis}[%
width=0.45\textwidth,
height=0.45\textwidth,
% axis on top,
axis lines=center,
xlabel={x-pos},
ylabel={intensity},
]
\addplot[mark=none, blue] table[x index=0, y index=1] {dev/gfx/2/PM_000.dat};
\end{axis}
\end{tikzpicture}
\\
% 
% SUBCAPTIONS
\multicolumn{1}{l}{
\begin{minipage}{0.45\textwidth}
\leavevmode\subcaption{\label{fig:intensityImage}single microscopic image}
\end{minipage}}
&
\multicolumn{1}{l}{
\begin{minipage}{0.45\textwidth}
\leavevmode\subcaption{\label{fig:intensityProfile}intensity profile.}
\end{minipage}}
\end{tabular}
% 
\caption[intensity image]{y-mean intensity profile}
\label{fig:intensityMeasurement}
\end{figure}
% 
% 
\begin{figure}[!t]
% thesis/2_simulation/0_parameter/sensor_gain.py
\centering
\includegraphics[width=0.75\textwidth]{dev/gfx/2/PM_noise.png}
\caption[Noise analysis]{Noise analysis PM. $\opticgain_{\mathit{PM}} = \SI{0.1175}{}(?)$. \itodo{replot, also show microscope image}}
\label{fig:parameterModelSimGain}
\end{figure}
% 
As described in \cref{sec:ccdOptic} the optical noise has to be applied by a noise model.
In \cite{Wiese:887678} Hendrik Wiese measured the noise gain factor of the \ac{LAP} setup by measuring multiple times an image with a varieties of intensity values.
The same type of measurement and analysis is performed here on the \ac{PM} setup.

The measurements consist out of multiple images $(N=?)$. The specimen stage is covered with a fully absorbing cover, so that half of the image is dark.
Additionally the focal length is change in such a way, that the light is spread over the hole image sensor depide of the cover.
This allows to measure the full variance of intensities (see \cref{fig:intensityImage}).

The results are shown in \cref{fig:parameterModelSimGain} and show a gain value of $\opticgain_{\mathit{PM}} = \SI{0.1175}{}(?)$ which is agreement to the hardware specifics \todo{check and ref}.
% 
% 
% 
\subsection{Tissue properties}\label{sec:tissueProp}
% 
\begin{figure}[!t]
\centering
\def\tikzwidth{0.5\textwidth}
\begin{tabular}{l}
% 
\multicolumn{1}{c}{\inputtikz{gfx/data/vervet_transmittance}}
\\
\begin{minipage}{\textwidth}
\leavevmode\subcaption{\label{fig:brain_trans}transmittance}
\end{minipage}
\\
\multicolumn{1}{c}{\inputtikz{gfx/data/vervet_retardation}}
\\
\begin{minipage}{\textwidth}
\leavevmode\subcaption{\label{fig:brain_ret}retardation}
\end{minipage}
% 
\end{tabular}
\caption[Vervet monkey coronal section transmittance and retardation]{%
Vervet monkey coronal section $\SI{549}{}$.
a) transmittance, b) retardation.
The absorption coefficient and birefingence strength can be estimated from flat fibers.
Two \acsp{ROI} with \dummy{} pixels are annotated for this purpose.
\itodo{histograms?, why these two rois?}}
\label{fig:brain_ret_trans}
\end{figure}
% 
% 
\begin{figure}[!tp]
\centering
% \subcaptionbox{\label{fig:simTransValues}transmittance\itodo{WRONG IMAGE}}[.95\textwidth]{
% \includegraphics[width=0.95\textwidth]{dev/gfx/2/transmittance_PM_Vervet.pdf}} %\hfill
% \subcaptionbox{\label{fig:simRetValues}retardation}[.95\textwidth]{
\includegraphics[width=0.95\textwidth]{dev/gfx/2/retardation_PM_Vervet.pdf}
% }
\caption{simulations for Vervet PM tissue for different absorption coef and birefringence values.}
\label{fig:parameterModelSim}
\end{figure}
% 
The absorption coefficient $\absorp{}$ and the birefringence $\dn{}$ have to be estimated from the tissue to use suitable values within the simulation.
As the literature shows, these values are in the range of ... $\d{}$.
However, since the models generated here use stiff fiber segments, the volume density cannot reach as high values as in the elastic tissue.
To overcome this effect, the absorption and birefringence strengths must be increased to achieve comparable results.
\par
% 
To achieve this, the two components are measured in the experiment.
It is important to ensure that a homogeneous region is chosen.
In a coronal section, the corpus callosum is suitable for this purpose. It is the main fiber connection between the two cerebral hemispheres.
A problem with transmission is that scattering cannot be distinguished from actual absorption in this setup.
However, since this property is mathematically the same, namely a reduction in intensity along the tissue, it can still be used, but it must be remembered that it is the outdated "absorption" and not just the loss of energy in the tissue.
Additionally, the scattering is not constant for all fiber configurations and orientations \dummy{}.
Therefore, the value measured here is only valid for the same fiber configurations as the region.
However, it should be a good estimate for the magnitude of absorption in the tissue, which, as will be shown later in the simulation, is sufficient.
% 
\Cref{fig:parameterModelSim} shows a coronal section of the Vervet monkey brain \dummy(section number 549, aber was ist zu sehen, ist es in der mitte?, ...).
% 
To get a approximation of the parameters the models with a radius of $r=\SI{0.5}{\micro\meter}$ are used, which is closed to the real tissue.
% 
% 
% 
\paragraph{absorption}
% 
A relative transmittance of about $\SIrange{20}{30}{\percent}$ is present inside the \ac{ROI} of the corpus callosum \todo{show histogram}. 
The simulation parameter has to be set such as that for the models a similar transmittance value is reached.
This means, that for a $\SI{60}{\micro\meter}$ thick section the absorption coefficient $\absorp{}$ is about $\SI{30}{}$. 
Since the absorption shell be the same for larger fibers to yield the same noise and it cannot be distingioust between "no fiber matter i.e. background" and fibers the absorption coeeficient cannot be measured, and therefore the absorption will be multiplied after the simulation on the hole image. The absorption for the Roden is $\SI{8}{}$, and the human $\SI{65}{}$.

% However considering, that statistically only $\SI{75}{\percent}$ of the volume is filled, the simulation parameter has to be \dummy{}.
% \Cref{fig:simTransValues} shows different transmittance vales for different types of radii.
% 
% \ITODO{transmittance is twice as high as it should be !!! -> increase absorption coeeficient, ich glaube ich habe das bereits ersetzt}

% For r=0.5 and a Vfraction of 0.75 mu\_vervet = 30, mu\_human = 65, mu\_roden = 8
% % 
% % This yield to a absoprtion coefficient $\absorp_\textit{Vervet} = \SI{20}{\per\micro\meter}$. For the human and mouse a value of $\absorp_\textit{human} = \SI{50}{\per\micro\meter}$ and $\absorp_\textit{mouse} = \SI{10}{\per\micro\meter}$ is measured.
% 
%
% 
\paragraph{birefringence}
% 
Literature measured a birefringence of nerve fibers of around \dummy{}. 
% Scince for this simulations the models are rigide and therefore are spatially farer away from each other, this means that the tissue density is lower than in reality.
% Therefore to reach similar retardation values the birefringence value has to be increased.
To analyse the effect of the lower desity inside the models, the birefringence values is simulated at a voxel size of $\SI{0.125}{\micro\meter}$ at different values.
The results in \cref{fig:parameterModelSim} show that to reach a retardation value similar to the experimental setup of around $\SI{0.8}{}$ a birefringence value of $\SI{-0.004}{}$ for a macroscopic and $\SI{0.008}{}$ for the microscopic model should be chosen.
This is around factor 2 \todo{check} higher than literatur.
However keeping the lower density in mind and the effect of a fixed myelin radii model of $\SI{75}{\percent}$ this is still in agreement.
Looking at the different model nerve fiber radii the variance of the retardation values increase strong.
This is to be expected since the simulated tissue section has a hight of $\SI{60}{\micro\meter}$.
Therefore for a radii of $\SI{10}{\micro\meter}$ the number of tissue voxels has to vary depending on where the fibers are positioned in the volume.
For larger radii this can lead to an reduction of retardation due to the $\sin(...)$ ambiguity.
That is also the reason why the values are non normal distributed between $\si{0}$ and $\si{1}$.
%  
% 
% 
\subsection{noise}
% 
\begin{figure}[!t]
\centering
\inputtikz{gfx/data/theo_noise}
\caption[noise plot]{noise \dummy{}}
\label{fig:noiseplot}
\end{figure}
% 
From \cref{sec:sensorGain,sec:tissueProp} the noise level can be calculated.
However, when considering the different species, it is important to note that transmittance levels vary.
Rodents typically have the highest transmittance, monkeys have a lower transmittance, and humans have the lowest transmittance.
The reason for the rather low transmission of the human sections is probably due to the long post-mortem period.
\Cref{fig:noiseplot} shows a log-log plot for this purpose.
To run the simulation, a relative error of \dummy{} is used for a midrange analysis.
% 
% 
% 
\subsection{voxel size \texorpdfstring{\voxels{}}{}}
% 
% 
\begin{figure}[!tp]%p
% 2_simulation/0_parameter/fiber_radii.py
\centering
\includegraphics[width=\textwidth, page=4]{dev/gfx/2/voxel_size_plots_data_1.pdf}
\caption[voxel size model with noise]{1. $(\modelOmega=0, \modelPsi=1, \modelInc=0)$, 2. $(\modelOmega=0, \modelPsi=1, \modelInc=90)$, 3. $(\modelOmega=90, \modelPsi=0.5, \modelInc=0)$, 4. $(\modelOmega=90, \modelPsi=0.5, \modelInc=90)$: the mean difference between the Signal $\mean(\intensity(\voxels_{\mathit{ref} = \SI{0.0125}{\micro\meter}, \fiberRadius})- \intensity(\voxels, \fiberRadius))$. The mean difference is constant for smaller voxel sizes and does not start to grow significantly before $\voxels=\SI{0.125}{\micro\meter}$. \itodo{labels}}
\label{fig:voxelsizeNoise}
\end{figure}
% 
The voxel size \voxelsize{} is the main parameter for simulation accuracy.
Smaller values mean more details, more accurate optical axes, more light rays.
However, it also means an increase in memory by $O(n^3)$.
Therefore, it is advisable to choose the voxel size as small as possible, with reasonable results.
\par
% 
To investigate this effect, a simulation is performed with different types of voxel sizes from the $\SIrange{0.0125}{1.25}{\micro\meter}$.
The smallest voxel size $\SI{0.0125}{\micro\meter}$ is used as ground truth or comparison. 
However, this voxel size is so small that this is only performed for a single tissue section. \todo{which?, how much memory, ...}
The pixel size \pixelsize{} will be set to $\SI{1.25}{\micro\meter}$. \todo{other parameters}
\par
%
The results  in \cref{fig:voxelsizeNoise} show that the relative difference to the smallest \voxelsize{} increase statically after a value of \SI{0.125}{\micro\meter}.
The variance of the relative difference increases with the radius of the models as well as with the \voxelsize{}.\todo{was sind die vier unterschiedlichen plots?}
% 
In summary:
The results shown in \cref{fig:voxelsizeNoise} indicate that for noise, a voxel size smaller than $\SI{0.125}{\micro\meter}$ does not increase the accuracy with respect to the noise model chosen here.
However, this is only true for a pixel size of $\SI{1.25}{\micro\meter}$.
% 
% 
% 
\subsection{Fiber radii}
% 
\begin{figure}[!t]
\centering
\includegraphics[width=1\textwidth]{dev/gfx/sim_cube/radius_acc_compare_Vervet_PM_r.pdf}
\caption[sim acc]{ $\acc{}(GT,GT_{0.5})$, $\acc{}(SIM,GT_{0.5})$ and $\acc{}(SIM,SIM_{0.5})$. hypothese: abweichungen in GtSim bei kleinen radien dadurch, dass zwei richtungen nicht sichtbar sind? schaue dir die histogramme und odfs an. \itodo{komplett neu machen}}
\label{fig:accVervetPMr}
\end{figure}
% 
The last parameter to investigate is the fiber radius $\fiberRadius{}$ of the models.
The anatomical closes value is of course $\fiberRadius{} = \SI{0.5}{\micro\meter}$.
However to allow faster modelling processen it is feasable to analyse with which radius a difference is visiable in the microscopic setup.
To investigate this behavior the distribution of the orientation of the fiber segments was analysed.
\par
% 
\paragraph{results}
\Cref{fig:accVervetPMr} shows the ACC(GT0.5 to GT difference between the orientation of the models of different radii (always to $\fiberRadius{} = \SI{0.5}{\micro\meter}$).
the second shows the ACC(GT0.5 to SIM) and the last $\acc{}(SIM,SIM_{0.5})$.
% 
The first plot shows a very close correspondence between the GT of different radii (see y scala).
For more intermixed fiber populations (\modelPsi{} closer to $\SI{0.5}{\micro\meter}$) as well as crossing angle \modelOmega{} the \acc{} decreases slightly.
Overall the difference is almost negligible.
\par
%
Plot 2 shows a different result for the comparison between the $GT$ and $SIM$.
Here only fiber populations \modelPsi{} close to $\SI{0}{}$ or $\SI{1}{}$ have a high agreement for smaller fiber radii \fiberRadius{}.
The \acc{} decreeses with incrasing radii \fiberRadius{} down to a value of $\approx \SI{0.7}{}$.
Fiber populations with \modelPsi{} closer to 0.5 have a very low ACC parameter. For the 0.6 case the \acc{} increases slightly for increasing radii up to acc=0.6.
The crossing angle has a high impact on the acc value. 
% 
\paragraph{...}
Looking at the results from the $acc(GT,GT_{0.5})$ and $\acc{}(SIM,SIM_{0.5})$ of course $\fiberRadius=\SI{0.5}{\micro\meter}$ has a \acc{} of $\SI{0}{}$ since they are identical.
On the other hand $acc(GT,SIM_{0.5})$ shows for $\fiberRadius=\SI{0.5}{\micro\meter}$ the smallest values and highest variance for \acc{} since the fiber crossing leads to a low retardation and therefore signal lost and the analysis can't measure the in... signal.
% 
From the first and last plot show that a fiber radii of \SI{1}{\micro\meter} seems to have a little impact on the model and simulation side.
After that the simulation comparison \acc{}\todo{check if acc is defined.} value sinks drastically for fiber populations close to %\fiberPsi=\SI{0.5}{}$.
% 
The behavior between the ground truth $GT$ and and simulation $SIM$ will be closely examined in the next section.
\par
\noindent\rule{\textwidth}{2pt}
% 
\newpage
% 
% 
% 
\section{Simulation}
% 
\begin{enumerate}
\item $r=0.5$ or fabric tissue 
\begin{enumerate}
\item eine population:
\begin{enumerate}
    \item verhalten von transmittance, direction und retardierung wie model
    \item verteilung von orientierung SIM zu GT
\end{enumerate}
% 
\item zwei population:
\begin{enumerate}
    \item verhalten von transmittance, direction und retardierung wie model
    \item analyse signal ohne rauschen, zeigt rofl eine abweichung?
    \item verteilung von orientierung SIM zu GT (odf oder histogram?)
    \item groese "dunkler" Bereich
\end{enumerate}
\end{enumerate}
% 
\item $r > 0.5$ oder "fiberbundle":
\begin{enumerate}
\item zwei populationen
\begin{enumerate}
    \item verhalten von seeded fiber bundles zu solid fiber bundles
    \item sichtbarkeit von zwei orientierungen
\end{enumerate}
\end{enumerate}
% 
\item misc
\begin{enumerate}
    \item speed test
\end{enumerate}
% 
\item future discussions
\begin{enumerate}
    \item n-fiber populations
    \item fiber bundles of different radii
    \item fiber bundles with volume compressing solving steps
\end{enumerate}
\end{enumerate}
% 
% 
% 
\subsection{Parameters and execution}
% 
\begin{table}[!b]
\centering
\sisetup{open-bracket={\{}, close-bracket={\}}, list-final-separator={,},list-pair-separator={,}}%
\pgfplotstabletypeset[%
    thesisTableStyle,
    column type=l,
    columns/variable/.style={string type},
    columns/value/.style={string type},
    every head row/.style={before row=\toprule,after row=\midrule},
    every last row/.style={after row=\bottomrule},
    col sep=&,
    row sep=\\,
]
{variable & value\\
% 
simpli.voxel\_size & $\SI{0.125}{\micro\meter}$\\
simpli.pixel\_size & $\SI{1.25}{\micro\meter}$\\
simpli.voi & $[\SI{-30}{\micro\meter}, \SI{-30}{\micro\meter}, \SI{-30}{\micro\meter}], [\SI{30}{\micro\meter}, \SI{30}{\micro\meter}, \SI{30}{\micro\meter}]$\\
simpli.filter\_rotations & $\SIlist{0;20;40;60;80;100;120;160}{\degree}$\\
simpli.interpolate & \texttt{"Slerp"}\\
simpli.wavelength & $\SI{525}{\nano\meter}$\\
simpli.optical\_sigma & $\SI{0.75}{\pixel}$\\
tilt & $\SI{3.9}{\degree}$\\
simpli.light\_intensity & $\SI{8000}{}$\\
gain & $\SI{0.1175}{}$\\
% simpli.noise\_model & \texttt{lambda x:np.round(np.random.normal(x,np.sqrt(gain * x))).astype(np.uint16)}\\
simpli.noise\_model & \texttt{lambda x:np.round(np.random.normal(}\\
 & \ \ \ \ \ \texttt{x,np.sqrt(gain * x))).astype(np.uint16)}\\
fiber absorption & ('Roden', 8), ('Vervet', 30), ('Human', 65)\\
fiber model & 'r'\\
fiber birefringence & 0.008 for 'r'\\
fiber radii & (0.75, 1)\\
}
\caption{simpli parameters. \itodo{absorption ist volumenweit, nicht nur in faser}}
\label{tab:simParameters}
\end{table}
% 
% 
\Cref{tab:simParameters} lists the parameters of the simulation inside the \fastpli{} variable notation.
The values are chosen due to the discussion of \cref{sec:sim_choose_parameters}.
% 
\subsubsection{Execution}
% 
As described in \cref{Software} \fastpli{} contains a pipeline implementation. \dummy{}.
This implementation is used to calculate the discretized volumes (from generator), simulate the signal, performing the optical noise and analysis the resulting signal with \rofl{}\footnote{Source code is available in appendix \dummy{}.}.
\\
% 
The simulation were performed with a single compute node (\texttt{2x Intel(R) Xeon(R) CPU E5-4657L v2}).
% 
% 
% 
\subsection{single fiber population}
% 
In the case of a single fiber population only the inclination parameter $\modelInc{}$ is ... since no rotation and crossing angle exists.
\itodo{mehr inclination winkel fuer diesen Fall? -> JA}
% 
% 
% 
\subsubsection{orientation distribution}
% 
\begin{figure}[!tp]
\centering
\includegraphics[height=0.8\textheight]{dev/gfx/sim_cube/sim_plots_single_pop_hist.pdf} 
\caption[sim]{left: 2d log histogramm orientation from rofl analysis of simulation, right: 2d log histogramm of orientation of model segemnts. \dummy[auch als odf moeglich, aber schlechter vergeichbar; vieleicht contourplots von GT]{}}
\label{fig:single_fiber_pop_hist}
\end{figure}
% 
% 
% 
\begin{figure}[!tp]
\centering
\subcaptionbox{\label{fig:single_fiber_pop_epa_trans}transmittance}[.32\textwidth]{
\includegraphics[width=0.3\textwidth]{dev/gfx/sim_cube/sim_plots_single_pop_epa_trans.pdf}}\hfill
\subcaptionbox{\label{fig:single_fiber_pop_epa_dir}direction}[.32\textwidth]{
\includegraphics[width=0.3\textwidth]{dev/gfx/sim_cube/sim_plots_single_pop_epa_dir.pdf}}\hfill
\subcaptionbox{\label{fig:single_fiber_pop_epa_ret}retardation}[.32\textwidth]{
\includegraphics[width=0.3\textwidth]{dev/gfx/sim_cube/sim_plots_single_pop_epa_ret.pdf}}
\caption[]{\dummy[single population modalities; colors left to right: 0, 30, 60, 90 degree inclination; line: theoretical curve]{}}
\label{fig:single_fiber_pop_epa}
\end{figure}
% 
\begin{figure}[!tp]
\centering
\subcaptionbox{\label{fig:single_fiber_pop_rofl_dir}rofl direction}[.32\textwidth]{
\includegraphics[width=0.3\textwidth]{dev/gfx/sim_cube/sim_plots_single_pop_rofl_dir.pdf}}\hfill
\subcaptionbox{\label{fig:single_fiber_pop_rofl_inc}rofl inclination}[.32\textwidth]{
\includegraphics[width=0.3\textwidth]{dev/gfx/sim_cube/sim_plots_single_pop_rofl_inc.pdf}}\hfill
\subcaptionbox{\label{fig:single_fiber_pop_rofl_trel}rofl trel}[.32\textwidth]{
\includegraphics[width=0.3\textwidth]{dev/gfx/sim_cube/sim_plots_single_pop_rofl_trel.pdf}}
\caption[]{\dummy[single population rofl analysis; colors left to right: 0, 30, 60, 90 degree inclination; line: theoretical curve]{}}
\label{fig:single_fiber_pop_rofl}
\end{figure}
% 
\Cref{fig:single_fiber_pop_hist} shows the 3d fiber orientation distribution of the simulated (left) and the model ground truth (right) as a 2d polar log histogram.
The number of pixels is $48\cdot48=\SI{2304}{\pixel}$.
Looking at the simulation distribution for inclinations lower than $\SI{60}{\degree}$ the variance is very small.
It is similar to the variance of the ground truth \todo{number of segments in 60µm cube}.
However since the number of segments is much higher, and the simulation results from the "mean" signal of the light path, its distribution contains also many more orientations (keeping in mind the log scale).
Only for the steep fibers with an inclination of $\modelInc{}=\SI{90}{\degree}$ different orientation are visible for the simulation results.
The variance is similar to the ground truth of the model segments.
% 
% 
\subsubsection{pli-modalities}
% 
% 
% 
% 
\subsection{two fiber populations}
\subsection{filled fiber populations}
\subsection{misc}
\section{summary/discussion}
% 
% 
% 
% % \subsection{expected results}
% % 
% % 
% % 
% \subsection{Results}
% % 
% \itodo{other results?}
% \begin{itemize}
% \item noise(omega, gamma, ...)
% \item second orientation visible?
% \item absolute birefringence, transmittance, absorption as a f(omega)
% \item trel? abnahme der doppelbrechnung in flachen faser, bzw gegenüber f0?
% \end{itemize}
% % 
% % 
% % 
% \subsection{Retardation comparison}
% % 
% \begin{figure}[!t]
% \centering
% \inputtikz{dev/gfx/sim_cube/data_rofl}
% % \includegraphics[width=0.75\textwidth]{example-image} 
% \caption[data vs rofl]{data vs rofl}
% \label{fig:dataVsRofl}
% \end{figure}
% \itodo{show sinus plot of single pixel}
% % 
% % \begin{figure}[!tp]
% % \centering
% % \includegraphics[width=\textwidth]{dev/gfx/sim_cube/simulation_retardation_PM_Vervet_r.pdf}
% % % 
% % \begin{tikzpicture}
% %  \begin{axis}[
% %  scale only axis, width=0pt, height=0pt, hide axis,
% %  tick label style={/pgf/number format/.cd, fixed},
% %  colorbar,colormap/viridis high res,
% %  point meta min=0,
% %  point meta max=1,
% %   colorbar horizontal,
% %   colorbar style={width=0.75\textwidth},
% %   ]%
% %   {};
% %  \end{axis}
% % \end{tikzpicture}
% % % 
% % \caption[simulation results retardation]{0.5, PM, Vervet, r, retardation  \dummy{}}
% % \label{fig:sim_retardation_05_PM_Vervet_r}
% % \end{figure} 
% % 
% % 
% % 
% \subsection{Orientation comparison}
% % 
% \begin{figure}[!tp]
% \centering
% \includegraphics[width=\textwidth, trim = 115 50 115 0, clip]{dev/gfx/sim_cube/tissue_overlay_PM_Vervet_r_0.60_60.00_10.00_30.00_0.00_.pdf} 
% \caption[sim]{\dummy{}}
% \label{fig:sim_fyjsrg}
% \end{figure}
% % 
% % 
% % 
% % 
% \begin{figure}[!tp]
% \centering
% \includegraphics[height=0.8\textheight]{dev/gfx/sim_cube/test_r_0.5_species_Vervet_microscope_PM_model_r_inc_0.00_rot_0.00.pdf} 
% \caption[sim]{\dummy{}}
% \label{fig:sim_matrix_0}
% \end{figure}
% % 
% % 
% % 
% % 
% \begin{figure}[!tp]
% \centering
% \includegraphics[height=0.8\textheight]{dev/gfx/sim_cube/test_r_0.5_species_Vervet_microscope_PM_model_r_inc_90.00_rot_0.00.pdf} 
% \caption[sim]{\dummy{}}
% \label{fig:sim_matrix_90}
% \end{figure}
% % 
% % 
% % 
% % \begin{figure}[!t]
% % \begin{tikzpicture}[trim axis left, baseline]
% % \begin{axis}[%
% %     axis equal,
% %     axis lines = center,
% %     axis line style={opacity=0.0},
% %     ticks=none,
% %     view/h=145,
% %     scale uniformly strategy=units only,
% %     clip=false, % hide axis,
% %     width=10cm,
% %     height=10cm,
% %     xmin=-1,xmax=1,
% %     ymin=-1,ymax=1,
% %     zmin=-1,zmax=1,
% %     point meta min=0, point meta max=1,
% %     colormap/viridis,
% % ]
% % \addplot3[%
% %     surf,
% %     shader=interp,
% %     z buffer=sort,
% %     mesh/color input=explicit,
% %     ]
% %  table[x=x,y=y,z=z,
% %         meta=rgb,
% %         ] {dev/gfx/sim_cube/cube_2pop_psi_0.60_omega_60.00_r_10.00_v0_120_.solved_vs_0.1250_inc_30.00_rot_0.00_PM_Vervet_r.gt.dat};
% % \end{axis}
% % \end{tikzpicture}
% % \begin{tikzpicture}[trim axis left, baseline]
% % \begin{axis}[%
% %     axis equal,
% %     axis lines = center,
% %     axis line style={opacity=0.0},
% %     ticks=none,
% %     view/h=145,
% %     scale uniformly strategy=units only,
% %     clip=false, % hide axis,
% %     width=10cm,
% %     height=10cm,
% %     xmin=-1,xmax=1,
% %     ymin=-1,ymax=1,
% %     zmin=-1,zmax=1,
% %     point meta min=0, point meta max=1,
% %     colormap/viridis,
% % ]
% % \addplot3[%
% %     surf,
% %     shader=interp,
% %     z buffer=sort,
% %     mesh/color input=explicit,
% %     ]
% %  table[x=x,y=y,z=z,
% %         meta=rgb,
% %         ] {dev/gfx/sim_cube/cube_2pop_psi_0.60_omega_60.00_r_10.00_v0_120_.solved_vs_0.1250_inc_30.00_rot_0.00_PM_Vervet_r.rofl.dat};
% % \end{axis}
% % \end{tikzpicture}
% % % 
% % \caption[odf]{\dummy{}}
% % \label{fig:sim_fyjsrg}
% % \end{figure}
% % 
% % 
% % 
% % 
% \begin{figure}[!tp]
% \centering
% \includegraphics[width=\textwidth]{dev/gfx/sim_cube/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_acc.pdf}
% % 
% \begin{tikzpicture}
%  \begin{axis}[
%  scale only axis, width=0pt, height=0pt, hide axis,
%  tick label style={/pgf/number format/.cd, fixed},
%  colorbar,colormap/viridis high res,
%  point meta min=0,
%  point meta max=1,
%   colorbar horizontal,
%   colorbar style={width=0.75\textwidth,},
%   ]%
%   {};
%  \end{axis}
% \end{tikzpicture}
% % 
% \caption[simulation results acc]{0.5, PM, Vervet, r, acc-distance}
% \label{fig:hist_0.5_setup_PM_s_Vervet_m_r_acc}
% \end{figure}
% % 
% % 
% \begin{figure}[!tp]
% \centering
% \includegraphics[width=\textwidth]{dev/gfx/sim_cube/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_trans_mean.pdf}
% % 
% \begin{tikzpicture}
%  \begin{axis}[
%  scale only axis, width=0pt, height=0pt, hide axis,
%  tick label style={/pgf/number format/.cd, fixed},
%  colorbar,colormap/viridis high res,
%  point meta min=1000.24,
%  point meta max=1109.23,
%   colorbar horizontal,
%   colorbar style={width=0.75\textwidth,},
%   ]%
%   {};
%  \end{axis}
% \end{tikzpicture}
% % 
% \caption[simulation results transmittance]{0.5, PM, Vervet, r, transmittance}
% \label{fig:hist_0.5_setup_PM_s_Vervet_m_r_trans_mean}
% \end{figure}
% % 
% % 
% \begin{figure}[!tp]
% \centering
% \includegraphics[width=\textwidth]{dev/gfx/sim_cube/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_ret_mean.pdf}
% % 
% \begin{tikzpicture}
%  \begin{axis}[
%  scale only axis, width=0pt, height=0pt, hide axis,
%  tick label style={/pgf/number format/.cd, fixed},
%  colorbar,colormap/viridis high res,
%  point meta min=0.016,
%  point meta max=0.798,
%   colorbar horizontal,
%   colorbar style={width=0.75\textwidth,},
%   ]%
%   {};
%  \end{axis}
% \end{tikzpicture}
% % 
% \caption[simulation results ret]{0.5, PM, Vervet, r, retardation}
% \label{fig:hist_0.5_setup_PM_s_Vervet_m_r_ret_mean}
% \end{figure}
% %
% % 
% \begin{figure}[!tp]
% \centering
% \includegraphics[width=\textwidth]{dev/gfx/sim_cube/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_trel_mean.pdf}
% % 
% \begin{tikzpicture}
%  \begin{axis}[
%  scale only axis, width=0pt, height=0pt, hide axis,
%  tick label style={/pgf/number format/.cd, fixed},
%  colorbar,colormap/viridis high res,
%  point meta min=0,
%  point meta max=0.55,
%   colorbar horizontal,
%   colorbar style={width=0.75\textwidth,},
%   ]%
%   {};
%  \end{axis}
% \end{tikzpicture}
% % 
% \caption[simulation results trel]{0.5, PM, Vervet, r, trel}
% \label{fig:hist_0.5_setup_PM_s_Vervet_m_r_trel_mean}
% \end{figure}
% % 
% % 
% \begin{figure}[!tp]
% \centering
% \includegraphics[width=\textwidth]{dev/gfx/sim_cube/test_PM_Vervet_r_0.50_90.00_0.50_0.00_0.00_.pdf}
% \caption[simulation analysis]{\dummy{}}
% \label{fig:PM_Vervet_r_0.50_90.00_0.50_0.00_0.00}
% \end{figure}
% % 
% % 
% \begin{figure}[!tp]
% \centering
% \includegraphics[width=\textwidth]{dev/gfx/sim_cube/test_PM_Vervet_r_0.50_90.00_0.50_0.00_90.00_.pdf}
% \caption[simulation analysis]{\dummy{}}
% \label{fig:PM_Vervet_r_0.50_90.00_0.50_0.00_90.00}
% \end{figure}
% % 
% % 
% % 
% % \subsubsection{LAP}
% % % 
% % -> discussion
% % 
% % 
% % 
% \section{Computational speed}
% % 
% % 
% % 
