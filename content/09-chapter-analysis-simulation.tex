\cleardoublepage
\setcounter{chapter}{8}
\chapter{3D-PLI simulation}
\label{cha:simulation_analysis}
% \minitoc
%
% \todo{ylabel sideways or next to (0,1)?} 
%
\section{Introduction}
%
This chapter addresses the simulation of \ac{3D-PLI} with the generate model library.
The first part focuses on the determination of all required physical parameters of the tissue and the microscope and on the characterization of the simulation parameters.
Afterwards the simulation of the previopus generated nerve fiber models is generated and analysed.
The orientation of the simulations is calculated using the routine algorithms implemented in \ac{fastPLI}.
The focus of the evaluation is on the accuracy of the tilt analysis for different orientations and crossing configurations.
%
%
%
\section{Parameter characterisation}\label{sec:sim_choose_parameters}
%
\subsection{Tissue}\label{sec:tissueProp}
%
% \begin{figure}[p]
% \centering
% \setlength{\tikzwidth}{0.75\textwidth}
% \tikzset{external/export=false} % takes long for the first time
% \begin{tabular}{c}
% \inputtikz{gfx/data/vervet_transmittance} \\[-2em]
% \subcaptiontab{\tikzwidth}{\label{fig:brain_trans}Transmittance} \\[1.5em]
% \inputtikz{gfx/data/vervet_retardation} \\[-2em]
% \subcaptiontab{\tikzwidth}{\label{fig:brain_ret}Retardation}
% %
% \end{tabular}
% \caption{%
% Transmittance and retardation map of a vervet monkey of the coronal section $\SI{549}{}$.
% The absorption coefficient and birefringence strength can be estimated from the flat fibers present in the corpus calosum (CC).
% The homogeneous regions annotated for this purpose contain $\SI{1125858}{\pixel}$ on the left and $\SI{1064629}{\pixel}$ on the right.}
% \label{fig:brain_ret_trans}
% \end{figure}
%
%
%
\begin{figure}[t]
% 2_simulation/0_parameter/measure_vervet.ipy
\centering
\setlength{\tikzwidth}{0.425\textwidth}
\setlength{\tabcolsep}{0em}
\begin{tabular}{C{0.5\textwidth}C{0.5\textwidth}}
%
\tikzset{external/export next=false}% takes long for the first time
\inputtikz{gfx/data/vervet_transmittance_zoom} &
\inputtikz{gfx/data/vervet_transmittance_hist} \\[-5mm]
%
\subcaptiontab{0.475\textwidth}{Transmittance} &
\subcaptiontab{0.475\textwidth}{\label{fig:histTrans}Histogram transmittance \todo{mean, median, 25, 75}} \\[10mm]
%
\tikzset{external/export next=false}
\inputtikz{gfx/data/vervet_retardation_zoom} &
\inputtikz{gfx/data/vervet_retardation_hist} \\[-5mm]
%
\subcaptiontab{0.475\textwidth}{Retardation} &
\subcaptiontab{0.475\textwidth}{\label{fig:histRet}Histogram retardation \todo{mean, median, 25, 75}} 
\end{tabular}
\caption{
Transmittance and retardation map of a vervet monkey of the coronal section $\SI{549}{}$.
The absorption coefficient and birefringence strength can be estimated from the flat fibers present in the corpus calosum (CC).
The homogeneous regions annotated for this purpose contain $\SI{1125858}{\pixel}$ on the left and $\SI{1064629}{\pixel}$ on the right.
}
\label{fig:brain_ret_trans_zoom}
\end{figure}
%
The absorption coefficient $\absorp{}$ and the birefringence $\dn{}$ must be estimated from the tissue in order to use them as suitable values for the simulation.
To measure the values, it is important to analyze a homogeneous region filled with flat dense fibers.
In a coronal section, the corpus callosum (CC) is suitable for this purpose. 
It is the main fiber connection between the two cerebral hemispheres.
\par
% 
\Cref{fig:brain_ret_trans_zoom} shows transmission and retardation maps of the of the vervet monkey coronal section number $\SI{549}{}$.
% \Cref{fig:brain_ret_trans_zoom} shows a magnified version.
Two \ac{ROI} are manuelly selected in homogenious and high value retardation regions of the corpus calosum.
The left region contains $\SI{1125858}{\pixel}$ and the right \ac{ROI} $\SI{1064629}{\pixel}$.
The same analysis is available for a human and a rodent section (see appendix \cref{fig:brain_roden_and_human}).
% 
\paragraph{Evaluation}
To calculate the absorption coefficient for the models one has to encount for the volume fraction.
For the $\fiberRadiusMean = \SI{0.5}{\micro\meter}$ models the volume fraction is about $\SI{75}{\percent}$.
This results in a absorption coefficient of about $\mu = \SI{30}{\milli\meter\tothe{-1}}$.
The median transmittance in the background is about $\SI{4500}{\arbitraryunit}$.\footnote{The value is not fixed for all measurments. It can easyly change by adjusting \eg{} the microscops exposer time.}
To calculate the birefingence one has also to account for the g-ratio, \ie{} the myelin thickness.
With a g-ratio of $\SI{75}{\percent}$ the birefringence results in about $\SI{0.008}{}$ for the radial model.
Both the result of the absorption coefficient and briefringence median estiments.
Due to the transmittance and retardation values range and the intrinsic composition of the real tissue, the median results of the absorption and birefringence are a good estimates for the following type of simulations.
%
% 
% 
\subsection{Optical resolution}
%
The optical resolution depends, among other things, on aberration and diffraction (see \cref{sec:opticalResolution}).
They are modeled as described in \cref{sec:ccdOptic}.
Therefore, the model parameters for the microscopes to be simulated must be determined.
\par
%
To measure the optical resolution of the microscope, previous measurements and analyses are repeated \cite{MenzelMaster}.
For this purpose, the \textit{1951 United States Air Force (USAF) resolution test chart}\footnote{U.S. Air Force MIL-STD-150A standard of 1951} is used.
It consists of several patterns that have three slots with specific spacing and width (see \cref{fig:usaf}).
They are arranged in fields of three vertical and horizontal lines.
The fields are arranged in a spiral that shrinks from group to group by a factor $\SI{0.5}{}$.
To determine the line width, the fields are numerically ordered according to a main group $i$ and a subgroup $j$.
To determine the resolution of the microscope, it is necessary to determine the group from which the slits can still be resolved according to the Rayleigh criterion (see \cref{fig:rayleigh}).
For this purpose, the intensity profiles perpendicular to the the three vertical and horizontal slits are analyzed.
% 
\paragraph{Evaluation}
%
\begin{figure}[!t]
\centering
\setlength{\tikzwidth}{0.35\textwidth} % bigger than 0.475 images???
\setlength{\tabcolsep}{0em}
\begin{tabular}{C{0.5\textwidth}C{0.5\textwidth}}
%
\includegraphics[height=\tikzwidth]{gfx/wiki/USAF-1951.pdf} &
\inputtikz{gfx/chap8/usaf_image} \\[-1em]
% 
\subcaptiontab{0.475\textwidth}{\label{fig:usaf}USAF chart from group -2 to 1: \url{https://en.wikipedia.org/wiki/1951_USAF_resolution_test_chart}} &
\subcaptiontab{0.475\textwidth}{\label{fig:usaf_image}Microscopic image with highlighted groups 7-6 to 8-2.} \\[4em]
% 
\inputtikz{gfx/chap8/usaf_line_plots_lr} &
\inputtikz{gfx/chap8/usaf_line_plots_up} \\[-1em]
%
\subcaptiontab{0.475\textwidth}{\label{fig:usaf_lines_lr}Centered line plots left to right. \todo{axis, x=0}} &
\subcaptiontab{0.475\textwidth}{\label{fig:usaf_lines_ud}Centered line plots top to bottom. \todo{axis, x=0}}
% 
\end{tabular}
\caption{Group 8-1 of the USAF chart with a line width of $\SI{1.95}{\micro\meter}$ corresponts to the Raileigh criteria. Therefore an optical convolution of $\opticsigma = \SI{0.75}{\pixel}$ will be applied in the simulation. \TODO{check order of left lineplot}.}
\label{fig:USAF}
\end{figure}
% 
\Cref{fig:usaf_image} shows a section of the capured image with the \ac{LMP} microscope.
The highlighted areas show the analyzed groups 7-6 to 8-2.
The area of group 7-6 \raisebox{.25em}{\tikzset{external/export next=false}\tikz \draw[RED,ultra thick,dashed](0,0)--(0.25,0);} has a line width of $\SI{2.19}{\micro\meter}$, group 8-1 \raisebox{.25em}{\tikzset{external/export next=false}\tikz \draw[GREEN,ultra thick,dashed](0,0)--(0.25,0);} of $\SI{1.95}{\micro\meter}$.
and group 8-2 \raisebox{.25em}{\tikzset{external/export next=false}\tikz \draw[BLUE,ultra thick,dashed](0,0)--(0.25,0);} of $\SI{1.74}{\micro\meter}$.
The intensity line profiles for the vertical and horizontal cases are shown in \cref{fig:usaf_lines_lr,fig:usaf_lines_ud}.
The Rayleigh criterion can be used to determine the resolution in the second group, which is thus in the range of $\SI{1.95}{\micro\meter}$.
This reproduces the measurements in the \cite{MenzelMaster}.
Therefore, the convolution parameter is set to $\opticsigma = \SI{0.75}{\pixel}$ for the simulation (see \cref{sec:opticalResolution}).
%
%
%
\subsection{Sensor gain and signal noise}\label{sec:sensorGain}
%
\begin{figure}[!t]
\centering
%
% \tikzset{external/export=false}
\setlength{\tikzwidth}{0.3\textwidth}
\setlength{\tikzheight}{0.3\textwidth}
% \tikzset{external/force remake}
%
\setlength{\tabcolsep}{0em}
\begin{tabular}{C{0.5\textwidth}C{0.5\textwidth}}
% \tikzset{external/remake next}
\inputtikz{gfx/pli/pli_focus}
&
\inputtikz{gfx/2/PM_000_image}
\\[-1em]
%
% SUBCAPTIONS
\subcaptiontab{0.475\textwidth}{\label{fig:pliFocus}Scheme of unfocused microscopic image.} &
\subcaptiontab{0.475\textwidth}{\label{fig:pliFocusImage}Microscopic image} \\[2em]
%
% \tikzset{external/remake next}
\inputtikz{gfx/data/PM_noise}
&
\inputtikz{gfx/data/theo_noise}
\\[-1em]
%
% SUBCAPTIONS
\subcaptiontab{0.475\textwidth}{\label{fig:parameterModelNoise} Linear regression results in a gain factor of $\opticgain_{\mathit{LMP}} = \SI{0.1175}{}(?)$.} &
\subcaptiontab{0.475\textwidth}{\label{fig:noiseplot}Expected noise range for human, vervet monkey and rodent. The noise correlates linearly with the light intensity.}
\end{tabular}
%
\caption{Camera noise measurements.}
\label{fig:parameterModelGain}
\end{figure}
%
As described in \cref{sec:ccdOptic}, optical noise is modeled with a Gaussian model.
% The gain factor $\opticgain$ of the microscopic setup is measured by multiple measurements of an image with a variety of intensity values.
The gain factor of an the \ac{CCD} camera describes the linearity between a measured electric signal and the output signal.
This also can be used to calculate the noise becaue it correlates with $\sqrt{I \cdot \opticgain}$ \cite{Wiese:887678}.
To measure the noise the gain factor is measured by captured multiple images with different pixel intensities.
This is realized by covering the sample stage with a fully absorbing cover so that half of the image is dark.
In addition, the focal length is changed so that the light is distributed over the entire image sensor under the cover (see \cref{fig:pliFocusImage}).
By measuring $N=\SI{500}{}$ images, the variance for the different intensity values is determined.
%
\paragraph{Evaluation}
The results are shown in \cref{fig:parameterModelNoise} and show a gain factor of $\opticgain_{\mathit{LMP}} = \SI{0.1175}{}(?)$.
This gain factor is used to model the integer noise with
\begin{align}
f(x) = \floor{\mathrm{normal}(\mu = x, \sigma=\sqrt{\opticgain x})+0.5}
\end{align}
for intensities $I > 0$ and $I \gg \sqrt{\opticgain I}$.
%
%
%
\subsection{\Voxelsize{} \texorpdfstring{\voxelsize{}}{}}
%
The parameter \Voxelsize{} $\voxelsize$ is the most important parameter for simulation accuracy, as it determines how accurately the models are discretized and how many light beams are modelled.
However, the voxel size cannot be arbitrary small since the number of calculations and memory consumtion increases by $O(n_{\mathit{voxel}}^3)$.
Therefore, it is recommended that the voxel size be as large as possible without introducing significant error due to discretization.
\par
%
To investigate this effect, a simulation is performed with multiple voxel sizes in the range of $\voxelsize = \SIrange{0.01}{1.3}{\micro\meter}$.
The smallest voxel size $\SI{0.01}{\micro\meter}$ is used as reference.
Since this voxel size is so small, a volume of $3 \cdot \SI{1.3}{\micro\meter} \times 3 \cdot \SI{1.3}{\micro\meter} \times \SI{60}{\micro\meter}$ is used without light beam tilts.
Otherwise, when using the tilt capabilities, the volume would have to be increased so that the light beam still passes through tissue.
The simulation uses the above determend parameters.
The models to be simulated are $(||,\modelInc = \SI{0}{\degree})$, $(||,\modelInc = \SI{90}{\degree})$, $(\times, \modelInc = \SI{0}{\degree})$, and $(\times,\modelInc = \SI{90}{\degree})$ with a fraction of $\modelPsi = \SI{0.5}{}$, since these configurations represent the extrema for two fiber populations.
The simulations are repeated $\SI{25}{}$ times at the positions
\begin{align}
\begin{split}
    x&=\frac{i\,\%\,5}{5} \cdot \SI{60}{\micro\meter} - \SI{30}{\micro\meter} \\
    y&=\frac{\floor{i/5}}{5} \cdot \SI{60}{\micro\meter} - \SI{30}{\micro\meter} 
\end{split}
\end{align}
% 
% 
% 
\paragraph{Evaluation}
%
\begin{figure}[!t]
% 2_simulation/0_parameter/fiber_radii.py
\centering
\includegraphics[width=\textwidth, page=1]{gfx/rc1/voxel_size/voxel_size_plots_data_r05_output_vs_135_0.01_6_25_vervet_r_rc1.pdf}
\caption{The mean difference is constant for smaller voxel sizes and starts to grow significantly only from $\voxelsize=\SI{0.1}{\micro\meter}$.}
\label{fig:voxelsizeNoise}
\end{figure}
% 
The results in \cref{fig:voxelsizeNoise} show that the relative difference from the smallest voxel size increases statically significantly starting from a value of $\SI{0.1}{\micro\meter}$.
The variance of the relative difference increases with increasing voxel size from this value.
Smaller than $\SI{0.1}{\micro\meter}$ the difference to the reference simulation does not enhance anymore.
Therefore, the voxel size $\voxelsize = \SI{0.1}{\micro\meter}$ is a good compromise between runtime and accuracy.
One has to keep in mind that this is only valid for a pixel size of $\SI{1.3}{\micro\meter}$ and fiber radii of $\SI{0.5}{\micro\meter}$.
% 
%
%
\newpage
\section{Simulation}
%
\subsection{Parameters}
\label{sec:simParameterEnv}
% 
\begin{table}[!b]
\caption{Simulation parameters}
\centering
% \sisetup{open-bracket={\{}, close-bracket={\}}, list-final-separator={,},list-pair-separator={,}}%
\pgfplotstabletypeset[%
    thesisTableStyle,
    column type=l,
    columns/variable/.style={string type},
    columns/value/.style={string type},
    every head row/.style={before row=\toprule,after row=\midrule},
    every last row/.style={after row=\bottomrule},
    col sep=&,
    row sep=\\,
]
{variable & value\\
%
simpli.voxel\_size & $\SI{0.1}{\micro\meter}$\\
simpli.pixel\_size & $\SI{1.3}{\micro\meter}$\\
simpli.voi & $[[\SI{-35}{\micro\meter}, \SI{-35}{\micro\meter}, \SI{-30}{\micro\meter}], [\SI{35}{\micro\meter}, \SI{35}{\micro\meter}, \SI{30}{\micro\meter}]]$\\
simpli.filter\_rotations & $\SIlist{0;20;40;60;80;100;120;140;160}{\degree}$\\
simpli.interpolate & \texttt{"Slerp"}\\
simpli.wavelength & $\SI{525}{\nano\meter}$\\
simpli.optical\_sigma & $\SI{0.75}{\pixel}$\\
tilt angle & $\SI{3.9}{\degree}$\\
simpli.light\_intensity & $\SI{8000}{}$\\
gain & \SI{0.1175}{}\\
simpli.noise\_model & \code{lambda x: np.floor(np.random.normal(x,}\\
 & \ \ \ \ \ \code{np.sqrt(gain * x))+0.5).astype(np.uint16)}\\
fiber absorption & rodent: $\SI{14}{\milli\meter\tothe{-1}}$, Vervet: $\SI{30}{\milli\meter\tothe{-1}}$, human: $\SI{60}{\milli\meter\tothe{-1}}$\\
fiber model & 'r'\\
fiber birefringence & 0.008\\
fiber radii & axon: \SI{0.75}{}, myelin: \SI{1}{}\\
model delta inclinations & single: $\SI{5}{\degree}$, crossings: $\SI{30}{\degree}$\\
model delta rotation & $\SI{15}{\degree}$\\
}
\label{tab:simParameters}
\end{table}
%
As described in \cref{chap:Software}, \ac{fastPLI} includes a pipeline implementation of the simulation with automatic analysis.
This implementation is used to compute simulate the signal for the flat and tilted measurements, and apply the optical noise and tilt analysis to the resulting signal using the \ac{ROFL} algorithm. 
As input for the simulation is the previously generated model library (see \cref{sec:genNerveFiberLibrary}).
The models are rotated according to the previously specified discretization to sample all orientations (see \cref{sec:modelParamet}).
\par
% 
\Cref{tab:simParameters} lists the parameters of the simulation in the variable notation of \ac{fastPLI}.
With a pixel size of \SI{1.3}{\micro\meter}, $\SI{2500}{\pixel}$ are available per simulation for statistical analysis.
The models are tilted in steps of $\Delta \modelInc = \SI{5}{\degree}$ for a single fiber population and by $\Delta \modelInc = \SI{30}{\degree}$ for two fiber populations.
\par
% 
The the following sections will only show a subset of the results. 
All following results all data is available in \dummy{}.
% 
% 
%
\subsection{Single inclined fiber population}
\label{sec:resSingleIncl}
%
\begin{figure}[!t]
\centering
\includegraphics[page=1]{gfx/rc1/analysis/plots_single_pop_hist_output_cube_2pop_135_rc1_single.pdf}
\caption{Single inclined fiber population orientation histograms. \todo{log \# ?}}
\label{fig:single_fiber_pop_hist}
\end{figure}
%
\begin{figure}[!p]
\centering
\includegraphics[]{gfx/rc1/analysis/plots_single_pop_output_cube_2pop_135_rc1_single.pdf}
\caption{Single tilted fiber population. Results of the tilting analysis. \todo{trel, domega, xachse}, \todo{gleiche binbreite}}
\label{fig:single_fiber_pop_rofl}
\end{figure}
%
First, a single population of fibers is simulated and analyzed.
Since the direction is negligible for a single population, only the inclination parameter \modelInc{} remains.
\par
%
\Cref{fig:single_fiber_pop_hist} shows the orientation distribution of a single population of fibers for different inclinations $\modelInc{}$.
The distributions of the orientations of the model segments are shown on the left side, and those of the tilting analysis of the simulations are shown on the right side.
The simulation results are in agreement with the models orientations.
The variance of the tilting analysis is higher than the models orientations.
\par
%
\Cref{fig:single_fiber_pop_rofl} show the modalities transmittance, direction and retardation of the flat measurement as well as the results of the tilting analysis inclination, \trel{} and the resulting opening angle $\openingAngle$.
\par
% 
%Transmittance
The transmittance increases slightly with inclination angle for $\modelInc<\SI{75}{\degree}$.
For $\modelInc \ge \SI{75}{\degree}$ the transmittance increases significantly.
The variance of transmittance is within a few percent for all inclinations and also increases slightly with inclination angle.
\par
%
% Retardation
The retardation plot shows the retardation of the non-tilted simulations and the theoretical curve that follows $(\cos(\modelInc) + 1) / 2 \cdot \mean\left(\mathrm{ret}(\SI{0}{\degree})\right)$.
Normalization with $\mean\left(\mathrm{ret}(\SI{0}{\degree})\right)$ ensures comparison with the data.
The retardation follows the theoretical line.
However, for the intermediate tilt angles, the measured retardation is slightly higher than the theoretical line.
The variance along all fiber inclinations is equal to \modelInc{}.
\par
%
% Direction
The next graph shows the measured direction.
For inclination angles smaller than $\SI{75}{\degree}$ the variance remains relative small.
For larger values, the variance increases.
It should be remembered that the boxplot does not take into account that the values are periodic.
Therefore, especially for $\modelInc=\SI{90}{\degree}$, the values from the $\SIrange{-90}{90}{\degree}$ are uniformly distributed.
\par
%
% Inclination
% \TODO{differnt symbol between modelinc and inc?}
The inclination show the results of the tilting analysis with a dashed line for the models inclination $\modelInc$.
The results are centered around the median value in the range of $\big[\median (\modelInc)-\SI{90}{\degree}, \median(\modelInc)+\SI{90}{\degree}\big)$.
The median follows the theoretical curve.
For the inclinations $\SI{80}{\degree}$ and $\SI{85}{\degree}$ the variance increases significantly.
For $\modelInc = \SI{90}{\degree}$ the varianze is similar to the flat results.
\par
%
% trel
The median relative birefringence thickness \trel{} is stable for values up to $\modelInc < \SI{60}{\degree}$, but the variance increases slightly.
For larger values, the median decreases while the variance increases.
Outliers exist reaching values $>\SI{1}{}$.
For inclination angles $\modelInc \ge \SI{85}{\degree}$, the quartile value $\SI{75}{\percent}$ increases by $\SI{1}{}$ and the median for $\SI{90}{\degree}$ reaches about $\SI{2}{}$.
\par
%
% domega
The opening angle \openingAngle{} is consistent up to a tilt angle of $\le \SI{70}{\degree}$.
At higher inclination angles, both the median and the variance increase significantly in analogy to the inclination, except in the last case.
%
%
%
\subsection{Crossing flat fiber populations}
\label{sec:resCrossFlat}
%
\begin{figure}[!p]
\centering
\includegraphics[page=3]{gfx/rc1/analysis/plots_flat_pop_hist_output_cube_2pop_135_rc1_flat.pdf}
\caption{Crossing flat fiber population: $\modelPsi=\SI{30}{\percent}$.
% Left: 2D log histogram orientation from rofl analysis of simulation. Right: 2D log histogram of model segment orientation.
}
\label{fig:flat_03_fiber_pop_hist}
% 
\vspace{2em}
\includegraphics[page=5]{gfx/rc1/analysis/plots_flat_pop_hist_output_cube_2pop_135_rc1_flat.pdf}
\caption{Crossing flat fiber population: $\modelPsi=\SI{50}{\percent}$.
% Left: 2D log histogram of the orientation from the tilting analysis of the simulation, right: 2D log histogram of the orientation of the model segments.#
}
\label{fig:flat_05_fiber_pop_hist}
\end{figure}
%
The next simulation focuses on two flat crossing fiber populations.
Here, the results for the case $\modelPsi = \SI{30}{\percent}$ and $\modelPsi = \SI{50}{\percent}$ are examined.
The other proportions of the fiber population are available in \TODO{appendix}.
\par
%
\Cref{fig:flat_03_fiber_pop_hist, fig:flat_05_fiber_pop_hist} shows the distribution of orientations for the models fiber segments and the resulting simulations orientations.
\par
% 
The results for $\modelPsi = \SI{30}{\percent}$ show that the measured orientation follows the dominant fiber population.
Small differences can be seen in the range of $\SI{45}{\degree}$.
In the case of $\modelPsi = \SI{50}{\percent}$, the measured orientation lies between the two fiber populations.
An exception is the crossing case of $\modelOmega=\SI{90}{\degree}$, where the measured orientations are quite random around steep orientations.
\par
%
\begin{figure}[!p]
\centering
\includegraphics[page=3]{gfx/rc1/analysis/plots_flat_pop_output_cube_2pop_135_rc1_flat.pdf}
\caption{Crossing flat fiber population: $\modelPsi=\SI{30}{\percent}$. Tilting analysis results. \todo{domega, trel, omega, dotted line more space, title in percent}, \todo{theoretische kurve ret}}
\label{fig:flat_03_fiber_pop_rofl}
\end{figure}
%
\begin{figure}[!p]
\centering
\includegraphics[page=5]{gfx/rc1/analysis/plots_flat_pop_output_cube_2pop_135_rc1_flat.pdf}
\caption{Crossing flat fiber population: $\modelPsi=\SI{50}{\percent}$. Tilting analysis results.}
\label{fig:flat_05_fiber_pop_rofl}
\end{figure}
% 
\Cref{fig:flat_03_fiber_pop_rofl, fig:flat_05_fiber_pop_rofl} show the results of the \ac{3D-PLI} modalities as well as the tilt analysis and opening angle in detail.
\par
% Transmittance
The transmittance increases with increasing crossing angle \modelOmega{}.
The two fiber population fractions \modelPsi{} have the same behavier.
Transmittance increases initially and becomes flatter for larger crossing angles.
In the case of $\modelPsi = \SI{30}{\percent}$ it starts at a transmittance of about $\SI{1000}{\arbitraryunit}$ and reaches for a crossing angle of $\SI{90}{\degree}$ a value of about $\SI{1090}{\arbitraryunit}$.
In the case of $\modelPsi = \SI{50}{\percent}$ it reaches a slightly higher value of $\SI{1110}{\arbitraryunit}$.
\par
% Retardation
The retardation is negatively linearly correlated with increasing crossing angle for both fiber population fractions \modelPsi{}.
For $\modelPsi=\SI{30}{\percent}$ the retardation starts at $\SI{0.8}{}$ and drops to about $\SI{0.3}{}$.
In the case of $\modelPsi=\SI{50}{\percent}$ it also starts at $\SI{0.8}{}$ and drops to almost $\SI{0}{}$.
For both fiber population fractions, the variance increases slightly with the crossing angle.
In the case of $\modelPsi=\SI{50}{\percent}$ and $\modelOmega=\SI{90}{\degree}$ the variance is again smaller.
\par
% Direction
The direction for both fiber population fractions \modelPsi{} follow the theoretical circmean function (dashed line).
For both \modelPsi{} the variance of the direction increases with increasing crossing angle \modelOmega{}.
In the case of $\modelPsi=\SI{50}{\percent}$ and a crossing angle of $\modelRot = \SI{90}{\degree}$ the directions are distributed over the entire range of values.
\par
% Inclination
The inclination is about $\SI{0}{\degree}$ with its median for both fiber population fractions and all crossing angles.
The variance increases with increasing crossing angle, up to about $\SI{3}{}$ times the lowest value in the case of $\modelPsi = \SI{30}{\percent}$.
The increase in the case of $\modelPsi = \SI{50}{\percent}$ is significantly more until for the $\modelRot=\SI{90}{\degree}$ the inclinations are distributed over the entire range of values.
\par
% Trel
The relative thickness \trel{} decreases with increasing crossing angle \modelOmega{}.
The shape of the curve correlates negatively with increasing crossing angle.
In both cases the \trel{} values start at about $\SI{0.6}{}$.
For $\modelPsi = \SI{30}{\percent}$ the \trel{} value drops to $\SI{0.2}{}$ wheres for $\modelPsi = \SI{50}{\percent}$ the \trel{} value drops almost to $\SI{0}{}$.
For both fiber population fractions, the variance increases slightly.
For $\modelPsi = \SI{50}{\percent}$ and $\modelOmega = \SI{90}{\degree}$ the variance of \trel{} increases significantly.
There are also outliers visible reaching \trel{} values $>\SI{1}{}$.
\par
% domega
The opening angle \openingAngle{} is similar for both fiber population fractions up to a crossing angle of $\modelOmega=\SI{70}{\degree}$.
For higher values in the case of $\modelPsi = \SI{50}{\percent}$ the values increases significantly more.
The variance increases for both fiber population fractions with increasing crossing angle.
In the case of $\modelPsi = \SI{50}{\percent}$ and $\modelOmega = \SI{90}{\degree}$ the opening angle are distributed over the entire range of values.
%
% 
%
\subsection{Inclined crossing fibers population}
\label{sec:resInclCross}
%
\begin{figure}[!p]
\centering
\includegraphics[page=3]{gfx/rc1/analysis/plots_inclined_pop_hist_output_cube_2pop_135_rc1_inclined.pdf}
\caption{Population of inclined crossing fibers: $\modelPsi=\SI{30}{\percent}$.
%  Left: 2D log histogram of orientation from tilting analysis of simulation, right: 2D log histogram of orientation of model segments.
}
\label{fig:inclined_03_fiber_pop_hist}
% 
\vspace{2em}
\includegraphics[page=5]{gfx/rc1/analysis/plots_inclined_pop_hist_output_cube_2pop_135_rc1_inclined.pdf}
\caption{Population of inclined crossing fibers: $\modelPsi=\SI{50}{\percent}$.
%  left: 2D log histogram of orientation from tilting analysis of simulation, right: 2D log histogram of orientation of model segments.
}
\label{fig:inclined_05_fiber_pop_hist}
\end{figure}
%
The orientation histogramms of the inclined models as well as their simulation results are shown in \cref{fig:inclined_03_fiber_pop_hist,fig:inclined_05_fiber_pop_hist}.
In the case of a fiber population fraction $\modelPsi=\SI{30}{\percent}$ the inclination of the simulation follows the inclination of the models, however with lower values.
For a crossing of $\modelOmega=\SI{90}{\percent}$ the resulting orientations are flat as the first fiber population.
For $\modelPsi=\SI{50}{\percent}$ the same behavier is visiable, however the difference in the inclination is larger and for  $\modelOmega=\SI{30}{\percent}$ and $\modelOmega=\SI{60}{\percent}$ lie in between both fiber populations inclinations.
\par
%
\begin{figure}[!p]
\centering
\includegraphics[page=3]{gfx/rc1/analysis/plots_inclined_pop_output_cube_2pop_135_rc1_inclined.pdf}
\caption{Population of inclined crossing fibers: $\modelPsi=\SI{30}{\percent}$. Results of tilting analysis.}
\label{fig:inclined_03_fiber_pop_rofl}
\end{figure}
%
\begin{figure}[!p]
\centering
\includegraphics[page=5]{gfx/rc1/analysis/plots_inclined_pop_output_cube_2pop_135_rc1_inclined.pdf}
\caption{Population of inclined crossing fibers: $\modelPsi=\SI{50}{\percent}$. Results of tilting analysis.}
\label{fig:inclined_05_fiber_pop_rofl}
\end{figure}
%
\Cref{fig:inclined_03_fiber_pop_rofl, fig:inclined_05_fiber_pop_rofl} show the results of the \ac{3D-PLI} modalities as well as the tilt analysis and opening angle in detail.
\par
% Transmittance
The transmittance increases with increasing crossing angle \modelOmega{}.
The two fiber population fractions \modelPsi{} have the same behavier.
Transmittance increases initially and becomes flatter for larger crossing angles.
In the case of $\modelPsi = \SI{30}{\percent}$ it starts at a transmittance of about $\SI{1000}{\arbitraryunit}$ and reaches for a crossing angle of $\SI{90}{\degree}$ a value of about $\SI{1100}{\arbitraryunit}$.
In the case of $\modelPsi = \SI{50}{\percent}$ it reaches a slightly higher value of $\SI{1110}{\arbitraryunit}$.
\par
% Retardation
The retardation is negatively linearly correlated with increasing crossing angle for both fiber population fractions \modelPsi{}.
For $\modelPsi=\SI{30}{\percent}$ the retardation starts at $\SI{0.8}{}$ and drops to about $\SI{0.18}{}$.
In the case of $\modelPsi=\SI{50}{\percent}$ it also starts at $\SI{0.8}{}$ and drops to about $\SI{0.3}{}$.
For both fiber population fractions, the variance increases with increasing crossing angle.
In the case of $\modelPsi=\SI{50}{\percent}$ the variance increases significantly more.
\par
% Direction
The direction for both fiber population fractions \modelPsi{} is centered around $\SI{0}{\degree}$.
For both \modelPsi{} the variance of the direction increases with increasing crossing angle \modelOmega{}.
There is no no significant effect visible between both fiber population fractions.
\par
% Inclination
The inclination for both fiber population fraction starts first increasing and drops then to a value of $\SI{0}{\degree}$.
In the case of $\modelPsi=\SI{30}{\percent}$ the maxium inclination is reached at  a crossing angle of about $\modelOmega=\SIrange{60}{70}{\degree}$.
For $\modelPsi=\SI{50}{\percent}$ the maximum value is at a crossing angle of about $\modelOmega=\SIrange{50}{60}{\degree}$.
The theoretical curve, which is the circmean of both fiber populations inclinations, is in both cases only followed up to a crossing angle of about $\SI{30}{\degree}$.
\par
% Trel
The relative thickness \trel{} decreases with increasing crossing angle \modelOmega{} almost linearly for both fiber population fractions.
In both cases the \trel{} values start at about $\SI{0.6}{}$.
For $\modelPsi = \SI{30}{\percent}$ the \trel{} value drops to $\SI{0.1}{}$ wheres for $\modelPsi = \SI{50}{\percent}$ the \trel{} value drops almost to $\SI{0.2}{}$.
For the fiber population fraction $\modelPsi = \SI{30}{\percent}$ the variance increases in the middle value range $\modelOmega=\SIrange{40}{70}{\degree}$.
In this range the \trel{} values are slightly increased against a linear trend.
The second fiber population fraction case $\modelPsi = \SI{50}{\percent}$ shows a small increase in the variance with increasing crossing angle.
\par
% domega
The opening angle \openingAngle{} for $\modelPsi=\SI{30}{\percent}$ increases with increasing crossing angle \modelOmega{}.
The increase increases significantly for crossing angles towords $\modelOmega=\SI{90}{\degree}$ but stays under a median value of about $\openingAngle=\SI{10}{\degree}$.
For $\modelPsi=\SI{50}{\percent}$ the opening angle increases lineary up to a crossing angle of $\modelOmega=\SI{80}{\degree}$ and remains the same for $\modelOmega=\SI{90}{\degree}$.
For both fiber population fractions the variance increases with increasing crossing angle.
In the case of $\modelPsi=\SI{50}{\percent}$ the variance is about half as big as for $\modelPsi=\SI{30}{\percent}$.
%
% 
% 
\subsection{Free crossing fiber populations}
\label{sec:resFreeCross}
%
This section presents a subset of the simulated nerve fiber models.
The remaining results are available in \dummy{}.
To visualize the results from the \ac{3D-PLI} analysis pipeline a polar plot visualization is used (see \cref{fig:simModelSphereSample}).
Each polar plot visualizes the results for a fixed first fiber population \popa{}.
To interpolate between the sampled positions, a spherical k-nearest neighbors interpolator is used \cite{DBLP:journals/corr/abs-1910-00704}.
The results of the direction and inclination are not shown since the interpolation does not work with the circmean function.
% 
\begin{figure}[t]
\centering
\setlength{\tikzwidth}{0.40\textwidth}
\subcaptionbox{The spheres surface is sampled around the first fiber population axis $\popa$ of inclination $\modelInc$ with a crossing angle $\modelOmega$ and a rotation $\modelRot$.}
[.475\textwidth]{\inputtikz{gfx/model/sphere_models_c}}
\hfill
\subcaptionbox{
    To visualize scalar results of a fixed first fiber population orientation \popa{} and a variable fiber population orientation \popb{} a polar plot is used.
    The orientation \popa{} is marked with a black thick circle.
    The variable second orientation marked with dashed circles.
    For the visualization the scalar values will be interpolated according to a spherical k-nearest neighbors interpolator algorithm.
}
[.475\textwidth]{\inputtikz{gfx/model/sphere_hist_b}}
\caption{Visualization of results for a fixed first fiber population \popa{}.}
\label{fig:simModelSphereSample}
\end{figure}
%
The spherical plots in \cref{fig:sim_ana_acc,fig:sim_ana_ret,fig:sim_ana_trans,fig:sim_ana_trel} are designed so that the thick black circle shows the orientation of the first fiber population and the thin dashed circles show the orientation of the second fiber population.
At the position of the second fiber population, the resulting mean value is inserted.
%
%
%
\begin{figure}[!p]
\centering
\includegraphics[]{gfx/rc1/analysis/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_acc.pdf}
\caption{Mean \ac{ACC} value between model and tilting analysis orientations. \todo{x,y labels}}
\label{fig:sim_ana_acc}
\end{figure}
%
\paragraph{\acs{ACC}}
\Cref{fig:sim_ana_acc} shows the \acreset{ACC} \ac{ACC} value, \ie{} how well the coefficients of the \ac{ODF} basis function are matched \cite{Schilling2018}.
\todo{acc of psi = 1 as ref}.
\par
% 
The fiber population fraction $\modelPsi=\SI{10}{\percent}$ show no significant reduction in the \ac{ACC} value for the first fiber model inclination $\modelInc$.
For $\modelPsi=\SI{30}{\percent}$ a reduction in the \ac{ACC} value is visible for the lower inclined first fiber population models.
The reduction is located around steep secondary fiber populations.
For $\modelInc = \SIlist{30;60}{\degree}$ the reduction is shifted to a direction along $\SI{180}{\degree}$.
The effective area of the reduction reduces with increasing \modelInc{} until for an inclination of $\modelInc=\SI{90}{\degree}$ no area effect is anymore visible.
The \ac{ACC} value for this last plot is however still reduced compared to $\modelPsi=\SI{10}{\percent}$.
For $\modelInc < \SI{90}{\degree}$ a slightly increase in the \ac{ACC} value is visible for flat fiber crossing with a crossing angle of $\modelOmega=\SI{90}{\degree}$.
\par
%
For the equally proportional fiber population $\modelPsi = \SI{50}{\degree}$, the \ac{ACC} value reaches values close to $\SI{0}{}$ for $\modelInc = \SIlist{0;30}{\degree}$ and a crossing angle of $\modelOmega=\SI{90}{\degree}$.
Inclined secondary fiber populations reaches a higher \ac{ACC} value.
The configuration $\modelInc = \SI{90}{\degree}$ reaches is maximum \ac{ACC} value at a crossing angle of $\modelOmega=\SI{0}{\degree}$ and lower stable values for all other configurations.
\par
%
The first to fiber inclinations $\modelInc = \SIlist{0;30}{\degree}$ for $\modelPsi=\SI{70}{\percent}$ show a similar distribution of the \ac{ACC} value. 
Small reductions are visible.
For $\modelInc=\SI{60}{\degree}$, the \ac{ACC} value is highest for low crossing angles $\modelOmega$, \ie{} close to the first fiber population.
The \ac{ACC} value decreases significantly for higher crossing angles.
In the case of $\modelInc=\SI{90}{\degree}$ this is also visible, but the minimum for the \ac{ACC} value is higher compared to the previous case $\modelInc=\SI{60}{\degree}$.
\par
%
The last case $\modelPsi=\SI{90}{\percent}$ shows high values for the \ac{ACC} parameter for the first three inclinations $\modelInc=\SIlist{0;30;60}{\percent}$.
The last inclination angle $\modelInc=\SI{90}{\degree}$ shows a slightly decrease of the \ac{ACC} value for higher crossing angles $\modelOmega$.
\par
%
In summary crossing angles have a significant reduced \ac{ACC} values.
This effect is significant visible as a \say{band} of reduced \ac{ACC} values from low inclined and low first fiber poluation fraction towords high inclined and high first fiber population fractions.
Fiber population fractions of $\modelPsi \geq \SI{90}{\percent}$ or $\modelPsi \leq \SI{10}{\percent}$ have almost no effect on the \ac{ACC} value.
%
%
% 
\paragraph{Transmittance}
% 
\begin{figure}[!p]
\centering
\includegraphics[]{gfx/rc1/analysis/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_trans_mean.pdf}
\caption{Mean transmittance value. \todo{x,y labels}}
\label{fig:sim_ana_trans}
\end{figure}
% 
The average transmission value is visualized in \cref{fig:sim_ana_trans}.
The first fiber population fraction $\modelPsi=\SI{10}{\percent}$ is almost identical for all inclination angles $\modelInc$.
The transmittance is lowest for models with a crossing angle of $\modelOmega = \SI{0}{\degree}$ and for flat configurations.
\par
%
For a fiber population fraction $\modelPsi=\SI{30}{\percent}$ the transmittance increases significantly.
It is again lowest for a crossing angle of $\modelOmega=\SI{0}{\degree}$.
The same behavier is true for $\modelPsi=\SIlist{50,70}{\percent}$.
$\modelPsi=\SI{50}{\percent}$ reachest the highest transmittance for fiber models with crossings.
\par
% 
The the mean transmittance for the last fiber population fraction $\modelPsi=\SI{30}{\percent}$ is again reduced similar to the first case.
Again, only fiber configurations with no crossing remain the lowest transmittance for all inclinations $\modelInc$.
%
% 
% 
\paragraph{Retardation}
% 
\begin{figure}[!p]
\centering
\includegraphics[]{gfx/rc1/analysis/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_ret_mean.pdf}
\caption{Mean retardation values. \todo{x,y labels}}
\label{fig:sim_ana_ret}
\end{figure}
% 
The retardation results are shown in \cref{fig:sim_ana_ret}.

For a fiber population fraction of $\modelPsi=\SI{10}{\percent}$ the smallest retardation values are visible for secondary fiber populations with an inclination of $\SI{90}{\degree}$.
Configurations with a high crossing angle $\modelOmega$ are slightly reduced.
Flat fiber configurations remain a high retartation value.
\par
%
The same bahavier is also visible for the fiber population fraction $\modelPsi=\SIlist{30;50;70}{\percent}$, however, the retardation values are significantly reduced, especially for high first fiber population inclinations.
The reduction of the retardation of high crossing angles $\modelOmega$ is more significant as well, especially for $\modelPsi=\SI{50}{\percent}$.
For fiber population fractions $\modelPsi \geq \SI{50}{\percent}$ and first fiber population inclinations $\modelInc \geq \SI{60}{\degree}$ the retardation is close to $\SI{0}{}$.
\par
%
For $\modelPsi=\SI{90}{\percent}$ no reduction in the retardation for different crossing angles $\modelOmega$ is visible.
The retardation value is stable for each first fiber inclination parameter.
The retardation, however, reduces significantly with increasing inclination $\modelInc$ until it is close to $\SI{0}{}$ for $\modelInc=\SI{90}{\degree}$.
% 
% 
% 
\paragraph{Effective birefringence thickness \trel{}}
%
\begin{figure}[!p]
    \centering
    \includegraphics[]{gfx/rc1/analysis/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_rtrel_mean.pdf}
    \caption{Mean \trel{} from tilting analysis. \todo{x,y labels}}
    \label{fig:sim_ana_trel}
\end{figure}
% 
The results of \trel{} are shown in \cref{fig:sim_ana_trel}.
The first fiber population fraction $\modelPsi=\SI{10}{\percent}$ 
is almost constant for all fiber configurations.
The exceptions are secondary fibar population inclinations of $\SI{90}{\degree}$ for $\modelInc=\SIlist{60;90}{\degree}$.
% 
For $\modelPsi=\SI{30}{\percent}$ areas with reduces \trel{} become visible.
These are located for $\modelInc=\SIlist{0;30}{\degree}$ at $\SI{90}{\degree}$ crossing to the first fiber population towords a direction of $\SI{180}{\degree}$.
For $\modelInc=\SI{60}{\degree}$ the reduced \trel{} area remains slightly left to the z-axis.
Here, towords the north and south are two sampled configurations visible with $\trel > 1$ (plot is capped).
The same is visible for a $\modelInc=\SI{90}{\degree}$ for the none crossing configuration along the z-axis.
\par
% 
$\modelPsi=\SI{70}{\percent}$ shows for the flat configuration $\modelInc=\SI{0}{\degree}$ only slightly reduced \trel{} values for configurations with high flat crossing angles.
This behavier is reduced for $\modelInc=\SI{30}{\degree}$.
For $\modelInc=\SI{60}{\degree}$ a significant reduction in \trel{} becomes visible for crossing angles in the range of $\modelOmega=\SI{90}{\degree}$ and towords a direction of $\SI{180}{\degree}$.
The last case with $\modelInc=\SI{90}{\degree}$ show for all configurations significat reduced \trel{} values towords $\SI{0}{}$ with an exception for the very steep configuration where $\trel \geq \SI{1}{}$.
% 
The last row shows the results for the fiber population fraction $\modelPsi=\SI{90}{\percent}$.
All models and there configurations remain a stable \trel{} value.
The exception is for fiber configurations with $\modelInc=\SI{90}{\degree}$, where the \trel{} values along the z-axis are $\geq \SI{1}{}$
%
\paragraph{\rvalue}
% 
\begin{figure}[!p]
\centering
\includegraphics[]{gfx/rc1/analysis/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_R.pdf}
\caption{Mean \rvalue{} from tilting analysis. \todo{x,y labels}}
\label{fig:sim_ana_rvalue}
\end{figure}
% 
The \rvalue{} of the fitting model of the tilt analysis is shown in \cref{fig:sim_ana_rvalue}.
It describes the mean absolute difference between the data and the fitted data from the tilting analysis.
\par
%
For a fiber population fraction of $\modelPsi=\SI{10}{\percent}$ and a primary inclination angle $\modelInc\leq\SI{30}{\degree}$ the orientation of the second fiber population does not change the \rvalue{} of the tilting analysis.
For $\modelInc=\SI{60}{\degree}$ the \rvalue{} starts increasing for secondary fiber orientations towords the xy-plane.
The \rvalue{} increases significantly more for $\modelInc=\SI{90}{\degree}$ for flat secondary fiber population orientations.
\par
% 
For fiber population fractions $\modelPsi=\SI{30}{\percent}$ and $\modelInc=\SI{0}{\degree}$ the \rvalue{} remains low for flat crossing fiber configurations.
Towords fiber crossing along the z-axis the \rvalue{} is slightly increased.
For $\modelInc=\SI{30}{\degree}$ the increase of the \rvalue{} along the z-axis is slightly lower.
However, to steeper crossing angles towords about $\SIlist{125;235}{\degree}$ the \rvalue{} is still increased.
The fiber configurations of $\modelInc=\SIlist{60;90}{\degree}$ are similar to the previous fiber population fraction, however, the \rvalue{} are not as high.
\par
%
Fiber population fractions $\modelPsi=\SI{50}{\percent}$ and inclinations of $\modelInc=\SI{0}{\degree}$ have an increased \rvalue{} for inclined secondary fiber configurations along the y-axis.
For $\modelInc=\SI{0}{\degree}$ the increased area along the y-axis is bends towords $\SI{180}{\degree}$.
$\modelInc=\SI{60}{\degree}$ remain a low \rvalue{} along the x-axis and an area around the first fiber population orientation.
The remaining secondary orientations are slightly increased.
The steep first fiber population inclination of $\modelInc=\SI{90}{\degree}$ again has an increased \rvalue{} towords flat secondary orientations.
The \rvalue{} compared to the lower first fiber population fractions is further reduced.
\par
%
$\modelPsi=\SI{70}{\percent}$ and $\modelInc=\SI{0}{\degree}$ have only an increased \rvalue{} for secondary fiber configuration along the z-axis.
The points along the x-axis are slightly more increased then along the y-axis.
For $\modelInc=\SI{30}{\degree}$ the bended shape form the previous result almost disapears.
Only the secondary fiber configurations along the z-axis remain increased.
$\modelInc=\SI{60}{\degree}$ remain a low \rvalue{} along the x-axis.
Only crossings for flat directions of $\SIlist{110;250}{\degree}$ are increased.
The last inclination angle of $\modelInc=\SI{90}{\degree}$ is again similar to the previous fiber population fraction, but the \rvalue{} is again lower for the increased areas.
\par
% 
The last fiber population fraction $\modelPsi=\SI{90}{\percent}$ have an increased \rvalue{} at the z-axis for inclination angles of $\modelInc=\SIlist{0;30}{\degree}$.
$\modelInc=\SIlist{60;90}{\degree}$ remain for all configurations a low \rvalue{}.
% 
%
%
\subsection{Speedup}
\label{sec:simSpeedup}
%
This section shows the results of the speedup measurements for the generation of the discretized tissue volume (see \cref{sec:dv_generator}) and the simulation of the light matter interaction (see \cref{sec:simulation}) for the implemented paralelizations with \ac{OpenMP} and \ac{MPI}.
Simulations were performed using a single compute node with the \ac{CPU} architecture \texttt{2x Intel(R) Xeon(R) CPU E5-4657L v2}.
To measure speedup, each algorithm was run $N=10$ times.
To calculate the speedup value, the mean measured time for $n_\mathit{cpu}=1$ was then divided by the measured time for the $n_\mathit{cpu}$ individual values.
The volume used is the $\modelPsi=\SI{0}{\percent} / \modelInc=\SI{0}{\degree}$ from the \cref{sec:simParameterEnv} parameterization.
\par
% 
\begin{figure}[!t]
\centering
\subcaptionbox{\label{fig:speedTissueMP}
\ac{OpenMP} speedup discrete tissue generation.
}[.475\textwidth]{\includegraphics[page=2,width=.475\textwidth]{gfx/rc1/speed/boxplot_generation_output_generation_mp_v_0.1.csv.pdf}}
\hfill
\subcaptionbox{\label{fig:speedTissueMPI}
\ac{MPI} speedup discrete tissue generation.
}[.475\textwidth]{\includegraphics[page=2,width=.475\textwidth]{gfx/rc1/speed/boxplot_generation_output_generation_mpi_v_0.1.csv.pdf}}
\caption{\todo{resize plots}}
\end{figure}
%
\Cref{fig:speedTissueMP} visualizes the results of the speedup for \ac{OpenMP} parallelization of the discrete tissue generation algorithm.
The speedup increases linearly from $\SI{1}{\core}$ up to $\SI{8}{\core}$ up to a speedup of about $\SI{3}{}$.
For $\SIlist{16;24;32;40;48}{\cores}$ the speedup is further increased, however, is still in the range of $\SIrange{4}{5}{}$.
\par
% 
\Cref{fig:speedTissueMPI} shows the speedup for the \ac{MPI} implementation.
Here, the speedup up to $\SI{8}{\cores}$ is again linear and receives about $\SI{6.8}{}$.
The speedup from $\SI{16}{\cores}$ to $\SI{48}{\cores}$ is also linear, but the slope is decerased.
For $\SI{48}{\cores}$ a speedup of about $\SI{28}{}$ is reached.
The variance compared to the \ac{OpenMP} implentation for all number of cores is significantly lower.
\par
% 
\begin{figure}[!t]
\centering
\subcaptionbox{\label{fig:speedSimMP}
\ac{OpenMP} speedup simulation for 5 tilt direction.
}[.475\textwidth]{\includegraphics[page=2,width=.475\textwidth]{gfx/rc1/speed/boxplot_simulation_output_simulation_mp_v_0.1.csv.pdf}}
\hfill
\subcaptionbox{\label{fig:speedSimMPI}
\ac{MPI} speedup simulation including all five tilt direction.
}[.475\textwidth]{\includegraphics[page=2,width=.475\textwidth]{gfx/rc1/speed/boxplot_simulation_output_simulation_mpi_v_0.1.csv.pdf}}
\caption{\todo{resize plots}}
\end{figure}
%
Next the results of the speedup measurements for the light matter interaction are presented.
All tilt direction (flat, east, north, west and south) are simulated.
\Cref{fig:speedSimMP} shows the speedup for the \ac{OpenMP} implementation.
The results show up to $\SI{8}{\cores}$ an ideal speedup.
For further increased \ac{CPU} count up to $\SI{48}{\cores}$ the speedup is slighly lower then the ideal line with a speedup of $\SI{42}{}$ for $\SI{48}{\cores}$.
No significant cachange in the speedip for different tilt directions is visible.
\par
% 
\Cref{fig:speedSimMPI} shows the speedup for the \ac{MPI} implementation.
Again the speedup is ideal up to $\SI{8}{\cores}$.
\ac{CPU} numbers in the range of $\SIrange{16}{48}{\cores}$ the speedup is again lower then the ideal line with a speedup of about $\SI{35}{}$ for $\SI{48}{\cores}$.
Compared to the precious \ac{OpenMP} implementation the speedup is further reduced.
A significant difference in the measurement is visible for different tilt directions.
The flat measurement has the highest speedup.
%
% 
%
\section{Discussion}
%
\subsection{Single inclined fiber population}
\Cref{sec:resSingleIncl} shows the results for the case of a single fiber population with inclined configurations.
The transmittance values show an increase for the last free inclination values.
This is to be expected since the 3D model configurations are aligned in parallel along an axis with some randomness.
When this axis is aligned along the z-axis, \ie{} $\modelInc=\SI{90}{\degree}$, the light rays, which also travel along the z-axis, statistically strike less tissue, so the transmittance must increase.
Since the density of the tissue is quite high, the effect is only a few percent.
In reality, however, one must take into account that \cite{Menzel2021}\todo{check ref} could show that the change in transmittance is much more complicated.
One of the most important effects is the significant change of transmittance with inclination.
The effect on the results presented here is an increase/decrease in noise depending on \cref{fig:parameterModelGain}.
However, since the change in noise is linear with the square root of the intensity, the effect is rather small.
\par
%
The retardation almost follows the theoretical curve for a single retardation signal (see \cref{eq:pli_signal}).
However, the signal for the mean values is higher than the theoretically expected values.
One must remember that the theoretical signal is normalized by the maximum value of the retardation, \ie{} the value for $\modelInc = \SI{0}{\degree}$.
However, this value is incorrect in that the inclination angle of the underlying fibers is not perfectly $\SI{0}{\degree}$. The opening angle of the models is about \dummy{}.
Therefore, the normalization is set too low, and this is also true for the theoretical curve.
\dummy{}.
%
The direction values have a very small variance, which increases strongly at high inclination values.
Since the direction value is coupled to the inclination angle, there is no xy direction for an $\SI{90}{\degree}$ inclined orientation, as expected.
\par
%
The same behavior can be observed for the inclination curve.
However, here the variance for the last angle is lower.
It should be noted that the change in the signal that fits the tilting analysis is the same for the non-inclined measurement as for the four inclined measurements.
Therefore, one possibility is that the signal change is higher because the fibers are in their most extreme position here than in a slightly less inclined case.
\par
%
The \trel{} value also follows the theoretical behavior up to the last value.
For smaller \trel{} values, the algorithm is able to explain the signal.
For larger \trel{} values, however, the optimization fitting algorithm tries to find unphysical solutions that are mathematically better.
This behavior could be constrained by a maximum \trel{} value of one in the optimizer, but in this way it becomes clearer that the resulting orientation cannot be trusted.
This is true for the experimental tissue measurements, since there are many more effects than in this simulation.
However, for this simulation, the inclination results indicate that it is still possible for the algorithm to find a feasible \trel{} value that is very small.
Since \trel{} is the effective thickness of the parallel optical axis model, this value for inclined fiber configurations should theoretically be $\SI{0}{}$ for $\modelInc=\SI{90}{\degree}$.
\par
%
As expected, the opening angle shows the combined information from the direction results and the inclination results.
The inclination values $\modelInc <= \SI{75}{\degree}$ show an orientation distribution of \dummy{} with some outliers.
This value can perhaps serve as an additional uncertainty for further computations as in a tractography.
However, this would be a lower bound on the uncertainty since the effects of light scattering are not considered in this simulation.
\par
%
In the case of a single fiber population, the resulting tilting analysis shows good agreement with the individual orientations of the model, except for very steeply inclined configurations.
%
% 
% 
\subsection{Crossing flat fiber population}
\Cref{sec:resCrossFlat} describes the results of the flat crossing configurations.
The transmittance value changes significantly with increasing \modelOmega{}, which is to be expected since crossing models require more space.
Therefore, in a narrow volume, fewer fibers, \ie{} fewer tissues, can absorb light, and therefore the transmittance value must increase.
It is also reasonable for crossing with a volume fraction of $\modelPsi=\SI{50}{\percent}$ that the tansmittance is higher for a crossing angle of $\modelOmega=\SI{90}{\degree}$.
This is where the individual fibers have the most trouble reaching a collision-free state, resulting in more free space between them and thus higher trasmittance.
\par
%
The retardation almost decrease linear with increasing crossing angle.
Since the retardation effect of is cancelled by a $\SI{90}{\degree}$, this effect is as expected.
In the case of $\modelPsi=\SI{30}{\percent}$ only the remaining $\SI{20}{\percent}$ effect the retardation.
In the case of $\modelPsi=\SI{50}{\percent}$ statistically no remaining retardation is available.
\par
%
The direction for the flat fiber crossings follow the expected theoretical curve of the circ mean value.
For the case of $\modelPsi=\SI{50}{\percent}$ the directions take all values since no unique direction is presnet anymore in the sinosoidal curve.
This is for one the effect of the retardance canelatation as well as the noise applied to the signal.
\par
%
The variance of the inclination angle increases with increasing \modelOmega{}, which is to be expected as the amplitude, \ie{} the retardation decreases, making the model more uncertain.
In the case of a uniformly distributed fiber crossing, the inclination can reach any value since there is no longer any effective retardation.
\par
%
The same effect as for the retardation and inclination can also be seen in the decreasing value of \trel{}.
Since for the tilting analysis only one fiber model is present in the model, the \trel{} value has to follow the retardation for flat crossing fiber models.
In the case of $\modelPsi=\SI{90}{\degree}$ the tilting analysis reaches also values of $\trel>1$.
This is an effet of the tilting analysis solver algorithm.
It can be used as an indication that the resulting values are not to be trusted and the current model fails to fit the data.
\par
%
All effects described above are reflected in the opening angle \openingAngle{}, which must increase with increasing \modelOmega{}.
%
%
%
\subsection{Inclined crossing fiber population}
\Cref{sec:resInclCross} shows the results for the inclined crossing fiber population.
The transmittance and retardation results are similar to the previous flat fiber crossing.
The main difference is that the retardation does not decrease to $\SI{0}{}$ which is to be expected since only the retardance of the inclined fiber population is canceled due to the radially optical axis.
This is also visible in the behavier of the inclination, which does not follows the theoretical circ mean of both fiber populations.
\todo{try effective circ mean}
\par
% 
The effective birefingend thickness \trel{} behavies as to be expected that the effects of the inclined fiber populations neglects itself.
However especially in the case of $\modelPsi=\SI{50}{\percent}$ the \trel{} value is lower for $\modelOmega=\SI{90}{\degree}$ than half of $\modelOmega=\SI{0}{\degree}$ which one would first expected.
Due to the lower volume fraction the \trel{} value has to be lower.
\par
%
The opening angle \openingAngle{} combines the results of the direction and inclination values as to be expected for an inclined crossing fiber model.
% 
%
%
\subsection{Free crossing fiber population}
\Cref{sec:resFreeCross} shows the results of the \ac{ACC} and other parameters for the free crossing fiber population.
The \ac{ACC} parameter, which is a measure of the agreement of the \ac{ODF} coefficient, is a key parameter for highlighting problematic orientations of the fiber population.
However, the value itself is not easy to interpret.
\par
%
From \ref{fig:sim_ana_acc}, a range of low \modelPsi{} and low \modelInc{} to higher low \modelPsi{} and higher \modelInc{} is evident where the \ac{ACC} is significantly low, with larger areas near $\SI{0}{}$.
These areas correspond to the known problematic areas in intersections and inclined regions.
However, these results give a better idea of how strong the indication is with respect to the \ac{ACC} value.
The \ac{ACC} value can potentially be used as a weight for \todo{not ...}.
An important result is the correlation between the \ac{ACC} value and the \trel{} value.
As the \trel{} value is analyzed, it can be used as an indicator of an underlying intersection or oblique region.
This would then also be an indicator for further data processing \eg{} a tractography.
Note that these results are only valid for dense fiber populations, \ie{} dense white matter.
\par
%
Retardation is also an indicator, but not as reliable, since its value is very low even for a single inclined fiber population, which can still be correctly determined with a high variance using tilting analysis (see \cref{fig:single_fiber_pop_rofl}).
There, too, the \trel{} value is reduced, but not as much as in the crossing fiber populations.
This effect results from the simple fact that an inclined single fiber population increases its retardation value when tilted, while a flat crossing population does not due to signal cancellation.
\par
%
The relatively low \rvalue{} is consistent with the noise of \SI{14.3}{\percent} (see \cref{fig:noiseplot}).
The elevated patterns of \rvalue{} represent the range of a $\modelOmega \approx \SI{90}{\degree}$, where lower retardation is thus expected.
The most interesting pattern is for the case $\modelPsi = \SI{90}{\percent}$, where the \rvalue{} for the $\modelInc = \SI{0}{\degree}$ is maximum at a $\alpha_1$ \todo{check variable name} angle of $\SI{80}{\degree}$.
This is quite unexpected, since here the dominant nerve fiber population is the first one, \ie{} $\SI{90}{\percent}$.
Nevertheless, the small fraction of $\SI{10}{\percent}$ for a high inclination case seems to be sufficient to perturb the fitting algorithm based only on a single fiber population.
However, compared to the other results at this orientation, the other parameters do not appear to be perturbed in their mean values.
%
%
%
\subsection{Speedup}
%
The simulation algorithm speedup results presented in \cref{fig:speedTissueMPI,fig:speedSimMPI,fig:speedTissueMP,fig:speedSimMP} show very good speedup with increasing \ac{CPU} count, except for the \ac{OpenMP} case for the tissue generation algorithm.
Since in this case the \acsp{CPU} must write to the same memory in parallel, but not to the same memory address (see \cref{sec:dvOpti}), the overhead seems to slow down the algorithm quite a bit.
The results show that no more than $\SI{4}{\cores}$ is necessary, otherwise too much \dummy{} is lost.
However, since the \ac{MPI} implementation is quite good, the algorithm should be sped up over this implementation if needed.
\par
%
The simulation, on the other hand, has a very good speedup to $\SI{48}{\cores}$ for both the \ac{MPI} and the \ac{OpenMP}.
The \ac{OpenMP} is even stronger here.
This is the case because the \ac{OpenMP} implementation does not need to communicate with each other, and since the rest of the memory accesses are random anyway, the light beams can be ideally parallized.
The same is true for the \ac{MPI} implementation, except for the tilted case.
Since the volume is shared here, the light rays must be communicated, which takes time.
Therefore, the speed increase is lower here.
\par
%
Since the mesh generation algorithm is quite fast overall ($\SI{30}{\second}$) compared to the simulation ($\SI{80}{\second}$), which usually requires five times as much for the $\SI{4}{}$ additional tilt angles, the letter algorithm is the bottleneck anyway.
Therefore, the user can use both implementations to significantly improve the overall speed of the calculations.
