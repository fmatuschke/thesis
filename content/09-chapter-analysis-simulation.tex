\cleardoublepage
\setcounter{chapter}{8}
\chapter{3D-PLI simulation}
\label{cha:simulation_analysis}
%
\section{Introduction}
%
This chapter deals with the simulation of \ac{3D-PLI} with the generated model library.
The first part focuses on the determination of all necessary physical parameters of the tissue and the microscope as well as on the characterization of the simulation parameters.
Then, the simulation of the previously generated nerve fiber models is created and analyzed.
The orientation of the simulations is calculated using the routine algorithms implemented in \ac{fastPLI}.
The focus of the evaluation is on the accuracy of the tilt analysis for different orientations and crossing configurations.
%
%
%
\section{Parameter characterisation}\label{sec:sim_choose_parameters}
%
\subsection{Tissue}\label{sec:tissueProp}
%
\begin{figure}[t]
% 2_simulation/0_parameter/measure_vervet.ipy
\centering
\setlength{\tikzwidth}{0.425\textwidth}
\setlength{\tabcolsep}{0em}
\begin{tabular}{C{0.5\textwidth}C{0.5\textwidth}}
%
\tikzset{external/export next=false}% takes long for the first time
\inputtikz{gfx/data/vervet_transmittance_zoom} &
\inputtikz{gfx/data/vervet_transmittance_hist} \\[-5mm]
%
\subcaptiontab{0.475\textwidth}{Transmittance.} &
\subcaptiontab{0.475\textwidth}{\label{fig:histTrans}Histogram transmittance.} \\[10mm]
%
\tikzset{external/export next=false}
\inputtikz{gfx/data/vervet_retardation_zoom} &
\inputtikz{gfx/data/vervet_retardation_hist} \\[-5mm]
%
\subcaptiontab{0.475\textwidth}{Retardation.} &
\subcaptiontab{0.475\textwidth}{\label{fig:histRet}Histogram retardation.} 
\end{tabular}
\caption{
Transmittance and retardation map of coronal section $\SI{549}{}$ of a vervet monkey.
The absorption coefficient and birefringence is estimated from the measurments in the corpus calosum (CC).
Two homogeneous regions are labeled for this purpose.
The left are include $\SI{1125858}{\pixel}$ and the right area $\SI{1064629}{\pixel}$.
}
\label{fig:brain_ret_trans_zoom}
\end{figure}
%
The absorption coefficient $\absorp{}$ and the birefringence $\dn{}$ have to be estimated from a measured section for the simulation.
To measure the values, it is important to analyze a homogeneous region filled with flat, dense fibers.
In a coronal section, the corpus callosum (CC) is suitable for this purpose. 
It is the main fiber connection between the two cerebral hemispheres.
\par
% 
\Cref{fig:brain_ret_trans_zoom} shows transmittance and retardation maps of the coronal section $\SI{549}{}$ of a Vervet monkey.
Two \ac{ROI} are manually selected in homogeneous and high retardence regions of the corpus calosum.
The left region contains $\SI{1125858}{\pixel}$ and the right \ac{ROI} $\SI{1064629}{\pixel}$.
The entire section and the analysis for a human and a rodent section are available in the Appendix (see \cref{app:brain_rodent,app:brain_vervet,app:brain_human}).
% 
\paragraph{Evaluation}
To calculate the absorption coefficient for the models, one must consider the volume fraction.
For the models $\fiberRadiusMean = \SI{0.5}{\micro\meter}$, the volume fraction is about $\SI{75}{\percent}$.
The average transmittance in the foreground is about $\SI{1000}{\arbitraryunit}$ and in the background about $\SI{4500}{\arbitraryunit}$.\footnote{The relative transmittance can be changed by adjusting the exposure time of the microscope}
This results in an absorption coefficient of about $\mu = \SI{30}{\milli\meter\tothe{-1}}$.
To calculate birefringence, one must also take into account the g-ratio, \ie{} the myelin thickness.
A g-ratio of $\SI{75}{\percent}$ gives a birefringence of about $\SI{0.008}{}$ for the radial model when using a median value of the retardation of $\SI{0.8}{}$.
%
% 
% 
\subsection{Optical resolution}
%
The optical resolution depends, among other things, on aberration and diffraction (see \cref{sec:opticalResolution}).
They are modeled as described in \cref{sec:ccdOptic}.
Therefore, the model parameters must be determined for the microscopes to be simulated.
\par
%
To measure the optical resolution of the microscope, previous measurements and analyses are repeated \cite{MenzelMaster}.
For this purpose, the \textit{1951 United States Air Force (USAF) resolution test chart}\footnote{U.S. Air Force MIL-STD-150A standard of 1951} is used.
It consists of several patterns that have three slots with specific spacing and width (see \cref{fig:usaf}).
They are arranged in fields of three vertical and horizontal lines.
The fields are arranged in a spiral that shrinks from group to group by a factor $\SI{0.5}{}$.
To determine the line width, the fields are numerically ordered according to a main group $i$ and a subgroup $j$.
To determine the resolution of the microscope, it is necessary to determine the group from which the slits can still be resolved according to the Rayleigh criterion (see \cref{fig:rayleigh}).
For this purpose, the intensity profiles perpendicular to the three vertical and horizontal slits are analyzed.
% 
\paragraph{Evaluation}
%
\begin{figure}[!t]
\centering
\setlength{\tikzwidth}{0.35\textwidth} % bigger than 0.475 images???
\setlength{\tabcolsep}{0em}
\begin{tabular}{C{0.5\textwidth}C{0.5\textwidth}}
%
\includegraphics[height=\tikzwidth]{gfx/wiki/USAF-1951.pdf} &
\inputtikz{gfx/chap8/usaf_image} \\[-1em]
% 
\subcaptiontab{0.475\textwidth}{\label{fig:usaf}USAF chart from group -2 to 1: \url{https://en.wikipedia.org/wiki/1951_USAF_resolution_test_chart}} &
\subcaptiontab{0.475\textwidth}{\label{fig:usaf_image}Microscopic image with highlighted groups 7-6 to 8-2.} \\[4em]
% 
\inputtikz{gfx/chap8/usaf_line_plots_lr} &
\inputtikz{gfx/chap8/usaf_line_plots_up} \\[-1em]
%
\subcaptiontab{0.475\textwidth}{\label{fig:usaf_lines_lr}Centered line plots horizontal slits.} &
\subcaptiontab{0.475\textwidth}{\label{fig:usaf_lines_ud}Centered line plots vertical slits.}
% 
\end{tabular}
\caption{Group 8-1 of the USAF chart with a line width of $\SI{1.95}{\micro\meter}$ corresponts to the Raileigh criteria. Therefore an optical convolution of $\opticsigma = \SI{0.75}{\pixel}$ will be applied in the simulation.}
\label{fig:USAF}
\end{figure}
% 
\Cref{fig:usaf_image} shows a section of the image taken with the \ac{LMP} microscope.
The highlighted areas show the analyzed groups 7-6 to 8-2.
The area of group 7-6 \raisebox{.25em}{\tikzset{external/export next=false}\tikz \draw[RED,ultra thick,dashed](0,0)--(0.25,0);} has a linewidth of $\SI{2.19}{\micro\meter}$, group 8-1 \raisebox{.25em}{\tikzset{external/export next=false}\tikz \draw[GREEN,ultra thick,dashed](0,0)--(0.25,0);} of $\SI{1.95}{\micro\meter}$ and group 8-2 \raisebox{.25em}{\tikzset{external/export next=false}\tikz \draw[BLUE,ultra thick,dashed](0,0)--(0.25,0);} of $\SI{1.74}{\micro\meter}$.
The intensity line profiles for the vertical and horizontal cases are shown in \cref{fig:usaf_lines_lr,fig:usaf_lines_ud}.
The Rayleigh criterion can be used to determine the resolution in the second group, which is thus in the range of $\SI{1.95}{\micro\meter}$.
This reproduces the measurements in the \cite{MenzelMaster}.
Therefore, for the simulation the convolution parameter is set to $\opticsigma = \SI{0.75}{\pixel}$ (see \cref{sec:opticalResolution}).
%
%
%
\subsection{Sensor gain and signal noise}\label{sec:sensorGain}
%
\begin{figure}[!t]
\centering
%
% \tikzset{external/export=false}
\setlength{\tikzwidth}{0.3\textwidth}
\setlength{\tikzheight}{0.3\textwidth}
% \tikzset{external/force remake}
%
\setlength{\tabcolsep}{0em}
\begin{tabular}{C{0.5\textwidth}C{0.5\textwidth}}
% \tikzset{external/remake next}
\inputtikz{gfx/pli/pli_focus}
&
\inputtikz{gfx/2/PM_000_image}
\\[-1em]
%
% SUBCAPTIONS
\subcaptiontab{0.475\textwidth}{\label{fig:pliFocus}Scheme of unfocused microscopic image.} &
\subcaptiontab{0.475\textwidth}{\label{fig:pliFocusImage}Microscopic image} \\[2em]
%
% \tikzset{external/remake next}
\inputtikz{gfx/data/PM_noise}
&
\inputtikz{gfx/data/theo_noise}
\\[-1em]
%
% SUBCAPTIONS
\subcaptiontab{0.475\textwidth}{\label{fig:parameterModelNoise} Linear regression results in a gain factor of $\opticgain_{\mathit{LMP}} = \SI{0.1175}{}(?)$.} &
\subcaptiontab{0.475\textwidth}{\label{fig:noiseplot}Expected noise range for human, vervet monkey and rodent. The noise correlates linearly with the light intensity.}
\end{tabular}
%
\caption{Camera noise measurements.}
\label{fig:parameterModelGain}
\end{figure}
%
As described in \cref{sec:ccdOptic}, the optical noise is modeled with a Gaussian model.
The gain factor of a \ac{CCD} camera describes the linearity between a measured electrical signal and the output signal.
This can also be used to calculate the noise, since it correlates with $\sqrt{I \cdot \opticgain}$ \cite{Wiese:887678}.
To measure the noise, the gain is measured by taking several images with different pixel intensities.
For this purpose, the sample stage is covered with a fully absorbing cover so that half of the image is dark.
In addition, the focal length is changed so that the light is distributed over the entire image sensor under the cover (see \cref{fig:pliFocusImage}).
By measuring $N=\SI{500}{}$ images, the variance for the different intensity values is determined.
%
\paragraph{Evaluation}
The results are shown in \cref{fig:parameterModelNoise} and show a gain factor of $\opticgain_{\mathit{LMP}} = \SI{0.1175}{}(?)$.
This gain factor is used to model the integer noise with
\begin{align}
f(x) = \floor{\mathrm{normal}(\mu = x, \sigma=\sqrt{\opticgain x})+0.5}
\end{align}
for intensities $I > 0$ and $I \gg \sqrt{\opticgain I}$.
%
%
%
\subsection{\Voxelsize{} \texorpdfstring{\voxelsize{}}{}}
%
The parameter \Voxelsize{} $\voxelsize$ is the most important parameter for simulation accuracy, as it determines how accurately the models are discretized and how many light rays are modeled.
However, the voxel size cannot be arbitrarily small because the number of calculations and memory consumption increase by $O(n_{\mathit{voxel}}^3)$.
Therefore, it is recommended that the voxel size be as large as possible without introducing significant errors due to discretization.
\par
%
To investigate this effect, a simulation with several voxel sizes in the range of $\voxelsize = \SIrange{0.01}{1.3}{\micro\meter}$ is performed.
The smallest voxel size $\SI{0.01}{\micro\meter}$ is used as a reference.
Since this voxel size is so small, the simulated volume is $3 \cdot \SI{1.3}{\micro\meter} \times 3 \cdot \SI{1.3}{\micro\meter} \times \SI{60}{\micro\meter}$ without tilts.
Otherwise, the number of voxels and thus the memory consumption is too high.
During the simulation, the previously determined tissue and noise parameters are used.
The models to be simulated are $(||,\modelInc = \SI{0}{\degree})$, $(||,\modelInc = \SI{90}{\degree})$, $(\!\times\!, \modelInc = \SI{0}{\degree})$, and $(\!\times\!,\modelInc = \SI{90}{\degree})$ with a fraction of $\modelPsi = \SI{0.5}{}$, since these configurations represent the extrema for two fiber populations.
For statistic the simulations are repeated $\SI{25}{}$ times at the positions
\begin{align}
\begin{split}
    x&=\frac{i\,\%\,5}{5} \cdot \SI{60}{\micro\meter} - \SI{30}{\micro\meter} \\
    y&=\frac{\floor{i/5}}{5} \cdot \SI{60}{\micro\meter} - \SI{30}{\micro\meter} 
\end{split}
\end{align}
% 
% 
% 
\paragraph{Evaluation}
%
\begin{figure}[!t]
% 2_simulation/0_parameter/fiber_radii.py
\centering
\includegraphics[width=\textwidth, page=1]{gfx/rc1/voxel_size/voxel_size_plots_data_r05_output_vs_135_0.01_6_25_vervet_r_rc1.pdf}
\caption{The mean difference is constant for smaller voxel sizes and starts to grow significantly only from $\voxelsize=\SI{0.1}{\micro\meter}$.}
\label{fig:voxelsizeNoise}
\end{figure}
% 
The results in \cref{fig:voxelsizeNoise} show that the relative difference to the smallest voxel size increases statically significantly from a value of $\SI{0.1}{\micro\meter}$.
The variance of the relative difference increases with increasing voxel size from this value.
Smaller than $\SI{0.1}{\micro\meter}$, the difference from the reference simulation does not increase.
Therefore, the voxel size $\voxelsize = \SI{0.1}{\micro\meter}$ is a good compromise between runtime and accuracy.
One has to keep in mind that this is only valid for a pixel size of $\SI{1.3}{\micro\meter}$ and fiber radii of $\SI{0.5}{\micro\meter}$.
% 
%
%
\newpage % TODO: check if necessary
\section{Simulation}
%
\subsection{Parameters}
\label{sec:simParameterEnv}
% 
\begin{table}[!b]
\caption{Simulation parameters.}
\centering
% \sisetup{open-bracket={\{}, close-bracket={\}}, list-final-separator={,},list-pair-separator={,}}%
\pgfplotstabletypeset[%
    thesisTableStyle,
    column type=l,
    columns/variable/.style={string type},
    columns/value/.style={string type},
    every head row/.style={before row=\toprule,after row=\midrule},
    every last row/.style={after row=\bottomrule},
    col sep=&,
    row sep=\\,
]
{variable & value\\
%
simpli.voxel\_size & $\SI{0.1}{\micro\meter}$\\
simpli.pixel\_size & $\SI{1.3}{\micro\meter}$\\
simpli.voi & $[[\SI{-35}{\micro\meter}, \SI{-35}{\micro\meter}, \SI{-30}{\micro\meter}], [\SI{35}{\micro\meter}, \SI{35}{\micro\meter}, \SI{30}{\micro\meter}]]$\\
simpli.filter\_rotations & $\SIlist{0;20;40;60;80;100;120;140;160}{\degree}$\\
simpli.interpolate & \texttt{"Slerp"}\\
simpli.wavelength & $\SI{525}{\nano\meter}$\\
simpli.optical\_sigma & $\SI{0.75}{\pixel}$\\
tilt angle & $\SI{3.9}{\degree}$\\
simpli.light\_intensity & $\SI{8000}{}$\\
gain & $\SI{0.1175}{}$\\
simpli.noise\_model & \code{lambda x: np.floor(np.random.normal(x,}\\
 & \ \ \ \ \ \code{np.sqrt(gain * x))+0.5).astype(np.uint16)}\\
fiber absorption & rodent: $\SI{14}{\milli\meter\tothe{-1}}$, Vervet: $\SI{30}{\milli\meter\tothe{-1}}$, human: $\SI{60}{\milli\meter\tothe{-1}}$\\
fiber birefringence model & 'r'\\
fiber birefringence & 0.008\\
fiber radii scale factor & axon: $\SI{0.75}{}$, myelin: $\SI{1}{}$\\
model inclination step $\Delta\modelInc$ & single: $\SI{5}{\degree}$, crossings: $\SI{30}{\degree}$\\
model rotation step $\Delta\modelRot$ & $\SI{15}{\degree}$\\
}
\label{tab:simParameters}
\end{table}
%
As described in \cref{chap:Software}, \ac{fastPLI} contains a pipeline implementation of the simulation with automatic analysis.
This implementation is used to compute the simulation of the signal for the flat and tilted measurements and apply the optical noise and tilt analysis to the resulting signal using the \ac{ROFL} algorithm. 
The input for the simulation is the previously created model library (see \cref{sec:genNerveFiberLibrary}).
The models are rotated according to the previously specified discretization to include all specified orientations (see \cref{sec:modelParamet}).
\par
% 
\Cref{tab:simParameters} lists the parameters of the simulation in the variable notation of \ac{fastPLI}.
With a pixel size of $\SI{1.3}{\micro\meter}$, $\SI{2500}{\pixel}$ are available per simulation for statistical analysis.
The models are tilted in steps of $\Delta \modelInc = \SI{5}{\degree}$ for a single fiber population and by $\Delta \modelInc = \SI{30}{\degree}$ for two fiber populations.
\par
% 
The following sections will only show a subset of the results. 
All following results all data is available in \cref{app:single_fiber_pop_hist}.
% 
% 
% 
\subsection{Single inclined fiber population}
\label{sec:resSingleIncl}
%
\begin{figure}[!t]
\centering
\includegraphics[page=1]{gfx/rc1/analysis/plots_single_pop_hist_output_cube_2pop_135_rc1_single.pdf}
\caption{Single inclined fiber population orientation histograms.}
\label{fig:single_fiber_pop_hist}
\end{figure}
%
\begin{figure}[!p]
\centering
\includegraphics[]{gfx/rc1/analysis/plots_single_pop_output_cube_2pop_135_rc1_single.pdf}
\caption{Single tilted fiber population. Results of the tilt analysis. \todo{trel, domega, xachse}, \todo{gleiche binbreite}}
\label{fig:single_fiber_pop_rofl}
\end{figure}
%
First, a single population of fibers is simulated and analyzed.
Since the direction is negligible for a single population, only the inclination parameter \modelInc{} remains.
\par
%
\Cref{fig:single_fiber_pop_hist} shows the orientation distribution of a single population of fibers for different inclinations $\modelInc{}$.
The distributions of the orientations of the model segments are shown on the left side, and those of the tilt analysis of the simulations are shown on the right side.
The simulation results agree with the orientations of the models.
The variance of the tilt analysis is higher than that of the model orientations.
\par
%
\Cref{fig:single_fiber_pop_rofl} show the modalities transmittance, direction and retardation of the flat measurement as well as the results of the tilt analysis inclination, \trel{} and the resulting opening angle $\openingAngle$.
\par
% 
%Transmittance
The transmittance increases slightly with inclination angle for $\modelInc<\SI{75}{\degree}$.
For $\modelInc \ge \SI{75}{\degree}$ the transmittance increases significantly.
The variance of the transmittance is within a few percent for all inclinations and also increases slightly with the inclination angle.
\par
%
% Retardation
The retardation plot shows the retardation of the non-tilted simulations and the theoretical curve that follows $(\cos(\modelInc) + 1) / 2 \cdot \mean\left(\mathrm{ret}(\SI{0}{\degree})\right)$.
Normalization with $\mean\left(\mathrm{ret}(\SI{0}{\degree})\right)$ ensures comparison with the data.
The retardation follows the theoretical line.
However, at the intermediate inclination angles, the measured retardation is slightly higher than the theoretical line.
The variance along all fiber inclinations is equal to \modelInc{}.
\par
%
% Direction
The next graph shows the measured direction.
For inclination angles smaller than $\SI{75}{\degree}$ the variance remains relatively small.
For larger values, the variance increases.
It should be noted that the boxplot does not take into account that the values are periodic.
Therefore, especially for $\modelInc=\SI{90}{\degree}$, the values from the $\SIrange{-90}{90}{\degree}$ are uniformly distributed.
\par
%
% Inclination
% \TODO{differnt symbol between modelinc and inc?}
The inclination shows the results of the tilt analysis with a dashed line for the model inclination $\modelInc$.
The results are centered around the median value in the range of $\big[\median (\modelInc)-\SI{90}{\degree}, \median(\modelInc)+\SI{90}{\degree}\big)$.
The median follows the theoretical curve.
For inclinations $\SI{80}{\degree}$ and $\SI{85}{\degree}$, the variance increases significantly.
For $\modelInc = \SI{90}{\degree}$ the variance is similar to the flat results.
\par
%
% trel
The median relative birefringence thickness \trel{} is stable for values up to $\modelInc < \SI{60}{\degree}$, but the variance increases slightly.
For larger values, the median decreases while the variance increases.
There are outliers that reach values $>\SI{1}{}$.
For inclination angles $\modelInc \ge \SI{85}{\degree}$, the quartile value $\SI{75}{\percent}$ increases by $\SI{1}{}$ and the median for $\SI{90}{\degree}$ reaches about $\SI{2}{}$.
\par
%
% domega
The opening angle \openingAngle{} is consistent up to a tilt angle of $\le \SI{70}{\degree}$.
For higher inclination angles, both the median and the variance increase significantly, analogous to the inclination, except in the last case.
%
%
%
\subsection{Crossing flat fiber populations}
\label{sec:resCrossFlat}
%
\begin{figure}[!p]
\centering
\includegraphics[page=3]{gfx/rc1/analysis/plots_flat_pop_hist_output_cube_2pop_135_rc1_flat.pdf}
\caption{Crossing flat fiber population: $\modelPsi=\SI{30}{\percent}$.}
\label{fig:flat_03_fiber_pop_hist}
% 
\vspace{2em}
\includegraphics[page=5]{gfx/rc1/analysis/plots_flat_pop_hist_output_cube_2pop_135_rc1_flat.pdf}
\caption{Crossing flat fiber population: $\modelPsi=\SI{50}{\percent}$.}
\label{fig:flat_05_fiber_pop_hist}
\end{figure}
%
The next simulation focuses on two flat crossing fiber populations.
Here, the results for the case $\modelPsi = \SI{30}{\percent}$ and $\modelPsi = \SI{50}{\percent}$ are examined.
The other proportions of the fiber population are available in \todo{Appendix}.
\par
%
\Cref{fig:flat_03_fiber_pop_hist,fig:flat_05_fiber_pop_hist} shows the distribution of orientations for the model fiber segments and the resulting simulation orientations.
\par
% 
The results for $\modelPsi = \SI{30}{\percent}$ show that the measured orientation follows the dominant fiber population.
Minor differences are seen in the range of $\SI{45}{\degree}$.
In the case of $\modelPsi = \SI{50}{\percent}$, the measured orientation lies between the two fiber populations.
An exception is the crossing case of $\modelOmega=\SI{90}{\degree}$, where the measured orientations are quite random around steep orientations.
\par
%
\begin{figure}[!p]
\centering
\includegraphics[page=3]{gfx/rc1/analysis/plots_flat_pop_output_cube_2pop_135_rc1_flat.pdf}
\caption{Crossing flat fiber population: $\modelPsi=\SI{30}{\percent}$. Tilting analysis results. \todo{domega, trel, omega, dotted line more space, title in percent}, \todo{theoretische kurve ret} \TODO{models angular values}}
\label{fig:flat_03_fiber_pop_rofl}
\end{figure}
%
\begin{figure}[!p]
\centering
\includegraphics[page=5]{gfx/rc1/analysis/plots_flat_pop_output_cube_2pop_135_rc1_flat.pdf}
\caption{Crossing flat fiber population: $\modelPsi=\SI{50}{\percent}$. Tilting analysis results.}
\label{fig:flat_05_fiber_pop_rofl}
\end{figure}
% 
\Cref{fig:flat_03_fiber_pop_rofl,fig:flat_05_fiber_pop_rofl} show the results of \ac{3D-PLI} modalities and tilt analysis and opening angle in detail.
\par
% Transmittance
The transmittance increases with increasing crossing angle \modelOmega{}.
The two fiber population fractions \modelPsi{} show the same behavior.
The transmittance increases initially and becomes flatter at larger crossing angles.
In the case of $\modelPsi = \SI{30}{\percent}$, it starts at a transmittance of about $\SI{1000}{\arbitraryunit}$ and reaches a value of about $\SI{1090}{\arbitraryunit}$ for a crossing angle of $\SI{90}{\degree}$.
In the case of $\modelPsi = \SI{50}{\percent}$, it reaches a slightly higher value of $\SI{1110}{\arbitraryunit}$.
\par
% Retardation
Retardation is negatively linearly correlated with increasing crossing angle for both fiber population fractions \modelPsi{}.
For $\modelPsi=\SI{30}{\percent}$, the retardation starts at $\SI{0.8}{}$ and drops to about $\SI{0.3}{}$.
In the case of $\modelPsi=\SI{50}{\percent}$, it also starts at $\SI{0.8}{}$ and drops to almost $\SI{0}{}$.
For both fiber population fractions, the variance increases slightly with the crossing angle.
In the case of $\modelPsi=\SI{50}{\percent}$ and $\modelOmega=\SI{90}{\degree}$, the variance is again smaller.
\par
% Direction
The direction for both fiber population fractions \modelPsi{} follows the theoretical \name{circmean} function (dashed line).
For both \modelPsi{}, the variance of the direction increases with increasing crossing angle \modelOmega{}.
In the case of $\modelPsi=\SI{50}{\percent}$ and a crossing angle of $\modelRot = \SI{90}{\degree}$, the directions are distributed over the entire range of values.
\par
% Inclination
The inclination is about $\SI{0}{\degree}$ with its median for both fiber population fractions and all crossing angles.
The variance increases with increasing crossing angle, up to about $\SI{3}{}$ times the lowest value in the case of $\modelPsi = \SI{30}{\percent}$.
In the case of $\modelPsi = \SI{50}{\percent}$, the increase is much stronger, until for the $\modelRot=\SI{90}{\degree}$ the inclinations are distributed over the whole range of values.
\par
% Trel
The relative thickness \trel{} decreases with increasing crossing angle \modelOmega{}.
The shape of the curve correlates negatively with increasing crossing angle.
In both cases, the \trel{} values start at about $\SI{0.6}{}$.
For $\modelPsi = \SI{30}{\percent}$, the \trel{} value drops to $\SI{0.2}{}$, while for $\modelPsi = \SI{50}{\percent}$, the \trel{} value drops almost to $\SI{0}{}$.
For both fiber population fractions, the variance increases slightly.
For $\modelPsi = \SI{50}{\percent}$ and $\modelOmega = \SI{90}{\degree}$, the variance of \trel{} increases significantly.
Outliers are also visible, reaching \trel{} values $>\SI{1}{}$.
\par
% domega
The opening angle \openingAngle{} is similar for both fiber population fractions up to a crossing angle of $\modelOmega=\SI{70}{\degree}$.
For higher values in the case of $\modelPsi = \SI{50}{\percent}$, the values increase significantly more.
The variance increases with increasing crossing angle for both fiber population fractions.
In the case of $\modelPsi = \SI{50}{\percent}$ and $\modelOmega = \SI{90}{\degree}$, the opening angles are distributed over the entire range of values.
% 
% 
%
\subsection{Inclined crossing fibers population}
\label{sec:resInclCross}
%
\begin{figure}[!p]
\centering
\includegraphics[page=3]{gfx/rc1/analysis/plots_inclined_pop_hist_output_cube_2pop_135_rc1_inclined.pdf}
\caption{Population of inclined crossing fibers: $\modelPsi=\SI{30}{\percent}$.
}
\label{fig:inclined_03_fiber_pop_hist}
% 
\vspace{2em}
\includegraphics[page=5]{gfx/rc1/analysis/plots_inclined_pop_hist_output_cube_2pop_135_rc1_inclined.pdf}
\caption{Population of inclined crossing fibers: $\modelPsi=\SI{50}{\percent}$.
}
\label{fig:inclined_05_fiber_pop_hist}
\end{figure}
%
The orientation histograms of the inclined models and their simulation results are shown in \cref{fig:inclined_03_fiber_pop_hist,fig:inclined_05_fiber_pop_hist}.
In the case of fiber population fraction $\modelPsi=\SI{30}{\percent}$, the inclination of the simulation follows the inclination of the models, but with lower values.
For a crossing of $\modelOmega=\SI{90}{\percent}$, the resulting orientations are flat like the first fiber population.
For $\modelPsi=\SI{50}{\percent}$ the same behavior is visible, but the difference in inclination is larger and for $\modelOmega=\SI{30}{\percent}$ and $\modelOmega=\SI{60}{\percent}$ the inclinations are between both fiber populations.
\par
%
\begin{figure}[!p]
\centering
\includegraphics[page=3]{gfx/rc1/analysis/plots_inclined_pop_output_cube_2pop_135_rc1_inclined.pdf}
\caption{Population of inclined crossing fibers: $\modelPsi=\SI{30}{\percent}$. Results of tilt analysis.}
\label{fig:inclined_03_fiber_pop_rofl}
\end{figure}
%
\begin{figure}[!p]
\centering
\includegraphics[page=5]{gfx/rc1/analysis/plots_inclined_pop_output_cube_2pop_135_rc1_inclined.pdf}
\caption{Population of inclined crossing fibers: $\modelPsi=\SI{50}{\percent}$. Results of tilt analysis.}
\label{fig:inclined_05_fiber_pop_rofl}
\end{figure}
%
\Cref{fig:inclined_03_fiber_pop_rofl, fig:inclined_05_fiber_pop_rofl} show the results of \ac{3D-PLI} modalities and tilt analysis and opening angle in detail.
\par
% Transmittance
The transmittance increases with increasing crossing angle \modelOmega{}.
The two fiber population fractions \modelPsi{} show the same behavior.
The transmittance increases initially and becomes flatter at larger crossing angles.
In the case of $\modelPsi = \SI{30}{\percent}$, it starts at a transmittance of about $\SI{1000}{\arbitraryunit}$ and reaches a value of about $\SI{1100}{\arbitraryunit}$ for a crossing angle of $\SI{90}{\degree}$.
In the case of $\modelPsi = \SI{50}{\percent}$, it reaches a slightly higher value of $\SI{1110}{\arbitraryunit}$.
\par
% Retardation
Retardation is negatively linearly correlated with increasing crossing angle for both fiber population fractions \modelPsi{}.
For $\modelPsi=\SI{30}{\percent}$, the retardation starts at $\SI{0.8}{}$ and drops to about $\SI{0.18}{}$.
In the case of $\modelPsi=\SI{50}{\percent}$, it also starts at $\SI{0.8}{}$ and drops to about $\SI{0.3}{}$.
For both fiber population fractions, the variance increases as the crossing angle increases.
In the case of $\modelPsi=\SI{50}{\percent}$, the variance increases significantly more.
\par
% Direction
The direction for both fiber population fractions \modelPsi{} is centered around $\SI{0}{\degree}$.
For both \modelPsi{}, the variance of the direction increases with increasing crossing angle \modelOmega{}.
No significant effect is seen between the two fiber population fractions.
\par
% Inclination
The inclination for both fiber population fractions first increases and then decreases to a value of $\SI{0}{\degree}$.
In the case of $\modelPsi=\SI{30}{\percent}$, the maximum inclination is reached at a crossing angle of about $\modelOmega=\SIrange{60}{70}{\degree}$.
For $\modelPsi=\SI{50}{\percent}$, the maximum value is at a crossing angle of about $\modelOmega=\SIrange{50}{60}{\degree}$.
The theoretical curve representing the average of the two fiber population inclinations is followed in both cases only up to a crossing angle of about $\SI{30}{\degree}$.
\par
% Trel
The relative thickness \trel{} decreases almost linearly with increasing crossing angle \modelOmega{} for both fiber population fractions.
In both cases, the \trel{} values start at about $\SI{0.6}{}$.
For $\modelPsi = \SI{30}{\percent}$, the \trel{} value drops to $\SI{0.1}{}$, while for $\modelPsi = \SI{50}{\percent}$, the \trel{} value drops almost to $\SI{0.2}{}$.
For the fiber population fraction $\modelPsi = \SI{30}{\percent}$, the variance increases in the middle range of values $\modelOmega=\SIrange{40}{70}{\degree}$.
In this range, the \trel{} values are slightly increased, contrary to a linear trend.
The second fiber population fraction case $\modelPsi = \SI{50}{\percent}$ shows a small increase in variance with increasing crossing angle.
\par
% domega
The opening angle \openingAngle{} for $\modelPsi=\SI{30}{\percent}$ increases with increasing crossing angle \modelOmega{}.
The increase increases significantly for crossing angles up to $\modelOmega=\SI{90}{\degree}$, but remains below a median value of about $\openingAngle=\SI{10}{\degree}$.
For $\modelPsi=\SI{50}{\percent}$, the opening angle increases linearly up to a crossing angle of $\modelOmega=\SI{80}{\degree}$ and remains the same for $\modelOmega=\SI{90}{\degree}$.
For both fiber population fractions, the variance increases with increasing crossing angle.
In the case of $\modelPsi=\SI{50}{\percent}$, the variance is about half that for $\modelPsi=\SI{30}{\percent}$.
%
% 
% 
\subsection{Free crossing fiber populations}
\label{sec:resFreeCross}
%
In this section, a subset of the simulated nerve fiber models is presented.
The remaining results are available in \todo{appendix}.
A polar plot visualization is used to visualize the results from the \ac{3D-PLI} analysis pipeline (see \cref{fig:simModelSphereSample}).
Each polar plot visualizes the results for a fixed first fiber population \popa{}.
A spherical k-nearest neighbor interpolator is used to interpolate between the positions \cite{DBLP:journals/corr/abs-1910-00704}.
% The results for direction and inclination are not shown because interpolation with the circmean function does not work. %TODO: check
% 
\begin{figure}[t]
\centering
\setlength{\tikzwidth}{0.40\textwidth}
\subcaptionbox{The spheres surface is sampled around the first fiber population axis $\popa$ of inclination $\modelInc$ with a crossing angle $\modelOmega$ and a rotation $\modelRot$.}
[.475\textwidth]{\inputtikz{gfx/model/sphere_models_c}}
\hfill
\subcaptionbox{
    A polar diagram is used to illustrate the scalar results of a fixed orientation of the first fiber population \popa{} and a variable orientation of the fiber population \popb{}.
    The orientation \popa{} is marked with a black thick circle.
    The second orientation is indicated by dashed circles.
    For visualization, the scalar values are interpolated according to a spherical k-nearest neighbor interpolator algorithm.
}
[.475\textwidth]{\inputtikz{gfx/model/sphere_hist_b}}
\caption{Visualization of results for a fixed first fiber population \popa{}.}
\label{fig:simModelSphereSample}
\end{figure}
%
The spherical plots in \cref{fig:sim_ana_trans,fig:sim_ana_ret,fig:sim_ana_trel,fig:sim_ana_acc} are designed so that the thick black circle shows the orientation of the first fiber population and the thin dashed circles show the orientation of the second fiber population.
At the position of the second fiber population, the resulting mean value is inserted.
%
%
%
\paragraph{Transmittance}
% 
\begin{figure}[!p]
\centering
\includegraphics[]{gfx/rc1/analysis/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_trans_mean.pdf}
\caption{Mean transmittance value.}
\label{fig:sim_ana_trans}
\end{figure}
% 
The average transmission value is visualized in \cref{fig:sim_ana_trans}.
The first fiber population fraction $\modelPsi=\SI{10}{\percent}$ is almost identical for all inclination angles $\modelInc$.
The transmittance is lowest for models with a crossing angle of $\modelOmega = \SI{0}{\degree}$ and for flat configurations.
\par
%
For a fiber population fraction of $\modelPsi=\SI{30}{\percent}$, the transmittance increases significantly.
It is again lowest for a crossing angle of $\modelOmega=\SI{0}{\degree}$.
The same behavior holds for $\modelPsi=\SIlist{50,70}{\percent}$.
$\modelPsi=\SI{50}{\percent}$ achieves the highest transmittance for fiber models with crossings.
\par
% 
The average transmittance for the last fiber population fraction $\modelPsi=\SI{30}{\percent}$ is again reduced similar to the first case.
Again, only fiber configurations with no crossing remain the lowest transmittance for all inclinations $\modelInc$.
%
% 
% 
\paragraph{Retardation}
% 
\begin{figure}[!p]
\centering
\includegraphics[]{gfx/rc1/analysis/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_ret_mean.pdf}
\caption{Mean retardation values.}
\label{fig:sim_ana_ret}
\end{figure}
% 
Retardation results are shown in \cref{fig:sim_ana_ret}.
For a fiber population fraction of $\modelPsi=\SI{10}{\percent}$, the smallest retardation values are visible for secondary fiber populations with an inclination of $\SI{90}{\degree}$.
Configurations with a high crossing angle $\modelOmega$ are slightly reduced.
Flat fiber configurations retain a high retardation value.
\par
%
The same behavior is also visible for fiber population fraction $\modelPsi=\SIlist{30;50;70}{\percent}$, but the retardation values are significantly reduced, especially for high first fiber population inclinations.
The reduction in retardation at high crossing angles $\modelOmega$ is also more pronounced, especially for $\modelPsi=\SI{50}{\percent}$.
For fiber population fractions $\modelPsi \geq \SI{50}{\percent}$ and first fiber population inclinations $\modelInc \geq \SI{60}{\degree}$, the retardation is close to $\SI{0}{}$.
\par
%
For $\modelPsi=\SI{90}{\percent}$, no reduction of retardation is visible for different crossing angles $\modelOmega$.
The retardation value is stable for each first fiber inclination parameter.
However, the retardation decreases significantly with increasing inclination $\modelInc$ until it is close to $\SI{0}{}$ for $\modelInc=\SI{90}{\degree}$.
% 
% 
% 
\paragraph{Effective birefringence thickness \trel{}}
%
\begin{figure}[!p]
    \centering
    \includegraphics[]{gfx/rc1/analysis/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_rtrel_mean.pdf}
    \caption{Mean \trel{} from tilt analysis.}
    \label{fig:sim_ana_trel}
\end{figure}
% 
The results of \trel{} are shown in \cref{fig:sim_ana_trel}.
The first fiber population fraction $\modelPsi=\SI{10}{\percent}$ 
is nearly constant for all fiber configurations.
The exceptions are secondary fiber population inclinations of $\SI{90}{\degree}$ for $\modelInc=\SIlist{60;90}{\degree}$.
\par
% 
Areas of reduced \trel{} become visible for $\modelPsi=\SI{30}{\percent}$.
These are located for $\modelInc=\SIlist{0;30}{\degree}$ at $\SI{90}{\degree}$ and crossings with the first fiber population toward $\SI{180}{\degree}$.
For $\modelInc=\SI{60}{\deg}$, the reduced \trel{} surface remains slightly to the left of the z-axis.
Here, two sampled configurations with $\trel > 1$ are visible in the north and south (colorbar in plot is clipped \todo{indicate in plot}).
The same is visible for a $\modelInc=\SI{90}{\degree}$ for the non-intersecting configuration along the z-axis.
\par
% 
$\modelPsi=\SI{70}{\percent}$ shows only slightly reduced \trel{} values for configurations with high flat crossing angles for the flat configuration $\modelInc=\SI{0}{\degree}$.
This behavior is reduced for $\modelInc=\SI{30}{\degree}$.
For $\modelInc=\SI{60}{\degree}$, a significant reduction of \trel{} values becomes visible for crossing angles in the range of $\modelOmega=\SI{90}{\degree}$ and towards $\SI{180}{\degree}$.
The last case with $\modelInc=\SI{90}{\degree}$ shows significantly reduced \trel{} values in the direction of $\SI{0}{\degree}$ for all configurations with an exception for the very steep configuration where $\trel \geq \SI{1}{}$.
\par
% 
The last line shows the results for the fiber population fraction $\modelPsi=\SI{90}{\percent}$.
All models and configurations remain at a stable \trel{} value.
The exception is the fiber configurations with $\modelInc=\SI{90}{\degree}$, where the \trel{} values along the z-axis are $\geq \SI{1}{}$
%
\paragraph{\rvalue{}}
% 
\begin{figure}[!p]
\centering
\includegraphics[]{gfx/rc1/analysis/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_R_mean.pdf}
\caption{Mean \rvalue{} from tilt analysis.}
\label{fig:sim_ana_rvalue}
\end{figure}
% 
The \rvalue{} of the tilt analysis fitting model is shown in \cref{fig:sim_ana_rvalue}.
It describes the mean absolute difference between the data and the fitted data from the tilt analysis.
\par
%
For a fiber population fraction of $\modelPsi=\SI{10}{\percent}$ and a primary inclination angle $\modelInc\leq\SI{30}{\degree}$ the orientation of the second fiber population does not change the \rvalue{} of the tilt analysis.
For $\modelInc=\SI{60}{\degree}$ the \rvalue{} starts increasing for secondary fiber orientations towards the xy-plane.
The \rvalue{} increases significantly more for $\modelInc=\SI{90}{\degree}$ for flat secondary fiber population orientations.
\par
% 
For fiber population fractions $\modelPsi=\SI{30}{\percent}$ and $\modelInc=\SI{0}{\degree}$, the \rvalue{} remains low for flat crossing fiber configurations.
Along the z-axis in the direction of fiber crossing, the \rvalue{} is slightly increased.
For $\modelInc=\SI{30}{\degree}$, the increase in \rvalue{} along the z-axis is slightly lower.
However, toward steeper crossing angles up to about $\SIlist{125;235}{\degree}$, the \rvalue{} is still increased.
The fiber configurations of $\modelInc=\SIlist{60;90}{\degree}$ are similar to the previous fiber population fraction, but the \rvalue{} are not as high.
\par
%
Fiber population fractions $\modelPsi=\SI{50}{\percent}$ and inclinations of $\modelInc=\SI{0}{\degree}$, have an increased \rvalue{} for inclined secondary fiber configurations along the y-axis.
For $\modelInc=\SI{0}{\degree}$, the increased area along the y-axis is curved in the direction of $\SI{180}{\degree}$.
$\modelInc=\SI{60}{\degree}$ leaves a low \rvalue{} along the x-axis and an area around the first fiber population orientation.
The other secondary orientations are slightly increased.
The steep first fiber population inclinations of $\modelInc=\SI{90}{\degree}$ again has an increased \rvalue{} to the flat secondary orientations.
The \rvalue{} relative to the lower first fiber population fractions is further reduced.
\par
%
$\modelPsi=\SI{70}{\percent}$ and $\modelInc=\SI{0}{\degree}$ have only an increased \rvalue{} for the secondary fiber configuration along the z-axis.
The points along the x-axis are slightly more increased than along the y-axis.
For $\modelInc=\SI{30}{\degree}$, the curved shape from the previous result almost disappears.
Only the secondary fiber configurations along the z-axis remain increased.
$\modelInc=\SI{60}{\degree}$ remains a low \rvalue{} along the x-axis.
Only the crossings for flat directions of $\SIlist{110;250}{\degree}$ are increased.
The final inclination angle of $\modelInc=\SI{90}{\degree}$ is again similar to the previous fiber population fraction, but the \rvalue{} is again lower for the increased areas.
\par
% 
The final fiber population fraction $\modelPsi=\SI{90}{\percent}$ has an increased \rvalue{} on the z-axis for inclination angles of $\modelInc=\SIlist{0;30}{\degree}$.
$\modelInc=\SIlist{60;90}{\degree}$ remains a low \rvalue{} for all configurations.
% 
% 
% 
\paragraph{\accvalue}
%
\begin{figure}[!p]
\centering
\includegraphics[]{gfx/rc1/analysis/simulation_analysis_hist_0.5_setup_PM_s_Vervet_m_r_acc.pdf}
\caption{Mean \accvalue{} between model and tilt analysis orientations.}
\label{fig:sim_ana_acc}
\end{figure}
% 
\Cref{fig:sim_ana_acc} shows the \acreset{ACC} \ac{ACC} value, \ie{} how well the coefficients of the \ac{ODF} basis function are matched \cite{Schilling2018}.
\todo{acc of psi = 1 as ref}.
\par
% 
The fiber population fraction $\modelPsi=\SI{10}{\percent}$ shows no significant decrease in the \accvalue{} for the first fiber model inclination $\modelInc$.
For $\modelPsi=\SI{30}{\percent}$, a reduction of the \accvalue{} for the lower inclined models of the first fiber population is visible.
The reduction is found in the region of the steep secondary fiber populations.
For $\modelInc = \SIlist{30;60}{\degree}$, the reduction shifts in a direction along $\SI{180}{\degree}$.
The effective area of the reduction decreases with increasing \modelInc{} until no area effect is visible for an inclination of $\modelInc=\SI{90}{\degree}$.
However, the \accvalue{} for this last plot is still reduced compared to $\modelPsi=\SI{10}{\percent}$.
For $\modelInc < \SI{90}{\degree}$, a slight increase in the \accvalue{} is visible for flat fiber crossings with a crossing angle of $\modelOmega=\SI{90}{\degree}$.
\par
%
For the equally proportional fiber population $\modelPsi = \SI{50}{\degree}$, the \accvalue{} reaches values close to $\SI{0}{}$ for $\modelInc = \SIlist{0;30}{\degree}$ and a crossing angle of $\modelOmega=\SI{90}{\degree}$.
Inclined secondary fiber populations achieve a higher \accvalue{}.
The $\modelInc = \SI{90}{\degree}$ configuration reaches its maximum \accvalue{} at a crossing angle of $\modelOmega=\SI{0}{\degree}$ and lower stable values for all other configurations.
\par
%
The first to fiber inclinations $\modelInc = \SIlist{0;30}{\degree}$ for $\modelPsi=\SI{70}{\percent}$ show a similar distribution of the \accvalue{}. 
Small reductions are visible.
For $\modelInc=\SI{60}{\degree}$, the \accvalue{} is highest at low crossing angles $\modelOmega$, \ie{} near the first fiber population.
The \accvalue{} decreases significantly at higher crossing angles.
In the case of $\modelInc=\SI{90}{\degree}$ this is also visible, but the minimum for the \accvalue{} is higher than in the previous case $\modelInc=\SI{60}{\degree}$.
\par
%
The last case $\modelPsi=\SI{90}{\percent}$ shows high values for the \accvalue{} parameter for the first three inclinations $\modelInc=\SIlist{0;30;60}{\percent}$.
The last inclination $\modelInc=\SI{90}{\degree}$ shows a slight decrease of \accvalue{} for higher crossing angles $\modelOmega$.
\par
%
In summary, crossing angles cause a significant reduction in \accvalue{}s.
This effect is clearly visible as a \say{band} of reduced \accvalue{}s, from a low inclination angle and low fiber proportion fraction to a high inclination angle and high fiber proportion fraction.
Fiber population fractions of $\modelPsi \geq \SI{90}{\percent}$ or $\modelPsi \leq \SI{10}{\percent}$ have almost no effect on the \accvalue{}.
%
%
% 
\section{Discussion}
%
\paragraph{Single inclined fiber population}
\Cref{sec:resSingleIncl} shows the results for the case of a single fiber population with inclined configurations.
The transmittance values show an increase for the last free inclination values.
This is to be expected since the 3D model configurations are aligned in parallel along an axis with some randomness.
When this axis is aligned along the z-axis, \ie{} $\modelInc=\SI{90}{\degree}$, the light rays, which also travel along the z-axis, statistically strike less tissue, so the transmittance must increase.
Since the density of the tissue is quite high, the effect is only a few percent.
In reality, however, one must take into account that additional effects such as light scattering also have a significant effect on the transmittance \cite{Menzel2021}.
The variance of the transmittance corresponds to the variance of the noise model.
\par
%
The retardation behaves similarly to the theoretical curve for a single retardation signal (see \cref{eq:pli_signal}).
However, the analyzed retardation is slightly higher.
The theoretical signal is calculated by normalizing $\cos(\modelInc)^2$ with the analyzed retardation for the flat case, \ie{} $\modelInc = \SI{0}{\degree}$.
This may have an effect on the theoretical curve for the inclined values, but it is expected to be minimal.
\par
%
The direction values have a very small variance, which increases strongly for high inclination values.
Since the direction value is coupled to the inclination angle, this is to be expected: for an $\SI{90}{\degree}$ inclined orientation, there is no direction.
The noise mainly affects the signal, and therefore the phase of the \say{sinus} is random.
\par
%
The same behavior can be observed for the inclination curve.
However, here the variance for the last angle is lower.
It may be that this is an effect that for exactly $\modelInc=\SI{90}{\degree}$ the change of the tilted light beam statistically ends in 4 opposite phases in the sinusoidal signal.
This might be more detectable for tilt analysis than a slightly less inclined fiber configuration where only the amplitude changes.
It is interesting to note that the variance is quite small and constant up to a range of about $\SIrange{70}{75}{\degree}$.
This means that, in view of the fact that the simulation uses a linear model, the tilt analysis is relatively accurate for a single straight fiber population in the voxel used with the microscopic setup.
\par
%
The relative thickness \trel{} should theoretically be constant, since the volume fraction remains the same for different inclination angles.
Due to the reduction in retardation, a higher variance is expected with increasing inclination angle.
However, at an inclination angle of about $\modelInc=\SI{65}{\degree}$, the mean value begins to decrease.
For $\modelInc=\SIlist{85;90}{\degree}$, the variance then increases significantly and for $\modelInc=\SI{90}{\degree}$, the mean is $>\SI{1}{}$.
This indicates that the tilt analysis is unable to find a local minimum for \trel{} values $<1$.
This may be due to several reasons.
First, there is no local minimum with $\trel<1$.
Second, there is a local minimum, but the optimizer is not able to find it with the initial values.
Finally, there is a local minimum, but the solution found with a \trel{} value $>1$ is a better choice, \ie{} has a lower $R^2$ value.
Which of these is true cannot be said from this data and remains an interesting investigation for the future.
However, up to this point, the \trel{} value can be used to indicate that these values cannot be trusted, \ie{} the resulting orientation is not trustworthy.
\par
%
The opening angle shows the combined information from the direction results and the inclination results.
This value can possibly serve as additional uncertainty for further calculations like in a tractography.
\par
%
In summary, for the case of a single fiber population, the resulting tilt analysis shows good agreement with the individual orientations of the model, except for very steeply inclined configurations.
%
% 
% 
\paragraph{Crossing flat fiber population}
\Cref{sec:resCrossFlat} describes the results of the flat crossing configurations.
The transmittance value changes significantly with increasing \modelOmega{}, which is to be expected since crossing models require more space.
Therefore, fewer fibers can absorb light and the transmittance value must increase.
This effect is also responsible for the transmittance increasing at a fiber population fraction of $\modelPsi=\SI{50}{\percent}$, since it is more complicated to find a collision-free state.
\par
%
The retardation decreases almost linearly with increasing crossing angle.
Theoretically, with a crossing angle of $\modelOmega=\SI{90}{\degree}$ and a fiber population fraction of $\modelPsi=\SI{30}{\percent}$, only the remaining $\SI{40}{\percent}$ fibers affect retardation.
However, the measured retardation of about $\SI{36}{}$ is larger than the expected $0.8\cdot 0.4 = 0.32$.
Why this is so cannot be said at this point.
A clue is given by the retardation value for a fiber population fraction of $\modelPsi=\SI{50}{\percent}$, where the retardation does not fall exactly on $\SI{0}{}$.
This is understandable since the noise of the signal contributes to a measured retardation.
However, this is only true for an expected retardation of $\SI{0}{}$.
Sinusoidal signals with an amplitude $>0$ have a more Gaussian randomness in amplitude.
\TODO{discuss with others}
\par
%
The direction for the flat fiber crossings follows the expected theoretical curve of the circular mean.
For the case $\modelPsi=\SI{50}{\percent}$ and $\modelOmega=\SI{90}{\degree}$, the direction values are uniformly distributed since there is no unique direction in the sinosoidal.
This is the effect of retardation cancelation and signal noise.
\par
%
The variance of the inclination angle increases with increasing \modelOmega{}, which is to be expected as the amplitude, \ie{} the retardation decreases, making the model more uncertain.
In the case of a uniformly distributed fiber crossing, the inclination can reach any value as in the case of direction.
\par
%
The same effect as for retardation and inclination is also observed for the decreasing value of \trel{}.
Since there is only one optical axis in the tilt analysis model, the \trel{} value must follow the retardation for flat crossing fiber models.
In the case of $\modelPsi=\SI{90}{\degree}$, the tilt analysis also reaches values of $\trel>1$.
As mentioned for the single fiber population, this is an effect of the solution algorithm of the tilt analysis.
It can be used as an indication that the resulting values are not to be trusted and the current model does not fit the data.
\par
%
All effects described above are reflected in the opening angle \openingAngle{}, which must increase with increasing \modelOmega{} \todo{domega of the model ...}.
%
%
%
\paragraph{Inclined crossing fiber population}
\Cref{sec:resInclCross} shows the results for the inclined crossing fiber population.
The results for transmittance and retardation are similar to the previous flat fiber crossing.
The main difference is that the retardation does not decrease to $\SI{0}{}$, which is expected since only the retardation of the inclined fiber population due to the radial optical axis is cancelled.
This is also evident in the behavior of the inclination, which does not follow the theoretical circular mean of the two fiber populations.
\todo{try effective circ mean}
\par
% 
The relative thickness \trel{} behaves as expected to neglect the effects of the inclined fiber populations.
However, especially in the case of $\modelPsi=\SI{50}{\percent}$, the \trel{} value for $\modelOmega=\SI{90}{\degree}$ is lower than half of $\modelOmega=\SI{0}{\degree}$, which is what one would initially expect.
Because of the lower volume fraction, the \trel{} value must decrease.
\par
%
The opening angle \openingAngle{} combines the results of the direction and inclination values as expected for an inclined crossing fiber model.
% 
%
%
\paragraph{Free crossing fiber population}
\TODO{This takes a little bit more work ...}
\Cref{sec:resFreeCross} shows the results of the free crossing fiber population.
The transmittance results show the same behavior as expected looking at the previous results of the single, crossing and inclined configurations.
The transmittance rises for models with higher crossing angles and for models with higher fractions of inclined fiber populations.
\par
%
From \ref{fig:sim_ana_acc}, a range of low \modelPsi{} and low \modelInc{} to higher low \modelPsi{} and higher \modelInc{} is evident where the \accvalue{} is significantly low, with larger areas near $\SI{0}{}$.
These areas correspond to the known problematic areas in intersections and inclined regions.
However, these results give a better idea of how strong the indication is with respect to the \accvalue{}.
The \accvalue{} can potentially be used as a weight for \todo{not ...}.
An important result is the correlation between the \accvalue{} and the \trel{} value.
As the \trel{} value is analyzed, it can be used as an indicator of an underlying intersection or oblique region.
This would then also be an indicator for further data processing \eg{} a tractography.
Note that these results are only valid for dense fiber populations, \ie{} dense white matter.
\todo{acc for crossing models compared to not crossing models; uniform dist models and singe orientation models}
\par
%
Retardation is also an indicator, but not as reliable, since its value is very low even for a single inclined fiber population, which can still be correctly determined with a high variance using tilt analysis (see \cref{fig:single_fiber_pop_rofl}).
There, too, the \trel{} value is reduced, but not as much as in the crossing fiber populations.
This effect results from the simple fact that an inclined single fiber population increases its retardation value when tilted, while a flat crossing population does not due to signal cancellation.
\par
%
The relatively low \rvalue{} is consistent with the noise of $\SI{14.3}{\percent}$ (see \cref{fig:noiseplot}).
The elevated patterns of \rvalue{} represent the range of a $\modelOmega \approx \SI{90}{\degree}$, where lower retardation is thus expected.
The most interesting pattern is for the case $\modelPsi = \SI{90}{\percent}$, where the \rvalue{} for the $\modelInc = \SI{0}{\degree}$ is maximum at a $\alpha_1$ \todo{check variable name} angle of $\SI{80}{\degree}$.
This is quite unexpected, since here the dominant nerve fiber population is the first one, \ie{} $\SI{90}{\percent}$.
Nevertheless, the small fraction of $\SI{10}{\percent}$ for a high inclination case seems to be sufficient to perturb the fitting algorithm based only on a single fiber population.
However, compared to the other results at this orientation, the other parameters do not appear to be perturbed in their mean values.
% 
%
%
\section{Speedup}
\label{sec:simSpeedup}
%
This section shows the results of speedup measurements for discretized tissue volume generation (see \cref{sec:dv_generator}) and light matter interaction simulation (see \cref{sec:simulation}) for the implemented parallelization with \ac{OpenMP} and \ac{MPI}.
Simulations were performed using a single compute node with \ac{CPU} architecture \texttt{2x Intel(R) Xeon(R) CPU E5-4657L v2}.
To measure the speedup, each algorithm is executed $N=10$ times.
To calculate the speedup value, the average measured time for $n_\mathit{cpu}=1$ was then divided by the measured time for each value $n_\mathit{cpu}$.
The volume used is the $\modelPsi=\SI{0}{\percent} / \modelInc=\SI{0}{\degree}$ from the \cref{sec:simParameterEnv} parameterization.
% 
% 
% 
\subsection{Results}
% 
\begin{figure}[!t]
\centering
\subcaptionbox{\label{fig:speedTissueMP}
\ac{OpenMP} speedup discrete tissue generation.
}[.475\textwidth]{\includegraphics{gfx/rc1/speed/boxplot_generation_output_generation_mp_v_0.1.csv.pdf}}
\hfill
\subcaptionbox{\label{fig:speedTissueMPI}
\ac{MPI} speedup discrete tissue generation.
}[.475\textwidth]{\includegraphics{gfx/rc1/speed/boxplot_generation_output_generation_mpi_v_0.1.csv.pdf}}
\caption{Discrete tissue generation speedup.}
\end{figure}
%
\Cref{fig:speedTissueMP} shows the speedup results for the parallelization of \ac{OpenMP} of the discrete tissue generation algorithm.
The speedup increases linearly from $\SI{1}{\core}$ to $\SI{8}{\cores}$ up to a speedup of about $\SI{3}{}$.
For $\SIlist{16;24;32;40;48}{\cores}$ the speedup is increased further, but is still in the range of $\SIrange{4}{5}{}$.
\par
% 
\Cref{fig:speedTissueMPI} shows the speedup for the \ac{MPI} implementation.
Here, the speedup up to $\SI{8}{\cores}$ is again linear and gets about $\SI{6.8}{}$.
The speedup from $\SI{16}{\cores}$ to $\SI{48}{\cores}$ is also linear, but the inclination decreases.
For $\SI{48}{\cores}$, a speedup of about $\SI{28}{}$ is obtained.
The variance is significantly lower compared to the \ac{OpenMP} implementation.
\par
% 
\begin{figure}[!t]
\centering
\subcaptionbox{\label{fig:speedSimMP}
\ac{OpenMP} speedup simulation for 5 tilt direction.
}[\textwidth]{\includegraphics{gfx/rc1/speed/boxplot_simulation_output_simulation_mp_v_0.1.csv.pdf}}
\\
\subcaptionbox{\label{fig:speedSimMPI}
\ac{MPI} speedup simulation including all five tilt direction.
}[\textwidth]{\includegraphics{gfx/rc1/speed/boxplot_simulation_output_simulation_mpi_v_0.1.csv.pdf}}
\caption{\ac{3D-PLI}}
\end{figure}
%
The results of the speedup measurements for the light matter interaction are then presented.
All tilt directions (flat, east, north, west, and south) are simulated.
\Cref{fig:speedSimMP} shows the speedup for the \ac{OpenMP} implementation.
The results show ideal speedup up to $\SI{8}{\cores}$.
As the \ac{CPU} count is further increased up to $\SI{48}{\cores}$, the speedup is slightly lower than the ideal line with a speedup of $\SI{42}{}$ for $\SI{48}{\cores}$.
No significant difference in acceleration for different tilt directions is apparent.
\par
% 
\Cref{fig:speedSimMPI} shows the speedup for the \ac{MPI} implementation.
Again, the speedup is ideal up to $\SI{8}{\cores}$.
For \ac{CPU} numbers in the range of $\SIrange{16}{48}{\cores}$, the speedup is again lower than the ideal line with a speedup of about $\SI{35}{}$ for $\SI{48}{\cores}$.
Compared to the previous \ac{OpenMP} implementation, the speedup is further reduced.
A significant difference in the measurement is visible for different tilt directions.
The flat measurement has the highest speedup.
%
%
%
\subsection{Discussion}
%
The speedup for the discrete tissue generator in the case of \ac{OpenMP} is appropriate up to $\SI{4}{\cores}$ with a speedup of slightly above $\num{2}$.
Above $\SI{4}{\cores}$, especially $\geq \SI{16}{\cores}$ is not recommended to use.
This behavior is most likely due to the fact that the cpus read from the same memory address.
However, since the different writing instructions do not use the same memory address and there are no race conditions, a higher speedup was expected.
\par
% 
The speedup for the \ac{MPI} implementation, on the other hand, is almost optimal up to $\SI{8}{\cores}$.
Above that, the speedup is reduced compared to the ideal case, but still quite good.
Since here the \acp{CPU} (cores) run independently, no communication is required.
However, on a single-node system, as in this case, the allocation of memory is a race condition and slows down the algorithm.
This is not expected on a multi-node system.
An additional reduction in computation time results from the fact that all cores must traverse all fiber coordinates.
Pre-filtering could shorten this process.
For example, a global \ac{AABB} can be computed for each fiber.
\par
% 
The speedups for the \ac{3D-PLI} simulation are quite similar and very high for both implementations.
The \ac{OpenMP} implementation is slightly better, which is to be expected since the parallelization is done along a \code{std::vector} of Stokes vectors.
The \ac{MPI} implementation on the other hand still needs to communicate with each other in case of transferring the Stokes vectors.
Also, the discretized volumes are already present in memory, so memory allocation does not slow down the runtime compared to the volume discretizer.
For the \ac{MPI} implementation, the communication effect is also visible for flat and tilted simulations.
In the case of a flat simulation, no communication and thus no barriers are required, so the speedup is higher.
A difference in north-south and east-west tilt could be explained for different number of cores by the fact that the volume has to be divided into sub-volumes.
This is done within the algorithm so that the surface area is minimized.
The splitting process produces sub-volumes with a tendency to have longitudinal quartiles along the x-axis.
This may explain why the north-south tilt has a slightly higher speedup.
\par
%
In summary, the speedup for the implementation of \ac{MPI} is very good.
The user should prefer this implementation over the \ac{OpenMP} library.