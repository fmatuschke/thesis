\setcounter{chapter}{6}
\chapter{Dense \acs{WM} modelling}
\label{cha:model_analysis}
% 
\section{Introduction}
% 
In the previous chapter \cref{chap:sof:modeling} the module \pymodule{fastpli.model} was described to build non-colliding nerve fiber models \cite{Matuschke2019, Matuschke2021}.
An open question, however, is how the parameters affect the resulting models.
Since the collision resolution algorithm divides the nerve fibers into fiber segments and also controls their motion and bending when the colliding parts are resolved, its parameters have an influence on the resulting nerve fiber configuration.
How big this influence is is the first investigation of this chapter.
\par
% 
Three characteristics are crucial here.
The first is to be able to produce a dense volume.
This of course depends on the initial fiber configuration.
In configurations such as crossings, the density is reduced.
The second is the runtime.
The lower this is, the more models the user can build in the same time, or a larger one. 
The last condition is that the initial fiber orientations remain intact.
Because of the motion phase in the collision solver algorithm, these will have to change.
The question is how much they change and whether the results match the user's expectations and anatomical reality.
\par
% 
The characterization process should be done on a statistically describable model in order to generalize the evaluation. The question, then, is what type of parameterization can be used to define a fiber configuration in a volume without having to describe each individual fiber.
This statistical system must also be able to reproduce random volumes with the same fiber orientation statistics as another built with the same parameters.
This description could then be used both for the study of the solver parameters and for the subsequent study of the \ac{3D-PLI} simulation.
\par
% 
This chapter is structured in three consecutive parts.
First, the design of statistical volumes containing fiber populations is described.
This is followed by the study of the solver parameters and their behavior on the resulting collision-free nerve fiber models.
Finally, a set of models is created as a library for \ac{3D-PLI} simulations and their characterization.
% 
% 
% 
\section{Designing fiber populations}
% 
For the \ac{3D-PLI} simulation, a volume of size $\SI{65}{\micro\meter} \times \SI{65}{\micro\meter} \times \SI{60}{\micro\meter}$ is required (see \cref{cha:simulation_analysis}. \footnote{\SI{65}{\micro\meter} is divisible by \SI{1.3}{\micro\meter}, the pixel size of the microscope}.
This volume will be filled with \say{fiber population}, which is a fiber bundle with a particular orientation, fiber density, and radius distribution.
The strategy of statistically grouping fiber bundle into fiber populations is analogous to the work \cite{Ginsburger2018, Ginsburger2019,ginsburgerDis2019}. 
K{\'{e}}vin Ginsburger was able to show that one can build a library of models of specific parameters to use as training models in machine learning to predict these learned parameters in experimental measurements.
These parameters of a fiber population have the advantage of being anatomically motivated and describing a nerve fiber volume based on statistical properties, which are also commonly used in \ac{dMRI}.
Here, the idea needs some adaptation to fit the research questions given here.
% 
\subsection{Orientation and proportion}
% 
\begin{figure}[t]
\centering
\def\tikzwidth{0.42*\textwidth}
\subcaptionbox{\label{fig:rotcube}A orientation in 3d can be rotated in any new orientation by applying 3d rotation matrices to the fibers.}
[.49\textwidth]{\hfill\inputtikz[true]{gfx/model/sphere_cube}\hfill}\hfill
\subcaptionbox{\label{fig:2pop}Initial orientation for two fiber populations $F_0$ and $F_1$. The angle between both populations is $\Omega$.}
[.49\textwidth]{\hfill\inputtikz[true]{gfx/model/sphere_models}\hfill}
\\
\caption{model designing.}
\label{fig:twomodelpopdesign}
\end{figure}
% 
In these theses, up to two fiber populations are investigated.
The number of fiber populations is limited to two to reduce the degrees of freedom within the models and to be able to study the main effect on the models.
\\
% 
Only one model is needed to study a single fiber population, since the model can then be rotated to any 3d orientation.
Of course, one needs to check if a second random model with the same configurations leads to a significantly different model and simulation signal, which will be investigated later.
For two fiber populations, only the crossing angle $\Omega$ between the two fiber population orientations is relevant (see \cref{fig:modelinit}).
Since only the orientation and not the vector is relevant, the crossing angle only needs to be between $\SI{0}{\degree}$ and $\SI{90}{\degree}$.
Again, with rotations, one can rotate both fiber populations to an arbitrary orientation while preserving the crossing angle.
Therefore, only models for one set of crossing angles $\Omega$ need to be generated.
Another parameter is the ratio between both populations $\Psi=N_0/N_G$.
This can run between $0$ and $1$.
Since only dense \ac{WM} phantoms are generated in this study, a lower density of only one fiber population is not investigated.
\par
% 
The following sets of parameters were chosen which allows to investigate up to two fiber populations:
\begin{align}
    \begin{split}
        \Omega &= \{\SI{0}{\degree}, \SI{10}{\degree}, ..., \SI{90}{\degree}\}\\
        \Psi &= \{\SI{0.1}{}, \SI{0.2}{}, ..., \SI{0.9}{}\}
    \end{split}
\end{align}
In the case of $\Psi = 0$ or $\Psi = 1$ no second fiber population exists, therefore the single fiber population model can be applied.
This leads to 91 needed models for the chosen orientations.
% 
\subsection{fiber placing and randomization}
% 
To design the individual fiber configurations for each fiber population, the methods described in \cref{sec:sandbox} are used.
Seedpoints on a 2d plane are generated with a uniform distribution:
\begin{align}
p = \mathrm{Uniform}(-\frac{1}{2}\mathit{L}, \, \frac{1}{2}\mathit{L})
\end{align}
The $\mathit{size}$ is chosen to completely fill the model.
Since the simulation model will be cubic and the model will be rotated, a spherical boundary with diameter $d_{\mathit{sphere}}=\sqrt{3} \cdot L$ is chosen, where $L$ is the length of the larges edge length of the cube.
The number of seed points is set to a value of. 
\begin{align}
N_{0,\mathit{seeds}} &= \Psi \frac{A}{\pi \cdot \fiberRadiusMean}\\
N_{1,\mathit{seeds}} &= (1-\Psi) \frac{A}{\pi \cdot \fiberRadiusMean}
\end{align}
which corresponds to filling the entire cross-sectional area with the sum of all cross-sections of fibers, taking into account the proportion of fiber populations.
In this way, more fibers are placed in the volume than they have space for, since the stacking of circles is mathematically reduced to a volume fraction of $\frac{\pi \sqrt{3}}{6} \approx 0.9$.
This statistically results in overlapping regions and pushing the fibers out of the \ac{VOI}.
The size of the volume created increased by 2 fiber diameter.
This ensures that objects exist outside the volume that can build up pressure on the interior.
In this way, edge effects should be prevented.
\par
% 
\begin{figure}[!t]
\centering
\tikzset{external/export=false}
\begin{tikzpicture}[scale=1, trim axis left, trim axis right]
\begin{axis}[height=0.46\textwidth, width=0.75\textwidth,enlargelimits=false, xlabel={$x$}, ylabel={$f(x,\mu,\sigma)$}, title=${f(x,\mu,\sigma)=\frac{1}{\sigma x \sqrt{2\pi}}\exp\left(-\frac{(\ln(x)-\mu)^2}{2 \sigma^2}\right)}$,
legend style={at={(1,1)},anchor=north east},
legend cell align={left},
]
\pgfmathsetmacro{\muValue}{0}
\pgfmathsetmacro{\sigmaValue}{0.05}
\addplot[BLUE,thick,domain=0.6:1.4, samples=2*42, smooth]{1/(\sigmaValue*x*sqrt(2*pi))*exp(-(ln(x)-\muValue)^2/(2*\sigmaValue^2))}; \addlegendentry{$\mu=0.0,\sigma=0.05$}
\pgfmathsetmacro{\muValue}{0}
\pgfmathsetmacro{\sigmaValue}{0.1}
\addplot[GREEN,thick,domain=0.6:1.4, samples=2*42, smooth]{1/(\sigmaValue*x*sqrt(2*pi))*exp(-(ln(x)-\muValue)^2/(2*\sigmaValue^2))}; \addlegendentry{$\mu=0.0,\sigma=0.1$}
\end{axis}
\end{tikzpicture}
\caption[]{\itodo{check values in literatur} Probability density function of a multiplicative \name{log normal} distribution.}
\label{fig:logNormal}
\end{figure}
% 
These seed points are used to place straight parallel fibers within a cubic volume.
To add a random distribution of fiber radii, the targeted mean fiber radius $\fiberRadiusMean$ is multiplied by a random value of the LogNormal distribution (see \cref{fig:logNormal}) to ensure that the mean value is preserved:
\begin{align}
\fiberRadius = \fiberRadiusMean \cdot \mathrm{sample}\left(\mathrm{LogNormal}(\mu=0, \, \sigma=0.1)\right)
\end{align}
% 
To create a more random distribution along the fibers, the fibers must first be divided into fiber segments.
This is where the \code{Solver} class helps with its \code{Solver.apply\_boundaries()} method.
It applies the set fiber segment length to the fiber configuration, which in this case splits the fiber along its trajectory into fiber segments of equal length (except the last one).
The fiber points created in this way are then randomly shifted in all three dimensions with a normal distribution and a value depending on the mean fiber radii \fiberRadiusMean{}.
In addition, the radius of the point is also changed with a random multiplicative factor from a LogNormal distribution:
% 
\begin{align}
\begin{split}
p_i &= p_i + \mathrm{Normal}(\mu=0,\sigma=0.05 \cdot \fiberRadiusMean)\\
r_i &= r_i \cdot \mathrm{LogNormal}(\mu=0,\sigma=0.05)
\end{split}
\end{align}
% 
% 
% 
\subsection{Parameter characterization}\label{sec:modelSetup}
% 
The described control mechanisms in the collision solver algorithm \code{fastpli.model.solver} (see \cref{chap:sof:modeling}) have to be characterized.
These are the mean segment length \segLength{} and the minimum allowed radius of curvature \segRadius{}.
It must be ensured that a parameter set is identified that ensures that the configurations entered by the user remain the same, i.e., the orientation distributions remain intact with respect to the fact that the fiber segments must move.
Furthermore, the achievable fiber density should remain high for this set of parameters.
Finally, it must also be ensured that a parameter set can be chosen that has an acceptable runtime.
If possible, the computing time should be minimized, since this is a limited resource.
\par
% 
To investigate the behavior of the \segLength{} and \segRadius{} the two factor variable \segLengthFactor{} and \segRadiusFactor{} are defined:
\begin{align}
    \begin{split}
        \segLength &= \segLengthFactor \cdot \fiberRadiusMean\\
        \segRadius &= \segRadiusFactor \cdot \fiberRadiusMean
    \end{split}
\end{align}
This allows a fiber radius independent investigation on the model characterization.
The parameter ranges chosen to investigate the impact are listed in \cref{tab:cube2pop}.
% 
\begin{table}[!b]
\sisetup{parse-numbers=false,open-bracket={\{}, close-bracket={\}}, list-final-separator={,},list-pair-separator={,}}%
\centering
\pgfplotstabletypeset[%
    thesisTableStyle,
    column type=lcl,
    columns/name/.style={string type},
    columns/variable/.style={string type},
    columns/values/.style={string type},
    every head row/.style={before row=\toprule,after row=\midrule},
    every last row/.style={after row=\bottomrule},
    col sep=&,
    row sep=\\,
    % string type,
]
{name & variable & values\\
mean fiber radius & $\fiberRadiusMean$ & $\SIlist{0.5;1;2;5;10}{\micro\meter}$\\
mean segment length factor & $\segLengthFactor$ & $\numlist{1;2;4;8}$\\
min segment bending radius factor & $\segRadiusFactor$ & $\numlist{1;2;4;8}$\\
% fiber bundle distribution value & $\textcolor{violet}{\modelPsi}$ & $\numlist{0.1;0.2;...;1.0}$ \\
% fiber bundle crossing angle & $\textcolor{violet}{\modelOmega}$ & $\SIlist{0;10;...;90}{\degree}$\\
fiber bundle crossing/proportion & $\modelPsi$/$\modelOmega$ & $\SI{1.0}{}/\SI{0}{\degree}$, $\SI{0.5}{}/\SI{90}{\degree}$\\
}
\caption{parameter characterization setup and variables.}
\label{tab:parameterSeries}
\end{table}
% 
To be able to examine the results statistically, the generation of the models $n_{\mathit{repeat}} = \SI{24}{}$ was repeated.
For characterization, only the $\modelPsi/\modelOmega$ pair of $\SI{1.0}{}/\SI{0}{\degree}(||)$ and $\SI{0.5}{}/\SI{90}{\degree}(\times)$ is considered as an extreme case.
The number of steps is limited to $\SI{100000}{}$ to limit the calculation.\footnote{In retrospect, this should have been limited by the runtime.}
A cubic volume of $\SI{60}{\micro\meter} \times \SI{60}{\micro\meter} \times \SI{60}{\micro\meter}$ is chosen for this characterization.
Every 50 steps, the fiber model is cut into a $\SI{60}{\micro\meter}+4 \cdot \fiberRadiusMean$ cube to delete unnecessary fibers and reduce the number of objects. After this process, the meta information is stored for time evaluation as well.
When the orientation is analyzed, the volume is cut to $\SI{60}{\micro\meter}$ to neglect the outlying fiber segments.
To measure the volume fraction, the discretized volume is generated from the simulation module.
There, the individual label IDs are counted to calculate the volume fraction.
% 
The Machine used to compute all the models is a 
Intel(R) Xeon(R) CPU E5-4657L v2 @ \SI{2.4}{\giga\hertz}, L1d cache: \SI{1.5}{\mega\byte}, L1i cache: \SI{1.5}{\mega\byte}, L2 cache: \SI{12}{\mega\byte}, L3 cache: \SI{120}{\mega\byte}.
% 
% 
% 
\subsection{Results}
% 
\begin{figure}[t]
\centering
\includegraphics{dev/rc1/mpara/pre_stats_box_plot_volume_05_output_parameter_statistic_rc1.pdf}
\caption[Volume fraction]{Volume fractions for parameter set.}
\label{fig:psbp1}
\end{figure}
% 
\paragraph{Volume fraction}
% 
\Cref{fig:psbp1} show the resulting volume fraction $V_f/V_0$ for the parameter series.
% The additional fiber radii results are available in \cref{fig:appModelVolumeBoxPlot}.
\par
% 
% single fiber
The single fiber populations $(||)$ have volume fractions greater than $\SI{0.74}{}$.
For const values of the fiber segment length factor, except for the case of $\segLengthFactor = \SI{1}{}$, there is no significant change over the fiber bending radius factor.
In the case of $\segLengthFactor = \SI{1}{}$, there is a small decrease in volume fraction with increasing bending radius.
A decrease with increasing fiber segment length factor \segLengthFactor{} is more significant, but still small.
\par
% 
% crossing fiber
This behavior changes significantly for the crossing fiber population $(\times)$.
There the values are always smaller than for the single fiber population case.
For $\segLengthFactor{}=\SI{1}{}$, the volume fraction decreases abruptly between $\segRadiusFactor{} = \SI{2}{}$ and $\segRadiusFactor{} = \SI{4}{}$. 
The change becomes smoother for $\segLengthFactor{}=\SI{2}{}$.
The total volume fraction decreases for values $\segLengthFactor{} \geq \SI{4}{}$ compared to the previous values.
For $\segLengthFactor{}=\SI{8}{}$ the change with \segRadiusFactor{} disappears and the volume fraction reaches only a value around $\SI{0.57}{}$.
\par
% 
% radius
The behavier is the same for higher mean fiber radii (see \cref{fig:appModelVolumeBoxPlot}). For values $\geq \SI{5}{\micro\meter}$, the variance increases and the median decreases significantly.
Nevertheless, even if the median becomes smaller, it follows the same behavior across all parameters as for the smaller fiber radii.
The results show that, except for mean fiber radii $\geq \SI{5}{\micro\meter}$, the volume fraction does not change its behavior when the mean fiber radii are changed.
\par
% 
% 
% 
\paragraph{Runtime}
% 
\begin{figure}[p]
\centering
Single fiber population \vspace{1em}
\includegraphics[page=2]{dev/rc1/mpara/pre_stats_time_evolve_r05_output_parameter_statistic_rc1.pdf}
\caption[Time development parallel]{Time development of the model generation process of parallel fiber populations.}
\label{fig:timeDevelopmentNone}
\end{figure}
% 
\begin{figure}[p]
\centering
Crossing fiber population \vspace{1em}
\includegraphics[page=1]{dev/rc1/mpara/pre_stats_time_evolve_r05_output_parameter_statistic_rc1.pdf}
\caption[Time development parallel]{Time development of the model generation process of crossing fiber populations.}
\label{fig:timeDevelopmentCross}
\end{figure}
% 
The change in runtime $t$ of a subset of the parameter series \cref{tab:parameterSeries} are shown in \cref{fig:timeDevelopmentNone} for the single fiber population and in \cref{fig:timeDevelopmentCross} for the crossing fiber population for number of steps, number of colliding fiber segments, and the overlap fraction of colliding fiber segments.
The colliding fiber segments are defined as the average of the minimum distance between two colliding fiber segments divided by their combined radii.
The additional fiber radii are results available in \cref{app:pste1,app:pste2,app:pste3,app:pste4,app:pste5}.
\\
% 
% SINGLE
The single fiber populations show a strong linear correlation between the runtime and the number of steps for all parameters.
The number of steps increase significantly with decreasing \segLengthFactor{}.
A change of the runtime with changing the fiber bending radius \segRadiusFactor{} is in the logarithmic plot not visible.
The total number of steps slightly  increases with an increase of the fiber segment length factor \segLengthFactor{}.
However the total amount of runtime increases significantly with a decrease in \segLengthFactor{}.
All models of all parameter sets were able to solve the collisions in the maximum number of steps.
\\
% 
The number of colliding fiber segments in the second plot show a strongly increasing decrease for all parameters with increasing runtime.
The total number increases with decreasing \segLengthFactor{}.
The \segRadiusFactor{} has here no significant effect as well.
\\
% 
The overlap fraction for all parameters in the beginning is about $\SI{5}{\percent}$ and decreases over time to about $\SI{1}{\percent}$ 
The decreasing is after the initial phase approximately linear
At the end of the solving process the variance strongly increases, before the model is solved and the value is therefore $\SI{0}{\percent}$.
The curve behavior between the different \segLengthFactor{} is roughly the same, expect an offset in total runtime of course.
A difference with changing \segRadiusFactor{} is again not visible.
\\
% 
The number of objects show only a slightly decrease over time.
A significant increase is visible in a decreasing value of \segLengthFactor{}.
The \segRadiusFactor{} is negligible expect in the case of $\segLengthFactor = \SI{1}{}$, where the number of objects is increased \todo{WHY???, makes no sense especially so early}.
\par
% 
% CROSSING
The crossing fiber population in \cref{fig:timeDevelopmentCross} shows for all parameter sets an equally linear behavior for the number of steps as in the case of the single fiber population.
However, the total runtime is significantly increased compared to the models with a single fiber population.
The runtime increases significantly with a decrease in \segLengthFactor{} and decreases with a decrease in \segRadiusFactor{}. 
The letter is clearly visible in the next plot.
In the case of $\segLengthFactor = \SI{1}{}$ and $\segLengthFactor = \SI{2}{}$, the maximum number of steps has been reached.
For $\segLengthFactor = \SI{1}{}$ this happened after $\SI{24}{\hour}$.
\\
% 
The number of colliding fiber segments show in the case of the smallest \segRadiusFactor{} the same decrising behavier as for the single fiber population.
The key difference is that with an increase of the minimal fiber bending radius factor \segRadiusFactor{} this behavior changes drastically.
The curves seams to split at a critical number of steps (or runtime) and from then decreases more and more linear for higher \segRadiusFactor{} and smaller \segLengthFactor{}.
The number of splits increases with a decrease in \segLengthFactor{} and does not increase in the case of $\segLengthFactor = \SI{8}{}$.
The split point is close to the total runtime of the lowest \segRadiusFactor{} in terms of runtime.
\\
% 
The overlap fraction shows a significant difference for the smaller fiber segment length factor \segLengthFactor{} with respect to the single fiber population case.
For the high \segLengthFactor{} values, the curve follows almost the same path as in the single fiber population case and stops at the solved state.
However, for lower values and also depending on the \segRadius{}, the curve continues at about $\SI{1}{\percent}$ overlap.
In the case of $\segLengthFactor = \SI{1}{}$ and $\segRadiusFactor = \SI{8}{}$, it even starts to grow slightly again at the end of its lifetime.
\\
% 
The number of objects shows the same behavior as in the case of the single fiber population. 
A slight decrease in the number and a significant increase is visible for a decreasing value of the \segLengthFactor{}.
The splitting of the curves for the \segRadiusFactor{} is also visible, but not as pronounced as in the case of the number of colliding objects.
In the case of $\segLengthFactor = \SI{1}{}$ and $\segRadiusFactor = \SI{8}{}$, an increase of objects is visible in the last phase of the solution algorithm.
\par
%
The other fiber radii show a very similar behavier.
The strongest difference is a very significant reduction of the runtime with an increase of the \fiberRadiusMean{} (see \cref{app:pste1,app:pste2,app:pste3,app:pste4,app:pste5}).
% 
% 
% 
\subsection{Discussion}
% 
% 
\itodo{zusammenfassung der gewaehlten parameter}
\itodo{trennung zu overall discussion}
\itodo{repo messung mit in die buolding simulation model}
% 

% 
\par
\noindent\rule{\textwidth}{2pt}
\par 
% 
The goal is to choice a set of parameters, which allow a) fast, b) collision free and c) a high volume fraction for densely fibers.
In the case of parallel fibers, the solving process is always faster than for crossing bundles.
Even thow that the number of colliding objects is more or less \dummy{} the same \dummy{(ein plot?)} the needed volume to have enough space to not collide with each other is larger \dummy{}.
Therefore the distance the fiber segments have to travel is higher und the number of steps to achive this increases as well.
\\
% 
The behavior in change of the length factor \segLengthFactor{} is clearly a time advantage, since also the number ob objects is smaller.
However a larger \segLengthFactor{} results for crossing fibers as to be expected in a smaller volume fraction.
For parallel fiber is is reasonable that the volume fraction das not change, since the direction of movement for all fiber segments is radial symmetric along their main orientation axis.
Up to a fiber radii of \SI{2}{\micro\meter} the repeating measurements are stable.
Above it the resulting orientations starts to divers.
This has to to with that the volume has a fixed size of \SI{60}{\micro\meter}.
This means the number of segments is quite small, individual and the model is therefore diverge.
\\
The fiber semgent bending radii factor \segRadiusFactor{} yield to less diverse results.
Since it restrict the bending radii, it is expected, and visible in the results, that the volume fraction is very influenced, since the volume can't be optimal filled anymore.
Again changes parallel fiber orientation are almost not visible, for all analysed values.
Crossing fibers however are as expected influenced.
This is especial visible in the number of colliding objects, where the \segRadiusFactor{} splits the data into individual branches over time.
Since smaller values of \segRadiusFactor{} allow more curved geometries, this is as expected.
However this can lead to \say{strange looking} results and has to be set with an anatomical perspective. \todo{images}
\par
% 
Overall the choice of the parameters can be narrowed.
The main decision come from the crossing results.
Since most basic parameter is the length length factor \segLengthFactor{}.
Looking at the volume fraction results it should be as small as possible.
However since the difference between $\segLengthFactor=\SI{1}{}$ and $\segLengthFactor=\SI{2}{}$ is small, and a big leap is visible for $\segLengthFactor=\SI{4}{}$ one can use $\segLengthFactor=\SI{2}{}$.
The only reason to increase this value further would be a reduction in runtime.
\\
% 
The fiber radii should be as realistic to real \acs{WM} brain tissue as possible.
However to reduce the runtime further, a reduction to $r = \SI{1}{\micro\meter}$ is feasible.
It is still in the same order of magnitude to the real values (\SI{0.5}{\micro\meter}).
The \ac{3D-PLI} simulation results will show more effective metric to further restrict these parameters.
% 
The choice of the fiber banding factor is as already mentioned, more a anatomical restriction.
However it can be resend, that it has no benefit to reduce its value more then 1 or fibers can (with a small fiber segment length) move perfectly around another fiber, like horseshoe shaped.
To work against this, but not to further restrict the model geometry a value of 2 is chosen.
Therefore the following parameters are chosen:
% 
\begin{table}[H]
\sisetup{parse-numbers=false,open-bracket={\{}, close-bracket={\}}, list-final-separator={,},list-pair-separator={,}}%
\centering
% \caption{Chosen model solver parameters}
\pgfplotstabletypeset[%
    thesisTableStyle,
    column type=lcc,
    columns/name/.style={string type},
    columns/variable/.style={string type},
    columns/values/.style={string type},
    every head row/.style={before row=\toprule,after row=\midrule},
    every last row/.style={after row=\bottomrule},
    col sep=&,
    row sep=\\,
]
{name & variable & values\\
mean fiber radius & $\fiberRadiusMean$ & $\SI{0.5}{\micro\meter}$\\
mean segment length factor & $\segLengthFactor$ & $\num{2}$\\
min segment bending radius factor & $\segRadiusFactor$ & $\num{2}$\\
}
% \vspace{1ex}
% \label{tab:parameterSeries}
\end{table}
% 
A last remark.
An additional property to reduce the runtime is to not completely solve the model. 
Looking at the overlap fraction, a value of $<\SI{1}{\percent}$ can be feasible.
This this an additional order of magnitude can be potential saved.
However, the effect inside the simulation has to be studied.
% 
% 
% 
\section{Angular distribution and further runtime analyses}
% 
The above chosen parameter set is viable regarding runtime and volume density.
However an important property still has to be investigated, the resulting orientation dstribution.
To reduce the amount of data and calculations, this is in only investigated on the chosen parameter set.
A key factor is the angular opening angle $d\Omega$. Here it is defined as the angle to the mean value of all fiber segments inside its fiber bundle:
\begin{align}
    \begin{split}
        d\Omega &= \sphericalangle(\vec{f}_{\mathit{seg}}, \overbar{\vec{f}}_{\mathit{seg}})\\
        \overbar{\vec{f}}_{\mathit{seg}} &= \sum^{N_{\mathit{seg\, in\, fb}}}_{i=0} \frac{\overbar{\vec{f}}_{\mathit{seg},i}}{N_{\mathit{seg\, in\, fb}}}
    \end{split}
\end{align}
% 

% 
\begin{table}[!b]
\caption[repo angle results]{mean and std of opening angle $d\Omega$ in degree. The lower case number indicates the 10er exponent}
\resizebox{\textwidth}{!}{
\pgfplotstabletypeset[%
    thesisTableStyle,
    columns={omega,psi,radius,state, pop,mean_mean,mean_std,25_mean,25_std,50_mean,50_std,75_mean,75_std}, %,std_mean,std_std,
    % sort, sort key=omega,
    % every head row/.style={after row={\si{\degree} & & \si{\micro\meter} & & & & &\si{\degree} & &\si{\degree} & &\si{\degree} & &\si{\degree} & &\si{\degree} & &\si{\degree} & &\si{\degree} & &\si{\degree} & &\si{\degree} & \\ \midrule}},
    columns/state/.style={string type},
    columns/mean_mean/.style={column name=$<<d\Omega>>$,sci,sci zerofill,sci subscript,precision=2,dec sep align},
    % columns/std_mean/.style={column name=$<\sigma(d\Omega)>$,sci,sci zerofill,sci subscript,precision=2,dec sep align},
    columns/25_mean/.style={column name=$<25(d\Omega)>$,sci,sci zerofill,sci subscript,precision=2,dec sep align},
    columns/50_mean/.style={column name=$<50(d\Omega)>$,sci,sci zerofill,sci subscript,precision=2,dec sep align},
    columns/75_mean/.style={column name=$<75(d\Omega)>$,sci,sci zerofill,sci subscript,precision=2,dec sep align},
    columns/mean_std/.style={column name=$\sigma(<d\Omega>)$,sci,sci zerofill,sci subscript,precision=2,dec sep align},
    % columns/std_std/.style={column name=$\sigma(\sigma(d\Omega))$,sci, sci zerofill,sci subscript,precision=2,dec sep align},
    columns/25_std/.style={column name=$\sigma(25(d\Omega))$,sci,sci zerofill,sci subscript,precision=2,dec sep align},
    columns/50_std/.style={column name=$\sigma(50(d\Omega))$,sci,sci zerofill,sci subscript,precision=2,dec sep align},
    columns/75_std/.style={column name=$\sigma(75(d\Omega))$,sci,sci zerofill,sci subscript,precision=2,dec sep align},
    % column type=ccccccccccccccc,
    col sep=comma,
]
{dev/rc1/repo/omegas_ms.csv}
}
\end{table}
% 
From the statistic above one notice that the initial fiber statistic is the same for all configurations from 1.4+-0.0 to 3.0+-0.1 [25-75].
The mean orientation for both fiber population show withing $10^-5$ in the direction of the x and y axis.
For parallel fibers the angle omega goes from 3.0+-0.1 to 8.0+-0.3 [25-75]. For crossing fibers from 9.5+-0.2 to 26.2+-0.5 [25-75].
\par
% 
This results indicate because of the small standard deviation of the angle omega the ..., that not many models are needed, since the statistical orientations of the fiber segments inside the models are stable with less than 1 degree.
However it still has to be shown, that it has no significant impact on the simulation side.
% 
% 
% 
\par
% 
\begin{figure}[!t]
\centering
\subcaptionbox{volume and time}[.49\textwidth]{
\includegraphics[width=0.45\textwidth]{dev/rc1/speed/time_volume_size_time.pdf}}
\subcaptionbox{volume and num obj}[.49\textwidth]{
\includegraphics[width=0.45\textwidth]{dev/rc1/speed/time_volume_size_num_obj.pdf}}
\caption[time\_volume\_size\_time]{time\_volume\_size\_time and num obj, regression excluded 20 case}
\label{fig:timevolumeSizeTime}
\end{figure}
% 
\itodo{parameter und simulation von plot beschreiben (vor results)}
\Cref{fig:timevolumeSizeTime} shows logarithmic plot of the cube size length against the time and number of objects. 
A regression line is plotted in with excluding the v0=20 case.
For this range of cube length an exponential behavior is visible for both time and number of objects.
\todo{schoen schreiben und plotten}
% 
\section{CPU Acceleration}
% 
\begin{figure}[!t]
\centering
\includegraphics[]{dev/rc1/speed/boxplot_output_r_0.5.pkl_speedup.csv.pdf}
\caption[\code{model.Sovler} speedup]{\code{model.Sovler} speedup. The time measurements are taken after $\Delta_{\mathit{steps}}$ for the next $100$ steps for parallel $(||)$ and crossing $\times$ fiber configurations.}
\label{fig:solverSpeedup}
\end{figure}
% 
As described in \dummy{} \openmp{} is used for acceleration.
This means no usage of multiple computer nodes is currently available.
\cref{fig:solverSpeedup} shows a speedup up to eight cores.
A number of two cores gives a good speedup of around $1.8$, three cores around $2.5$ and four cores around $3$.
A further incresse of core numbers does not benefit the runtime much.
This has most likely to do with the fact, that the data has to transvered between all the cores and this takes quite some time.
Even if the algorithm is especially optimized to reduce the amount of data to be copied, the paralysed instructions are often very short (\eg{} move positions), with the exception of the distance calculation.
Since all data is linear in memory, the cpu can use the full potential of the prefetcher and calculate very fast.
\par
% 
The results show, that especially to increase the volume size, other algorithms are needed. 
Here the \ac{GPU} seems to be the hardware of choice.
% 
% 
% 
\section{Building models for simulation}
% 
With the upper chosen model parameters the final models can be build.
To be able to study the effect of the fiber radii on the simulation, all radii are generated.
In this section the resulting orientation inside the volume, \ie{} the orientation of the fiber segments, will be analysed.
The same setup as above (see \cref{sec:modelSetup}) is chosen with fix $\segLengthFactor=\SI{2}{}$ and $\segRadiusFactor = \SI{2}{}$.
Using the rotational model from above, only fibers with a $\Psi =  0...90$ and $\Omega = 0.1...1.0$ are generated.
% 
% 
% 
\subsection{Results}
% 
\begin{figure}[!t]
\centering
% \resizebox{1.0\textwidth}{!}{
\includegraphics[width=\textwidth, page=1]{dev/rc1/cube_2pop_orientation_hist2d_output_cube_2pop_135_rc1.pdf}
% }
\caption[Model orientation histograms]{density distribution of fiber segment orientation in initial and resulting models for $\fiberRadius = \SI{1}{\micro\meter}$. \itodo{fit ESAG} \ITODO{these are only resulting models!}}
\label{fig:modelOrientation}
\end{figure}
% 
\begin{table}[!b]
\centering
\pgfplotstabletypeset[%
    thesisTableStyle,
    columns={omega,psi,pop,mean,std,25,50,75},
    % sort, sort key=omega,
    % every head row/.style={after row={\si{\degree} & & &\si{\degree} &\si{\degree} &\si{\degree}&\si{\degree}&\si{\degree} \\ \midrule}},
    columns/mean/.style={column name=$<d\Omega> / \si{\degree}$,zerofill,precision=0},
    columns/std/.style={column name=$\sigma(d\Omega) / \si{\degree}$,zerofill,precision=0},
    columns/25/.style={column name=$25(d\Omega) / \si{\degree}$,zerofill,precision=0},
    columns/50/.style={column name=$50(d\Omega) / \si{\degree}$,zerofill,precision=0},
    columns/75/.style={column name=$75(d\Omega) / \si{\degree}$,zerofill,precision=0},
    % column type=ccccccccccccccc,
    col sep=comma,
]
{dev/rc1/omegas_ms_2pop.csv}
\caption[repo angle results]{mean and std of opening angle $d\Omega$ in degree. The lower case number indicates the 10er exponent}
\end{table}
% 
% \begin{figure}[p]
% \centering
% % \resizebox{1.0\textwidth}{!}{
% \includegraphics[width=\textwidth, page=1]{dev/rc1/cube_2pop_orientation_hist_output_cube_2pop_135_rc1_.pdf}
% % }
% \caption[Model orientation histograms]{Maximum normed distribution of fiber segment orientation in initial and resulting models. The left half circle contains the inclination $\alpha$ value, the right half the direction $\varphi$. \itodo{which norm?}}
% \label{fig:modelOrientationHist1d}
% \end{figure}
% 
The results are visualized in two polar axis plots in \cref{fig:modelOrientationHist1d}. On the right hemisphere the direction histogram is shown.
The left hemisphere shows the inclination distribution.
Both plots are decoupled from each other. \todo{histograms mit line plots?}
Each value is normed to the maximum of that curve so that the shape is visible.
A 3d visualized model is printed in the corner of each parameterset.
% 
The subset of results show that for all radii the fibers rich the same resulting distribution of orientations. 
These distributions are broder than the inital values and are centered around their initial orientations.
The resulting 3d visualized models show all an interwoven structure, where both fiber population orientations are clearly visible. \todo{anhang}
%  
\subsection{Discussion}
%
% 
